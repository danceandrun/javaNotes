# Redis

## 1. å¼•å…¥

è¿„ä»Šä¸ºæ­¢ï¼Œäº’è”ç½‘çš„å‘å±•å·²ç»ç»å†äº†ä¸¤ä¸ªé˜¶æ®µweb1.0å’Œweb2.0

- web 1.0æ—¶ä»£ï¼Œç½‘ç«™æ˜¯é™æ€çš„(é€šå¸¸æ˜¯ä¸€äº›ç®€å•çš„æ–‡å­—å’Œå›¾ç‰‡)ï¼Œä¹Ÿå°±æ˜¯ç½‘ç«™åˆ›å»ºä»€ä¹ˆå†…å®¹ï¼Œç”¨æˆ·å°±è·å–ä»€ä¹ˆå†…å®¹ï¼Œè¿™æ˜¯ä¸€ä¸ªå•æ–¹é¢çš„ä¿¡æ¯ä¼ é€’ï¼Œæ²¡æœ‰ä»»ä½•äº’åŠ¨ï¼Œæ¯”å¦‚ä»¥å‰çš„ä¸­å›½ä¸‰å¤§é—¨æˆ·ç½‘ç«™ï¼šæœç‹ã€æ–°æµªã€ç½‘æ˜“ï¼Œå°±æ˜¯Web1.0çš„å…¸å‹ä»£è¡¨ã€‚
- Web2.0 å¼ºè°ƒ**å†…å®¹çš„äº’åŠ¨**ï¼Œç”¨æˆ·ä¸å†åªæ˜¯å†…å®¹æ¥æ”¶æ–¹ï¼Œè€Œå¯ä»¥æˆä¸ºå†…å®¹çš„æä¾›æ–¹ï¼Œå¹³å°çš„å…±å»ºè€…ï¼Œäºæ˜¯æˆ‘ä»¬å°±è¿›å…¥äº†æ•°æ®çˆ†ç‚¸çš„æ—¶ä»£

ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“åœ¨åº”ä»˜web2.0ç½‘ç«™ï¼Œç‰¹åˆ«æ˜¯è¶…å¤§è§„æ¨¡å’Œé«˜å¹¶å‘çš„web2.0çº¯åŠ¨æ€ç½‘ç«™å·²ç»æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œæš´éœ²äº†éš¾ä»¥å…‹æœçš„é—®é¢˜ï¼š

- High performance å¯¹æ•°æ®åº“**é«˜å¹¶å‘å†™**çš„éœ€æ±‚ã€‚web2.0ç½‘ç«™è¦æ ¹æ®ç”¨æˆ·ä¸ªæ€§åŒ–ä¿¡æ¯æ¥å®æ—¶ç”ŸæˆåŠ¨æ€é¡µé¢å’Œæä¾›åŠ¨æ€ä¿¡æ¯ï¼Œå› æ­¤æ•°æ®åº“å¹¶å‘è´Ÿè½½éå¸¸é«˜ï¼Œå¾€å¾€è¦è¾¾åˆ°æ¯ç§’ä¸Šä¸‡æ¬¡è¯»å†™è¯·æ±‚ï¼Œå…³ç³»å‹æ•°æ®åº“åº”ä»˜ä¸Šä¸‡æ¬¡çš„SQLæŸ¥è¯¢è¿˜å‹‰å¼ºé¡¶å¾—ä½ï¼Œä½†æ˜¯åº”ä»˜ä¸Šä¸‡æ¬¡çš„SQLå†™æ•°æ®è¯·æ±‚ï¼Œç¡¬ç›˜IOå°±å·²ç»æ— æ³•æ‰¿å—äº†
- Huge Storage å¯¹æµ·é‡æ•°æ®çš„**é«˜æ•ˆå­˜å‚¨å’Œè®¿é—®**çš„éœ€æ±‚ã€‚å¯¹äºå¤§å‹çš„SNSç½‘ç«™ï¼ˆç¤¾äº¤ç½‘ç»œï¼‰ï¼Œæ¯å¤©ç”¨æˆ·äº§ç”Ÿæµ·é‡çš„ç”¨æˆ·åŠ¨æ€ä¿¡æ¯ï¼Œä»¥å›½å¤–çš„Friend feedä¸ºä¾‹å­ï¼Œä¸€ä¸ªæœˆå°±è¾¾åˆ°äº†2.5äº¿æ¡ç”¨æˆ·åŠ¨æ€ï¼Œå¯¹äºå…³ç³»å‹æ•°æ®åº“æ¥è¯´ï¼Œåœ¨ä¸€å¼ 2.5äº¿æ¡è®°å½•çš„è¡¨é‡Œè¿›è¡ŒSQLæŸ¥è¯¢ï¼Œæ•ˆç‡æ˜¯æå…¶ä½ä¸‹ä¹ƒè‡³ä¸å¯å¿å—çš„ï¼Œå†å¦‚å¤§å‹webç½‘ç«™ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼Œæ¯”å¦‚è…¾è®¯ã€ç››å¤§ã€åŠ¨è¾„æ•°äº¿è®¡çš„è´¦å·ã€å…³ç³»æ•°æ®åº“ä¹Ÿå¾ˆéš¾ä»¥åº”ä»˜ã€‚

åŒæ—¶ï¼Œå¯¹äºweb2.0ç½‘ç«™æ¥è¯´ï¼Œå…³ç³»æ•°æ®åº“çš„å¾ˆå¤šä¸»è¦ç‰¹æ€§å´å¾€å¾€æ— ç”¨æ­¦ä¹‹åœ°ã€‚æ¯”å¦‚ï¼š

- å¾ˆå¤šwebå®æ—¶ç³»ç»Ÿå¹¶ä¸è¦æ±‚ä¸¥æ ¼çš„æ•°æ®åº“äº‹åŠ¡ï¼Œå¯¹**è¯»ä¸€è‡´æ€§**çš„è¦æ±‚å¾ˆä½ï¼Œæœ‰äº›åœºåˆå¯¹**å†™ä¸€è‡´æ€§**è¦æ±‚ä¹Ÿä¸é«˜ï¼Œå› æ­¤æ•°æ®åº“äº‹åŠ¡ç®¡ç†æˆäº†æ•°æ®åº“é«˜è´Ÿè½½ä¸‹ä¸€ä¸ªæ²‰é‡çš„è´Ÿæ‹…ã€‚
- å¯¹å…³ç³»æ•°æ®åº“æ¥è¯´ï¼Œæ’å…¥ä¸€æ¡æ•°æ®ä¹‹åç«‹åˆ»æŸ¥è¯¢ï¼Œæ˜¯è‚¯å®šå¯ä»¥è¯»å‡ºæ¥è¿™æ¡æ•°æ®çš„ï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šwebåº”ç”¨æ¥è¯´ï¼Œå¹¶ä¸è¦æ±‚è¿™ä¹ˆé«˜çš„å®æ—¶æ€§ã€‚
- ä»»ä½•å¤§é‡æ•°æ®çš„webç³»ç»Ÿï¼Œéƒ½éå¸¸å¿Œè®³å¤šä¸ªå¤§è¡¨çš„å…³è”æŸ¥è¯¢ï¼Œä»¥åŠå¤æ‚çš„æ•°æ®åˆ†æç±»å‹çš„å¤æ‚SQLæŠ¥è¡¨æŸ¥è¯¢ï¼Œä»éœ€æ±‚ä»¥åŠäº§å“è®¾è®¡è§’åº¦ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå°½é‡é¿å…è¿™ç§æƒ…å†µçš„äº§ç”Ÿï¼Œå¾€å¾€æ›´å¤šçš„åªæ˜¯**å•è¡¨çš„ä¸»é”®æŸ¥è¯¢**ï¼Œä»¥åŠå•è¡¨æ¡ä»¶åˆ†é¡µæŸ¥è¯¢ï¼ŒSQLåŠŸèƒ½è¢«æå¤§åœ°å¼±åŒ–äº†

å› æ­¤å…³ç³»æ•°æ®åº“åœ¨è¿™äº›è¶Šæ¥è¶Šå¤šçš„åº”ç”¨åœºæ™¯ä¸‹æ˜¾å¾—ä¸é‚£ä¹ˆåˆé€‚äº†ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒNoSQLæ•°æ®åº“åº”è¿è€Œç”Ÿã€‚è€ŒRediså°±æ˜¯ä¸€ä¸ªå…¸å‹çš„NoSQLæ•°æ®åº“ã€‚å’Œä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“ç›¸æ¯”ï¼ŒRedisæ˜¯ä¸€ä¸ª**çº¯å†…å­˜æ•°æ®åº“**ï¼Œå­˜å‚¨**éç»“æ„åŒ–**çš„key-valueé”®å€¼å¯¹ã€‚

 ğŸ·ï¸Redisçš„ä¸¤ä¸ªç‰¹å¾ï¼š

1. æ˜¯ä¸€ä¸ªçº¯å†…å­˜æ•°æ®åº“ï¼Œæ“ä½œå¿«
2. å­˜å‚¨é”®å€¼å¯¹

## 2. ä»‹ç»

Redisæ˜¯ä¸€ä¸ªNoSQLæ•°æ®åº“ã€‚

NoSQL: not only SQLã€‚è¡¨ç¤ºéå…³ç³»å‹æ•°æ®åº“ï¼ˆä¸æ”¯æŒSQLæ ‡å‡†è¯­æ³•ï¼‰ã€‚

> Redis æ˜¯ä¸€ä¸ªä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ã€å…è´¹çš„ã€å¼€æºçš„ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜ã€äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ï¼Œkey-value éå…³ç³»å‹æ•°æ®åº“ï¼Œå¹¶ä¸”æä¾›å¤šç§è¯­è¨€çš„ API
>
> - Cè¯­è¨€ç¼–å†™çš„
> - å¼€æºçš„ï¼ˆhttps://github.com/redisï¼‰
> - å¯åŸºäºå†…å­˜ï¼šæ˜¯æŠŠæ•°æ®å­˜åœ¨åˆ°å†…å­˜ä¸Šçš„
> - å¯æŒä¹…åŒ–ï¼šå¯ä»¥æŠŠå†…å­˜é‡Œé¢çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜(ä¸ºäº†å®ç°æ•°æ®æ¢å¤)
> - key-valueï¼šæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯ä»¥é”®å€¼å¯¹çš„æ–¹å¼æ¥å­˜å‚¨çš„
> - æ”¯æŒç½‘ç»œï¼šå®¢æˆ·ç«¯æ˜¯é€šè¿‡ç½‘ç»œè¿æ¥æœåŠ¡ç«¯çš„ï¼ˆRedisæ˜¯C/Sæ¶æ„ï¼šredis-serverå’Œredis-cliå®¢æˆ·ç«¯ï¼‰
>
> - æ”¯æŒå¤šç§è¯­è¨€ï¼šå¯ä»¥åœ¨å„ç§è¯­è¨€çš„ä»£ç ä¸­æ“ä½œRedis

## 3. å®‰è£…

Rediså®˜æ–¹å…¶å®æ˜¯ä¸æ”¯æŒwindowsæ“ä½œç³»ç»Ÿçš„ã€‚ä½†æ˜¯windowsçš„å·¥ä½œå›¢é˜Ÿç»™redisæä¾›äº†é€‚é…ï¼Œè®©Redisèƒ½å¤Ÿæ”¯æŒwindowsã€‚

### 3.1 ä¸‹è½½

![image-20221019114805584](img/image-20221019114805584.png)

### 3.2 è§£å‹

![image-20221019115320041](img/image-20221019115320041.png)

### 3.3 å¯åŠ¨

#### 3.3.1 å¯åŠ¨æœåŠ¡ç«¯

> 1. æ‰“å¼€Redisçš„è§£å‹ç›®å½•
>
> 2. åœ¨æ­¤å¤„æ‰“å¼€cmdå‘½ä»¤è¡Œ
>
> 3. æ‰§è¡Œå‘½ä»¤
>
>    ```shell
>    redis-server.exe redis.windows.conf
>    ```

![image-20221020093334606](img/image-20221020093334606.png)

#### 3.3.2 å¯åŠ¨å®¢æˆ·ç«¯

> 1. è¿›å…¥è§£å‹è·¯å¾„
>
> 2. è¾“å…¥cmd
>
> 3. æ‰§è¡Œå‘½ä»¤
>
>    ```shell
>    redis-cli.exe [-h  localhost] [-p 6379]
>    ```
>    
>    é»˜è®¤è®¿é—®æœ¬æœºçš„6379ç«¯å£

## 4. Redisæ ¸å¿ƒé…ç½®

### 4.1 å¸¸è§„é…ç½®

```ini
# è¡¨ç¤ºredisæœåŠ¡ç«¯æ˜¯ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹ï¼ˆåå°è¿›ç¨‹ï¼‰çš„æ–¹å¼è¿è¡Œ
# on windows, daemonize is not supported
daemonize no

# å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œå‡å¦‚è¶…è¿‡å¤šé•¿æ—¶é—´æ²¡æœ‰è¿›è¡Œé€šä¿¡é‚£ä¹ˆå°±æ–­å¼€è¿æ¥
# 0è¡¨ç¤ºä¸å…³é—­è¿æ¥
timeout 0

# ç«¯å£å·ï¼ˆä¸€èˆ¬ä¸ç”¨å»æ”¹ï¼‰
port 6379

# ç»‘å®šçš„ä¸»æœºåœ°å€
bind 127.0.0.1
# æ‰€æœ‰äººéƒ½å¯ä»¥è¿æ¥
# bind 0.0.0.0

# æ—¥å¿—çº§åˆ«
loglevel notice

# æ•°æ®åº“çš„æ•°é‡è®¾ç½®
databases 16

# å¯†ç è®¾ç½®
requirepass cskaoyan
```

### 4.2 æŒä¹…åŒ–é…ç½®

#### RDB

RDBæ˜¯æŒ‡Redisé€šè¿‡**å†…å­˜å¿«ç…§**çš„å½¢å¼æ¥æŒä¹…åŒ–å†…å­˜ä¸­çš„æ•°æ®åˆ°ç£ç›˜ä¸­ã€‚

RDBæ˜¯Redisé»˜è®¤çš„æŒä¹…åŒ–ç­–ç•¥ï¼Œæ²¡æœ‰æä¾›å¼€å…³å…³é—­ã€‚

> å¿«ç…§ï¼šå…¶å®å°±æ˜¯ä¸€ç§å†…å­˜æŠ€æœ¯ï¼Œå°±å¯ä»¥åƒå¯¹å†…å­˜è¿›è¡Œæ‹ç…§ä¸€æ ·ï¼Œä¿å­˜å†…å­˜å½“æ—¶çš„çŠ¶æ€ã€‚
>
> - å¿«ç…§çš„é€Ÿåº¦å¾ˆå¿«
> - å¿«ç…§ä¿å­˜çš„ä¸€ç§æ•°æ®çš„çŠ¶æ€ï¼Œå ç”¨çš„ç£ç›˜ç©ºé—´æ¯”è¾ƒå°
> - å¿«ç…§ä¼šä¿å­˜å®Œæ•´çš„æ•°æ®

```ini
# å†…å­˜å¿«ç…§ä¿å­˜æ–‡ä»¶çš„ä½ç½®
# é»˜è®¤æ˜¯./ å½“å‰ç›®å½•ï¼Œå®‰è£…Redisçš„ç›®å½•
dir D:\tmp

# å†…å­˜å¿«ç…§ä¿å­˜æ–‡ä»¶çš„åå­—
dbfilename dump.rdb

# å¿«ç…§è§¦å‘çš„ç­–ç•¥ âš¡ 
save <seconds> <changes>
# åœ¨å¤šå°‘ç§’ä¹‹åï¼Œæ£€æŸ¥æœ‰å¤šå°‘æ¬¡æ”¹å˜ï¼Œå¦‚æœè¾¾åˆ°è®¾ç½®çš„æ¡ä»¶ï¼Œé‚£ä¹ˆå°±è§¦å‘æŒä¹…åŒ–
# é”®å€¼å¯¹å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ï¼Œæ–°å¢ï¼Œåˆ é™¤å’Œä¿®æ”¹
# ç›¸å½“äºå¯åŠ¨äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯ä¸ªå›ºå®šæ—¶é—´æ‰«æä¸€æ¬¡æ”¹å˜æ¬¡æ•°
save 900 1
save 300 10
save 60 10000
```

![image-20221020102122917](img/image-20221020102122917.png)

> æ€»ç»“ï¼š
>
> 1. RDBæ¯æ¬¡ä¿å­˜çš„æ˜¯è§¦å‘RDBæ—¶åˆ»çš„å®Œæ•´çš„æ•°æ®
> 2. RDBå¯èƒ½ä¸¢å¤±æ•°æ®ï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸Šä¸€æ¬¡æŒä¹…åŒ–ä¹‹åæ‰€æœ‰å†™å…¥çš„æ•°æ®ï¼ˆæ¯”å¦‚æœ€å°é—´éš”æ˜¯60ç§’ï¼Œåœ¨0~60ç§’é—´Redisçªç„¶æŒ‚æ‰ï¼Œå°±ä¼šæœ‰æ•°æ®ä¸¢å¤±ï¼‰
> 3. RDBä¿å­˜æ•°æ®çš„é€Ÿåº¦å¾ˆå¿«ï¼Œè¿˜åŸæ•°æ®ä¹Ÿå¾ˆå¿«ï¼Œæ¯”AOFå¿«

#### AOF

Append only fileã€‚AOFè¿™ç§æŒä¹…åŒ–çš„æœºåˆ¶æ˜¯é€šè¿‡**è¿½åŠ (å†™æ“ä½œå‘½ä»¤)æ—¥å¿—æ–‡ä»¶**çš„æ–¹å¼æ¥ä¿å­˜æ•°æ®çš„ã€‚

> AOFä¼šæŠŠç”¨æˆ·è¾“å…¥çš„æ¯ä¸€ä¸ªå†™å…¥å‘½ä»¤ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œåç»­æ¢å¤æ•°æ®çš„æ—¶å€™å¯ä»¥é€šè¿‡æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚

```ini
# æ€»å¼€å…³
# AOFé»˜è®¤æ˜¯å…³é—­çš„
appendonly no

# ä¿å­˜æ–‡ä»¶çš„è·¯å¾„
# é…ç½®å’ŒRDBæ˜¯åŒä¸€ä¸ªé…ç½®
dir D:\tmp

# ä¿å­˜æ–‡ä»¶çš„åå­—
appendfilename "appendonly.aof"

# ä¿å­˜çš„ç­–ç•¥

# æ¯æ”¶åˆ°ä¸€æ¡å†™å…¥çš„å‘½ä»¤ï¼Œå°±æŠŠå‘½ä»¤ä¿å­˜åˆ°æ–‡ä»¶ä¸­
# fsync()æ–¹æ³•ä¼šè®©æ“ä½œç³»ç»Ÿå°†æ•°æ®ç«‹åˆ»å†™å…¥ç£ç›˜ï¼Œè€Œä¸èµ°ç¼“å­˜
# appendfsync always

# æ¯ç§’ä¿å­˜ä¸€æ¬¡ï¼ˆæ¨èä½¿ç”¨çš„ï¼‰
appendfsync everysec

# ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ç­–ç•¥
# appendfsync no
```

AOFæ–‡ä»¶ä¼šä¸€ç›´è†¨èƒ€å—ï¼Ÿ

å½“AOFæ–‡ä»¶å¤§å°å¢é•¿åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä¼šè§¦å‘**serverçš„ç²¾ç®€æœºåˆ¶**ï¼Œåªä¿å­˜å¯¹åŒä¸€ä¸ªkeyçš„æœ€åä¸€æ¡å‘½ä»¤ã€‚

> AOFæŒä¹…åŒ–æœºåˆ¶çš„æ€»ç»“ï¼š
>
> 1. AOF**å¯ä»¥åšåˆ°**ä¸ä¸¢å¤±æ•°æ®ï¼ˆ`appendfsync always`ï¼‰ï¼Œé€šè¿‡è®¾ç½®`appendfsync always`ï¼Œä½†æ˜¯è¿™æ ·å°±å’Œå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼Œæ¯æ¬¡éƒ½ä¼šæ“ä½œéƒ½ä¼šæœ‰IOã€‚
> 2. AOFä¿å­˜æ•°æ®ç”Ÿæˆçš„æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå ç”¨ç£ç›˜ç©ºé—´æ¯”è¾ƒå¤§
> 3. AOFè¿˜åŸæ•°æ®è¦é€šè¿‡æ‰§è¡Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰çš„å‘½ä»¤æ¥è¿˜åŸæ•°æ®ï¼Œè¿˜åŸæ•°æ®æ¯”è¾ƒæ…¢

> AOFå’ŒRDBæ˜¯å¯ä»¥åŒæ—¶è¿è¡Œçš„ã€‚
>
> å½“ä¸¤ç§æœºåˆ¶éƒ½å¼€å¯çš„æ—¶å€™ï¼Œæ¢å¤æ•°æ®çš„æ—¶å€™ï¼Œä¼˜å…ˆä»AOFç”Ÿæˆçš„æ–‡ä»¶æ¥æ¢å¤æ•°æ®ã€‚å› ä¸ºAOFæ•°æ®ä¿å­˜çš„å®Œæ•´åº¦æ›´é«˜ã€‚

##  5. æ•°æ®ç»“æ„

### å¸¸ç”¨å‘½ä»¤

```ini
# åˆ‡æ¢æ•°æ®ï¼ˆindexä»0å¼€å§‹ï¼Œ0~15ï¼‰
select index

# è®¤è¯å¯†ç 
auth password

# æœç´¢key (pattern æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼)
keys pattern
# å¸¸ç”¨çš„æ˜¯ï¼škeys * ï¼ˆæŸ¥çœ‹æ‰€æœ‰çš„keyï¼‰ï¼Œæ³¨æ„keys * ä¸å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹æ¨¡å‹

# æ¸…ç©ºæ•°æ®åº“ï¼ˆåˆ åº“ï¼‰
# æ¸…ç©ºæ‰€æœ‰çš„æ•°æ®åº“ï¼ˆ16ä¸ªï¼‰
flushall

# æ¸…ç©ºå½“å‰çš„æ•°æ®åº“
flushdb
```

>  ğŸ·ï¸`keys * `ä¸å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼š
>
> Redisä¸­**æ‰§è¡Œå‘½ä»¤**çš„çº¿ç¨‹æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œå¹¶ä¸æ˜¯Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œè€Œæ˜¯æ‰§è¡Œå‘½ä»¤æ˜¯å•çº¿ç¨‹çš„ã€‚éœ€è¦è¢«æ‰§è¡Œçš„å‘½ä»¤å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‰§è¡Œ`keys *` æ—¶ï¼Œåœ¨å•çº¿ç¨‹é‡Œéœ€è¦è·å–å¾ˆå¤šæ•°æ®ï¼Œæ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼Œåœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œå†å‘Rediså‘é€å‘½ä»¤ï¼Œä¼šè¿›å…¥æ’é˜Ÿï¼Œä¸ä¼šè¢«æ‰§è¡Œã€‚å¦å¤–ï¼ŒåŒæ—¶å› ä¸ºæ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥ä¸€ä¸ªå‘½ä»¤å¤©ç”Ÿå°±æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚

ä¸åŒæ•°æ®ç±»å‹çš„å‘½ä»¤ä¸åŒã€‚é€šè¿‡è¾“å…¥å‘½ä»¤å°±å¯ä»¥å†³å®šæ˜¯ä»€ä¹ˆæ•°æ®ç±»å‹ã€‚

### `string`

> å’ŒJAVAä¸­çš„Stringæœ‰åŒºåˆ«ï¼Œç›¸å½“äºJAVAä¸­çš„String ç±»å‹ä¸æ•°å€¼ç±»å‹çš„æ€»å’Œã€‚

stringæ•°æ®ç»“æ„æ˜¯Redisä¸­æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼ŒåŒ…å« ï¼ˆString + æ•°å­—ç±»å‹ï¼‰

![image-20221020112310089](img/image-20221020112310089.png)

```ini
# è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆå¦‚æœkeyå­˜åœ¨ï¼Œä¼šè¦†ç›–ï¼‰
set key value

# è·å–ä¸€ä¸ªé”®å€¼å¯¹çš„å€¼
get key

# æ‰¹é‡çš„è®¾ç½®é”®å€¼å¯¹ multi-setçš„ç¼©å†™mset
mset key1 value1 key2 value2 ...

# æ‰¹é‡çš„è·å–é”®å€¼å¯¹
mget key1 key2 key3 ...

# ç»™æŒ‡å®šçš„keyçš„value +1 valueå¿…é¡»å¾—æ˜¯ä¸€ä¸ªæ•°å€¼
incr key

# ç»™æŒ‡å®šçš„keyå¢åŠ æŒ‡å®šçš„æ­¥é•¿
incrby key increment

# ç»™æŒ‡å®šçš„keyçš„value -1
decr key

# ç»™æŒ‡å®šçš„keyå‡å»æŒ‡å®šçš„æ­¥é•¿
decrby key decrement

# è®¾ç½®ä¸€ä¸ªkey-valueï¼Œå¹¶ä¸”æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸä¹‹åæ‹¿ä¸åˆ°å¯¹åº”çš„å€¼
setex key seconds value

# set not existsï¼Œè®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä¸ä¼šè¦†ç›–åŸæ¥çš„å€¼
# å½“keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå†å»è®¾å€¼ï¼Œä¸ä¼šè¦†ç›–åŸæ¥çš„å€¼
# è¿”å›0ä»£è¡¨ä¿®æ”¹å¤±è´¥ï¼›1ä»£è¡¨æ·»åŠ æˆåŠŸ
setnx key value
```

> ä½¿ç”¨åœºæ™¯ï¼š
>
> 1. åˆ©ç”¨incrå‘½ä»¤å¯ä»¥ç»Ÿè®¡ç½‘ç«™çš„**è®¿é—®é‡**
>
> 2. åˆ©ç”¨incrå’Œdecrç»Ÿè®¡æ¸¸æˆçš„**åœ¨çº¿äººæ•°**
>
> 3. setexå¯ä»¥ç”¨äº**ç§’æ€**
>
> 4. setnxå¯ä»¥å®ç°ç®€å•çš„**åˆ†å¸ƒå¼é”**

> å¦‚ä½•åŸºäºRedisæ¨¡æ‹Ÿæœ€ç®€å•çš„é”ï¼Ÿ
>
> + å¦‚ä½•æ¨¡æ‹ŸåŠ é”é‡Šæ”¾é”çš„çŠ¶æ€ï¼Ÿ
>   + å¯ä»¥ç”¨æœ‰æ— é”®å€¼å¯¹æ¨¡æ‹ŸåŠ é”é‡Šæ”¾é”çš„çŠ¶æ€
> + setnxï¼šåªèƒ½æ·»åŠ ä¸€ä¸ªæ–°çš„é”®å€¼å¯¹
>   + å¦‚æœrediså·²ç»æœ‰äº†è¯¥é”®å€¼å¯¹ï¼ˆæ·»åŠ å¤±è´¥ â†’ åŠ é”å¤±è´¥ï¼‰
>   + å¦‚æœredisä¸­æ²¡æœ‰è¯¥é”®å€¼å¯¹ï¼ˆæ·»åŠ æˆåŠŸ â†’ åŠ é”æˆåŠŸï¼‰

### `list`

`list`çš„æœ¬è´¨æ˜¯ä¸€ä¸ª**åŒå‘é“¾è¡¨**ã€‚`list`çš„ä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ çš„ç±»å‹æ˜¯`string`ã€‚Redisæ”¯æŒç”¨æˆ·ä»`list`çš„ä¸¤ç«¯æ¨å…¥æˆ–è€…æ˜¯å¼¹å‡ºå…ƒç´ ã€‚

 ğŸ·ï¸ç‰¹ç‚¹ï¼š

- å¯é‡å¤
- æœ‰åº

![image-20221020142318075](img/image-20221020142318075.png)

ğŸ·ï¸ å› ä¸ºæœ‰åºæ‰€ä»¥è¦æ³¨æ„ä¹¦å†™é¡ºåºå’Œå­˜å–é¡ºåºçš„å…³ç³»ã€‚

```ini
# ä»é˜Ÿåˆ—çš„å·¦ç«¯æ¨å…¥å…ƒç´ ï¼ˆå½“listä¸å­˜åœ¨çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„listï¼Œç„¶åæ¥æ¨å…¥ï¼‰
lpush key value1 value2 ...

# ä»é˜Ÿåˆ—çš„å·¦ç«¯å¼¹å‡ºä¸€ä¸ªå…ƒç´ 
# æ‰§è¡Œä¹‹åè¯¥å…ƒç´ ä¼šè¢«åˆ é™¤
lpop key

# ä»é˜Ÿåˆ—çš„å³ç«¯æ¨å…¥å…ƒç´ 
rpush key value1 value2 ...

# ä»é˜Ÿåˆ—çš„å³ç«¯å¼¹å‡ºä¸€ä¸ªå…ƒç´ 
rpop key

# æŸ¥çœ‹é“¾è¡¨çš„å…ƒç´ æ•°é‡
llen key

# æŸ¥çœ‹æŸä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ (startã€stopæŒ‡å…ƒç´ çš„ä¸‹æ ‡ï¼Œæœ€å·¦è¾¹çš„å…ƒç´ ä¸‹æ ‡ä¸º0)ï¼ˆ0ï¼Œ-1ï¼‰è¡¨ç¤ºæ‰€æœ‰å…ƒç´ 
# è¿™é‡Œçš„lä»£è¡¨list
lrange key start stop

# æ±‚æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ å€¼
lindex key index

# æ’å…¥ä¸€ä¸ªå…ƒç´ (åœ¨æŒ‡å®šçš„å…ƒç´ pivot å‰é¢æˆ–è€…æ˜¯åé¢æ’å…¥ä¸€ä¸ªæŒ‡å®šçš„å…ƒç´  value )
# å¦‚æœæŒ‡å®šçš„å…ƒç´ pivotæœ‰é‡å¤ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ç¬¬ä¸€ä¸ªå€¼å‰é¢æˆ–è€…æ˜¯åé¢æ’å…¥
linsert key before|after pivot value

# æ­£å¸¸çš„ä»å·¦ç«¯æ¨å…¥ï¼Œå½“listå­˜åœ¨çš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆ
lpushx key value

# ä¿®æ”¹æŒ‡å®šä½ç½®å…ƒç´ çš„å€¼
lset key index value

# åˆ é™¤å‰å‡ ä¸ªæŒ‡å®šçš„å…ƒç´ 
lrem key count value
```

> åº”ç”¨åœºæ™¯ï¼š
>
> - æ¶ˆæ¯é˜Ÿåˆ—
> - æœ€æ–°åŠ¨æ€ï¼ˆæ¶ˆæ¯ï¼‰æ’è¡Œæ¦œï¼ˆegï¼šBç«™çš„åŠ¨æ€ï¼‰

### `set`

æ— åºçš„é›†åˆã€‚

 ğŸ·ï¸ ç‰¹ç‚¹ï¼š

1. æ— åº
2. ä¸å¯é‡å¤

> æ— åºé›†åˆè¿™ç§æ•°æ®ç»“æ„ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¯ä»¥åˆ©ç”¨Redisç»™æˆ‘ä»¬æä¾›çš„å‘½ä»¤**æ±‚å¤šä¸ªæ— åºé›†åˆçš„äº¤é›†ã€å¹¶é›†ã€å·®é›†**ã€‚

![image-20221020144947339](img/image-20221020144947339.png)

```ini
# å¾€æ— åºé›†åˆä¸­æ·»åŠ å…ƒç´ 
sadd key member1 member2 ...

# æŸ¥çœ‹æ— åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°
scard key

# æŸ¥çœ‹æ— åºé›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ 
smembers

# åˆ¤æ–­æŸä¸ªå…ƒç´ åœ¨ä¸åœ¨æŒ‡å®šçš„é›†åˆä¸­
sismember key member

# éšæœºå¼¹å‡ºä¸€ä¸ªå…ƒç´ (å–å‡ºå¹¶åˆ é™¤)
spop key [count]

# éšæœºä»é›†åˆä¸­å–å‡ºä¸€ä¸ªå…ƒç´ çš„å€¼ï¼ˆå–å‡ºä¸åˆ é™¤ï¼‰
srandmember key [count]

# æ±‚äº¤é›†
sinter key1 key2 ...

# æ±‚å‡ºäº¤é›†å¹¶ä¿å­˜
sinterstore destination key1 key2 ...

# æ±‚å¹¶é›†
sunion key1 key2 ...

# æ±‚å‡ºå¹¶é›†å¹¶ä¿å­˜
sunionstore destination key1 key2 ...

# æ±‚å·®é›†
# æ±‚çš„æ˜¯key1æœ‰è€Œkey2æ— çš„
sdiff key1 key2 ...

# æ±‚å‡ºå·®é›†å¹¶ä¿å­˜
sdiffstore destination key1 key2 ...

# ç§»åŠ¨å…ƒç´ 
smove source destination  member

# åˆ é™¤å…ƒç´ 
srem key member1 member2 ...
```

> åº”ç”¨åœºæ™¯ï¼š
>
> 1. æ±‚å…±åŒå¥½å‹
>
> 2. å¥½å‹æ¨è

### `hash`

`hash`å«åšäºŒç»´è¡¨ï¼Œç±»ä¼¼äº`Map`ã€‚

`hash`è¿™ç§æ•°æ®ç»“æ„å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª`map`ï¼Œå¯ä»¥å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹ã€‚è¿™é‡Œé”®å€¼å¯¹ç§°ä¸º`field-value`ã€‚

![image-20221020151528685](img/image-20221020151528685.png)

```ini
# è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹
hset key field value

# è·å–æŒ‡å®šäºŒç»´è¡¨ä¸­fieldçš„å€¼
hget key field

# è®¾ç½®å¤šä¸ªé”®å€¼å¯¹
hmset key field1 value1 field2 value2 ...

# è·å–å¤šä¸ªé”®å€¼å¯¹çš„å€¼
hmget key field1 field2 ...

# åˆ¤æ–­äºŒç»´è¡¨ä¸­æœ‰æ²¡æœ‰æŒ‡å®šçš„field
hexists key field

# è·å–äºŒç»´è¡¨ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹
hgetall key

# è·å–äºŒç»´è¡¨ä¸­æ‰€æœ‰çš„é”®
hkeys key

# è·å–äºŒç»´è¡¨ä¸­æ‰€æœ‰çš„å€¼
hvals key

# æ±‚å‡ºäºŒç»´è¡¨ä¸­ é”®å€¼å¯¹çš„ä¸ªæ•°
hlen key

# ç»™é”®å€¼å¯¹çš„å€¼ å¢åŠ æŒ‡å®šçš„é•¿åº¦
hincrby key field increment

# è®¾ç½®å€¼ï¼Œä¸è¦†ç›–( å½“äºŒç»´è¡¨ä¸å­˜åœ¨æ—¶å€™ï¼Œä¹Ÿä¼šè®¾ç½®å€¼)
hsetnx key field value
```

> åº”ç”¨åœºæ™¯ï¼š
>
> è¦æ ¹æ®ä¸šåŠ¡ç‰¹å¾å†³å®š
>
> ä¸šåŠ¡ä¸­ï¼Œä¸€ä¸ªç”¨æˆ·åªæœ‰ä¸€ä¸ªè´­ç‰©è½¦ï¼Œä¸€ä¸ªè´­ç‰©è½¦ä¸­å¯ä»¥åŒ…å«å¤šä¸ªä¸åŒçš„æ•°æ®
>
> å¹¶ä¸”å¯ä»¥**å¿«é€Ÿæ‰¾åˆ°**ä¿®æ”¹çš„æ•°æ®è€Œä¸éœ€è¦éå†ï¼
>
> - å­˜å‚¨å•†åŸä¸­çš„è´­ç‰©è½¦

### `sortedset`(`zset`)

æœ‰åºçš„é›†åˆã€‚æ¯ä¸ªå…ƒç´ éƒ½ç»‘å®šscoreï¼Œç†è§£ä¸ºå…ƒç´ çš„æƒé‡ã€‚æœ‰åºçš„å¤§å°ç”±scoreçš„å¤§å°å†³å®šã€‚

![image-20221020155415981](img/image-20221020155415981.png)

> æœ‰åºé›†åˆçš„æœ€å¤§ç‰¹ç‚¹æ˜¯ï¼šå¯ä»¥ä»»æ„çš„å–å‡ºæœ‰åºé›†åˆä¸­æŒ‡å®šæ’ååŒºé—´å†…çš„æˆå‘˜ã€ä»¥åŠæŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜ã€‚

```ini
# å¾€æœ‰åºé›†åˆä¸­æ·»åŠ æˆå‘˜ä¸€çº§ä»–çš„åˆ†æ•°ï¼ˆæ³¨æ„ï¼šåˆ†æ•°åœ¨å‰ï¼Œåå­—åœ¨åï¼‰
zadd key score1 member1 score2 member2 ...

# è®¡ç®—é›†åˆä¸­å…ƒç´ çš„æ€»ä¸ªæ•°
zcard key

# æ±‚æŒ‡å®šåˆ†æ•°åŒºé—´å†…æˆå‘˜çš„ä¸ªæ•°ï¼ˆåˆ†æ—¶æ˜¯é—­åŒºé—´ï¼‰
zcount key min max

# æ±‚å‡ºæŒ‡å®šæˆå‘˜çš„åˆ†æ•°
zscore key member

# ç»™æŒ‡å®šçš„æˆå‘˜å¢åŠ åˆ†æ•°
zincrby key score member

# æ±‚å‡ºæŒ‡å®šæ’ååŒºé—´å†…çš„æˆå‘˜(æ’åä»0å¼€å§‹ï¼Œé»˜è®¤æŒ‰ç…§åˆ†æ•°çš„å‡åºæ’åˆ—)
zrange key start stop [withscores]

# æ±‚å‡ºæŒ‡å®šæ’ååŒºé—´å†…çš„æˆå‘˜(æ’åä»0å¼€å§‹ï¼Œé»˜è®¤æŒ‰ç…§åˆ†æ•°é™åºæ’åˆ—)
zrevrange key start stop [withscores]

# æ±‚æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜-æŒ‰ç…§åˆ†æ•°çš„å‡åºæ’åˆ—
zrangebyscore key min max [withscores]

# æ±‚æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜-æŒ‰ç…§åˆ†æ•°çš„é™åºæ’åˆ—
zrevrangebyscore key max min [withscores]

# å‡åºæ±‚å‡ºæŒ‡å®šæˆå‘˜çš„æ’å
zrank key member

# é™åºæ±‚å‡ºæŒ‡å®šæˆå‘˜çš„æ’å
zrevrank key member

# åˆ é™¤æŒ‡å®šçš„æˆå‘˜
zrem key member1 member2 ...

# åˆ é™¤æŒ‡å®šæ’ååŒºé—´å†…çš„æ‰€æœ‰æˆå‘˜
zremrangebyrank key start stop [withscores]

# åˆ é™¤æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æ‰€æœ‰æˆå‘˜
zremrangebyscore key min max [withscores]
```

> åº”ç”¨åœºæ™¯ï¼š
>
> æœ‰åºé›†åˆå¯ä»¥å®ç°æ’è¡Œæ¦œï¼Œæ¯”å¦‚ç§¯åˆ†æ’è¡Œæ¦œï¼Œå°†ç§¯åˆ†å½“ä½œæƒé‡ã€‚
>
> 1. æ¸¸æˆä¸­ç§¯åˆ†"æ’è¡Œæ¦œ"

## 6. å†…å­˜æ·˜æ±°ç­–ç•¥

Redisæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜æ¥å­˜å‚¨çš„æ•°æ®åº“ï¼Œè€Œå†…å­˜èµ„æºæ˜¯ååˆ†å®è´µä¸”æœ‰é™çš„ã€‚é‚£ä¹ˆå½“**å†…å­˜æ»¡äº†ä¹‹å**ï¼ŒRedisåˆéœ€è¦å­˜å‚¨æ–°çš„æ•°æ®çš„æ—¶å€™ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

è¿™ä¸ªæ—¶å€™ï¼ŒRedisä¼šè§¦å‘**å†…å­˜æ·˜æ±°ç­–ç•¥**ï¼Œæ¥æ·˜æ±°è€çš„æ•°æ®ï¼Œä¿è¯å†™å…¥çš„æˆåŠŸã€‚Redisæä¾›äº†8ç§æ·˜æ±°ç­–ç•¥ã€‚

> å‚æ•°è¯´æ˜ï¼š
>
> `volatile`ï¼š**è®¾ç½®è¿‡æœŸæ—¶é—´**çš„æ•°æ®é›†
>
> `allkeys`ï¼šæ‰€æœ‰æ•°æ®é›†
>
> `LRU(Least Recently Used)`ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨
>
> `LFU(Least Frequently Used)`ï¼šè®¿é—®é¢‘åº¦æœ€ä½
>
> `TTLï¼ˆTime To Liveï¼‰`ï¼šæœ€è¿‘è¿‡æœŸæ—¶é—´

- volatile-lruï¼ˆleast recently usedï¼‰

  ä»å·²ç»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ï¼Œé€‰æ‹©**æœ€è¿‘æœ€å°‘ä½¿ç”¨**çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚

- volatile-lfu

  ä»å·²ç»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ï¼Œé€‰æ‹©ä¸€æ®µæ—¶é—´å†…ä½¿ç”¨æœ€å°‘çš„keyè¿›è¡Œæ·˜æ±°

- volatile-random

  ä»å·²ç»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ï¼Œ**éšæœº**é€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±°

- volatile-ttl

  ä»å·²ç»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ï¼Œé€‰æ‹©**æœ€è¿‘å°†è¦è¿‡æœŸ**çš„æ•°æ®è¿›è¡Œæ·˜æ±°

- allkeys-lru

  ä»æ‰€æœ‰çš„æ•°æ®é›†ä¸­ï¼Œé€‰æ‹©æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚

- allkeys-random

  ä»æ‰€æœ‰çš„æ•°æ®é›†ä¸­ï¼Œéšæœºé€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±°

- allkeys-lfu

  ä»æ‰€æœ‰çš„æ•°æ®é›†ä¸­ï¼Œé€‰æ‹©ä¸€æ®µæ—¶é—´å†…ä½¿ç”¨æœ€å°‘çš„keyè¿›è¡Œæ·˜æ±°

- no-evication

  ç¦æ­¢æ·˜æ±°æ•°æ®ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®éœ€è¦å†™å…¥ï¼Œé‚£ä¹ˆå°±**ç›´æ¥æŠ¥é”™**
  
  > ### eviction /ÉªËˆvÉªkÊƒÉ™n/   |TEM8
  >
  > - [N-VAR ](javascript:;)**Eviction** is the act or process of officially forcing someone to leave a house or piece of land. é©±é€

> åœ¨ä»¥åçš„å·¥ä½œä¸­ï¼Œé€‰æ‹©å“ªä¸€ç§æ›´åŠ åˆç†å‘¢ï¼Ÿ
>
> - ä»æ•ˆç‡çš„è§’åº¦å‡ºå‘ï¼šallkeys-random
> - ä»åˆç†æ€§çš„è§’åº¦ä»å‡ºå‘ï¼švolatile-lru
>
> é‚£ä¹ˆä¼˜å…ˆä¿è¯æ·˜æ±°çš„æ•ˆç‡è¿˜æ˜¯ä¿è¯æ·˜æ±°æ•°æ®çš„åˆç†æ€§å‘¢ï¼Ÿ
>
> - ä¸€èˆ¬æ˜¯ä¿è¯æ•ˆç‡ï¼Œå› ä¸ºä½¿ç”¨rediså°±æ˜¯ä¸ºäº†å¿«

NoSQLæ•°æ®åº“æ˜¯SQLçš„ä¸€ç§è¡¥å……ï¼Œä¸ç”¨æ‹…å¿ƒæ•°æ®ä»Redisåˆ é™¤æ‰ï¼Œå› ä¸ºè¿˜å­˜å‚¨åœ¨SQLä¸­ã€‚

 ğŸ·ï¸ä»€ä¹ˆæ ·çš„æ•°æ®é€‚åˆå­˜å‚¨åœ¨Redisä¸Šé¢å‘¢ï¼Ÿ

- ç”¨æˆ·ä¸æ•æ„Ÿçš„
- è®¿é—®é‡æ¯”è¾ƒå¤§çš„ï¼ˆé€Ÿåº¦è¦æ±‚æ¯”è¾ƒé«˜çš„ï¼‰

## 7. å®¢æˆ·ç«¯

Rediså’ŒMySQLä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªC/Sæ¶æ„çš„åº”ç”¨ã€‚

Redisä¹Ÿå’ŒMySQLæ˜¯ç±»ä¼¼çš„ï¼Œå­˜åœ¨å„ç§å„æ ·çš„å®¢æˆ·ç«¯ã€‚

### 7.1 å‘½ä»¤è¡Œå®¢æˆ·ç«¯

redis-client

### 7.2 å›¾å½¢åŒ–ç•Œé¢å®¢æˆ·ç«¯

AnnotherRedisDeskTopManagerã€‚

![image-20221020162526011](img/image-20221020162526011.png)

![image-20221020162820531](img/image-20221020162820531.png)

### 7.3 Javaå®¢æˆ·ç«¯

å®˜æ–¹æ¨èçš„Javaå®¢æˆ·ç«¯æ˜¯ï¼š

- Redisson
- Jedis

#### 7.3.1 Jedis

> Jediså…¨ç§°å«åšJava for Redisï¼Œä½¿ç”¨éå¸¸ç®€å•ï¼Œå› ä¸ºJedisçš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½å’ŒRedisçš„ç›¸å…³çš„å‘½ä»¤åå­—æ˜¯ä¸€è‡´çš„ã€‚

å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ

- å¯¼åŒ…

  ```xml
  <dependency>
      <groupId>redis.clients</groupId>
      <artifactId>jedis</artifactId>
      <version>2.9.0</version>
  </dependency>
  ```

- é…ç½®

  Jedisä¸éœ€è¦ä»»ä½•é…ç½®

- ä½¿ç”¨

  - åˆ›å»ºJediså¯¹è±¡ï¼ŒæŒ‡å®šIPåœ°å€å’Œç«¯å£å·
  
  - ä¸€åˆ‡æ–¹æ³•éƒ½æ˜¯Jediså¯¹è±¡æ¥è°ƒç”¨
  
- Jedisæ–¹æ³•åå’ŒRediså‘½ä»¤åä¸€è‡´

  ```java
   // 1. åˆ›å»ºä¸€ä¸ªJediså¯¹è±¡
          Jedis jedis = new Jedis("localhost",6379);
  
          // è®¤è¯å¯†ç 
          // jedis.auth("cskaoyan");
  
          // 2. ä½¿ç”¨Jedis
  //        String value = jedis.get("shuaige");
  //        System.out.println("value:" + value);
  
  //        jedis.hset()
  //        jedis.rpush
  //        jedis.sismember()
  //        jedis.zrank()
  //        jedis.zrevrank()
  ```


Jedisè™½ç„¶ç®€å•ï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é™ã€‚

#### 7.3.2 RedissonğŸ·ï¸ 

å’ŒJedisä¸åŒï¼ŒRedissonä¸ä»…ä»…å®ç°äº†æˆ‘ä»¬å‰é¢æ‰€å­¦ä¹ è¿‡å¾—æ‰€æœ‰çš„Rediså‘½ä»¤å¯¹åº”çš„åŠŸèƒ½ï¼Œå®ƒè‡ªå·±å¯¹Redisçš„åŠŸèƒ½åšäº†å¾ˆå¤šçš„å°è£…ï¼Œæä¾›äº†å¾ˆå¤š**æ›´ä¸ºå¥½ç”¨ï¼Œæ›´ä¸ºå¼ºå¤§**çš„åŠŸèƒ½ï¼Œæ¯”å¦‚**åŸºäºRediså®ç°çš„åˆ†å¸ƒå¼é”**ã€‚

ä½¿ç”¨Redissonæˆ‘ä»¬é¦–å…ˆéœ€è¦å¼•å…¥ä¾èµ–ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä½¿ç”¨Redissonäº†ã€‚

+ å¯¼åŒ…

```xml
<dependencies>
    <dependency>
        <groupId>org.redisson</groupId>
        <artifactId>redisson</artifactId>
        <version>3.11.1</version>
    </dependency>
</dependencies>
```

é¦–å…ˆï¼Œä½¿ç”¨Redissonè®¿é—®Redisä¹‹å‰ï¼Œæˆ‘ä»¬å¾—é¦–å…ˆæ„é€ å‡ºä¸€ä¸ªRedssonClientå¯¹è±¡

> éœ€è¦å‘Šè¯‰`RedissonClient`æ˜¯ä»€ä¹ˆæ¨¡å¼çš„Redisï¼Ÿ
>
> å•æœºæ¨¡å¼ï¼Œè¿˜æ˜¯å“¨å…µæ¨¡å¼ã€‚

```java
// 1. new å‡ºä¸€ä¸ªconfigå¯¹è±¡ï¼ŒConfigæ˜¯org.redissonåŒ…ä¸‹çš„
Config config = new Config();
// 2. é…ç½®Configå¯¹è±¡
SingleServerConfig serverConfig = config.useSingleServer()
        // è¿™é‡Œè®¾ç½®è®¿é—®Redisçš„åœ°å€
        .setAddress("redis://localhost:6379");

// è®¾ç½®åºåˆ—åŒ–æ–¹å¼ï¼Œä½¿ç”¨jacksonå®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–
config.setCodec(new JsonJacksonCodec());

// 3. åˆ›å»ºrediså®¢æˆ·ç«¯ è¯¥å¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œå°±ä¼šåƒredis-serverå‘èµ·è¿æ¥è¯·æ±‚
RedissonClient redissonClient = Redisson.create(config);
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedissonClientå¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™å°±ä¼šå‘Redis Serverå‘èµ·è¿æ¥è¯·æ±‚äº†ï¼Œæ‰€ä»¥å¦‚æœå’ŒRedis Serverå»ºç«‹è¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆRedissonClientå¯¹è±¡ä¹Ÿä¼šåˆ›å»ºå¤±è´¥ï¼

åˆ›å»ºå¥½RedissonClientå¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åŸºäºReidssonClientå¯¹è±¡å®ç°å¯¹Redisä¸­5ç§åŸºæœ¬æ•°æ®ç±»å‹çš„è®¿é—®äº†ã€‚

+ åœ¨è®¿é—®ä¸€ä¸ªç±»å‹çš„å€¼ä¹‹å‰ï¼Œæ€»æ˜¯è¦å…ˆè·å–`RBucket<>`å¯¹è±¡ï¼Œæœ‰ä¸€ä¸ªæ³›å‹è¡¨ç¤ºè®¿é—®çš„ç±»å‹å¯¹åº”çš„JAVAç±»å‹
+ `RBucket`å¯¹è±¡ï¼šæ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå®ƒå°±ä»£ç†äº†Rediså½“ä¸­keyå€¼ä¸ºnameçš„é”®å€¼å¯¹
+ å†™valueæ—¶ï¼ŒRBucketå¯¹è±¡ä¼šè‡ªåŠ¨æŠŠvalueä»Javaè¿›ç¨‹å‘é€ç»™Redis-Server

+ å†™valueæ—¶ï¼Œå› ä¸ºJAVAä¸­æœ‰å¼•ç”¨æ•°æ®ç±»å‹ï¼Œè€ŒRedis-Serveræ²¡æœ‰å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥RBucketä¼šåšç±»å‹è½¬æ¢ï¼Œåšä¸€ä¸ªåºåˆ—åŒ–ï¼Œå–å‡ºçš„æ—¶å€™ä¼šååºåˆ—åŒ–ã€‚
+ å½“è®¾ç½®`config.setCondec()`ä¸º`JsonJacksonCondec`æ—¶ï¼Œå¯ä»¥å°†å¯¹è±¡è½¬æ¢ä¸ºJsonå­—ç¬¦ä¸²

```java
/*
   è¯¥æ–¹æ³•ä¸»è¦æ¼”ç¤ºå¯¹äºRedisï¼Œstringç±»å‹æ•°æ®çš„è®¿é—®
*/ 
private static void string(RedissonClient redissonClient) {
/* 
     1. numberè¡¨ç¤ºStringç±»å‹çš„å€¼å¯¹åº”çš„Redisä¸­çš„key
     2. é€šè¿‡redissonClientè·å–å­˜æ”¾keyå¯¹åº”å€¼çš„Bucketæ¡¶
     3. æ¡¶ä¸­æ”¾çš„å°±æ˜¯keyå¯¹åº”çš„Redisä¸­çš„stringç±»å‹çš„å€¼
     4. å¯¹äºæ¡¶çš„åŸºæœ¬æ“ä½œå°±æ˜¯get/setï¼Œè·å–æ¡¶ä¸­çš„å€¼/è®¾ç½®æ¡¶ä¸­çš„å€¼
     5. å¯¹æ¡¶ä¸­å€¼çš„æ“ä½œéƒ½ç›¸å½“äºæ˜¯å¯¹Redisä¸­keyå¯¹åº”çš„stringç±»å‹çš„å€¼çš„æ“ä½œ

     */
    RBucket<Integer> bucket = redissonClient.getBucket("number");
    bucket.set(0);

    // è·å–å¯¹åº”çš„Stringæ•°æ®ç±»å‹çš„å€¼
   	Integer result = bucket.get();
    System.out.println(result);

    // è·å–objå¯¹åº”çš„å­˜æ”¾Stringç±»å‹å€¼çš„Bucketæ¡¶(è¿™é‡Œå…¶å®å¯¹è±¡è¢«è½¬åŒ–æˆäº†jsonå­—ç¬¦ä¸²)
    RBucket<Person> personBucket = redissonClient.getBucket("obj");
    Person person = new Person();
    person.setName("é•¿é£");
    // å‘æ¡¶ä¸­æ”¾å…¥å¯¹è±¡
    personBucket.set(person);

    // ä»æ¡¶ä¸­è·å–å¯¹è±¡
    Person newPerson = personBucket.get();
    System.out.println(newPerson.getName());

}
```

> `bucket.tryset()`ç­‰åŒäºRedisä¸­çš„`setnx`ï¼šä¸å­˜åœ¨keyæ—¶å†è®¾ç½®è¿”å›1ä»£è¡¨æˆåŠŸï¼Œå­˜åœ¨æ—¶è®¾ç½®å¤±è´¥è¿”å›0ã€‚ä¸ä¼šè¦†ç›–åŸæ¥çš„å€¼ã€‚è¿™ç§é€»è¾‘å¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚

è®¿é—®Listç±»å‹çš„å€¼

```java
private static void list(RedissonClient redissonClient) {

    /*
        1. è°ƒç”¨redissonClientçš„getListæ–¹æ³•ï¼Œæ ¹æ®æŒ‡å®šçš„keyè·å–Listç±»å‹çš„å€¼
        2. å¯¹äºæˆ‘ä»¬è€Œè¨€Listç±»å‹çš„å€¼å°±ç›¸å½“äºå†…å­˜ä¸­çš„ä¸€ä¸ªListï¼Œæ‰€ä»¥ä¹‹å‰æ€ä¹ˆè®¿é—®Listï¼Œç°åœ¨å®Œå…¨ä¸€æ ·
        3. Listä¸­å¯ä»¥æ”¾åŸºæœ¬æ•°æ®ç±»å‹åŠå…¶åŒ…è£…ç±»çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ”¾å¯¹è±¡
        4. å¦‚æœè¦ä¿®æ”¹Redisä¸­Listæ•°æ®ç±»å‹ä¸­çš„å…ƒç´ çš„å€¼ï¼Œè¿˜å¾—æŠŠä¿®æ”¹åçš„å…ƒç´ é‡æ–°è°ƒç”¨addæ–¹æ³•
           æ·»åŠ åˆ°Listæ‰è¡Œ
    */
    List<Person> list = redissonClient.getList("listKey");

    // ...

}
```

è®¿é—®Setç±»å‹çš„å€¼

```java
private static void set(RedissonClient redissonClient) {
/*
    1. è°ƒç”¨redissonClientçš„getListæ–¹æ³•ï¼Œæ ¹æ®æŒ‡å®šçš„keyè·å–Setç±»å‹çš„å€¼
    2. å¯¹äºæˆ‘ä»¬è€Œè¨€Listç±»å‹çš„å€¼å°±ç›¸å½“äºå†…å­˜ä¸­çš„ä¸€ä¸ªSetï¼Œæ‰€ä»¥ä¹‹å‰æ€ä¹ˆè®¿é—®Setï¼Œç°åœ¨å®Œå…¨ä¸€æ ·
    3. Setä¸­å¯ä»¥æ”¾åŸºæœ¬æ•°æ®ç±»å‹åŠå…¶åŒ…è£…ç±»çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ”¾å¯¹è±¡
    4. å› ä¸ºSetæ— åºï¼Œæ‰€ä»¥ä»ç„¶å’Œä¹‹å‰ä¸€æ ·ï¼Œå¯ä»¥ç”¨è¿­ä»£å™¨æˆ–è€…streamæµæ¥è®¿é—®
*/
	Set<String> set = redissonClient.getSet("setKey");
	set.add("setValue");

	Iterator<String> iterator = set.iterator();
	while (iterator.hasNext()) {
   	String next = iterator.next();
   	System.out.println(next);
	}
}
```

è®¿é—®SortedSetç±»å‹çš„å€¼

```java
 private static void sortedSet(RedissonClient redissonClient) {
    /*
       1. è°ƒç”¨RedissonClientçš„getScoredSortedSetè·å–æŒ‡å®škeyå¯¹åº”çš„ä¸€ä¸ªSortedSet
       2. Redissonç”¨RScoredSortedSetå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªSortedSetï¼Œè¯¥ç±»æ‰€æŒæœ‰çš„æ³›å‹è¡¨ç¤ºSortSetä¸­å…ƒç´ å¯¹
          åº”çš„Javaç±»å‹

       3. RScoredSortedSetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ç»‘å®šåˆ†æ•°ï¼Œæ‰€ä»¥æ·»åŠ çš„æ—¶å€™æ—¢è¦æ·»åŠ å…ƒç´ è¿˜è¦æ·»åŠ å…ƒç´ çš„score
       4. å¯ä»¥è·å–å…ƒç´ çš„åˆ†æ•°ï¼Œæ’å...
       5. RScoredSortedSetä¸­ä¹Ÿå¯ä»¥æ”¾Javaå¯¹è±¡

    */
    RScoredSortedSet<String> sortedSet
            = redissonClient.getScoredSortedSet("sortedKey");

    sortedSet.add(1.0, "zs");
    sortedSet.add(2.0, "lisi");

    Double score = sortedSet.getScore("zs");
    System.out.println(score);
    Integer rank = sortedSet.rank("zs");
    System.out.println(rank);
}
```

è®¿é—®hashæ•°æ®ç±»å‹çš„å€¼

```java
private static void map(RedissonClient redissonClient) {

    /*
        1. åœ¨redisä¸­è·å–åä¸ºmapKeyçš„åç§°çš„hashæ•°æ®ç»“æ„çš„å€¼
        2. è·å–åˆ°çš„æ˜¯ä¸€ä¸ªMapï¼Œå°±å¯ä»¥æŠŠå®ƒå½“åšå†…å­˜ä¸­çš„ä¸€ä¸ªMapï¼Œæ‰€ä»¥ä¹‹å‰æ€ä¹ˆç”¨Mapç°åœ¨è¿˜æ˜¯ä¸€æ ·
        3. Mapä¸­çš„keyä¸ºStringç±»å‹ï¼ŒValueå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹åŠå…¶åŒ…è£…ç±»çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡
        4. å¦‚æœè¦ä¿®æ”¹Redisä¸­hashæ•°æ®ç±»å‹ä¸­çš„å…ƒç´ çš„å€¼ï¼Œè¿˜å¾—æŠŠä¿®æ”¹åçš„å…ƒç´ é‡æ–°è°ƒç”¨Mapçš„putæ–¹æ³•
           æ·»åŠ åˆ°Mapä¸­æ‰è¡Œ
    */ 
  
    Map<String, String> map = redissonClient.getMap("mapKey");

    //         "field"      "value"
    // æ·»åŠ 
    map.put("mapField", "mapValue");
    // ä¿®æ”¹
    map.put("mapField", "v1");

   //è·å–
    String mapField = map.get("mapField");
    System.out.println(mapField);
   //åˆ é™¤
    map.remove("mapField");
}
```

