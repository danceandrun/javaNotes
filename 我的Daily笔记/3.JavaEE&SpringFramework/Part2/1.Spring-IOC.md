[TOC]

# å‰è¨€

## å­¦ä¹ ç›®æ ‡

1. æŒæ¡IOCå’ŒDIçš„æ¦‚å¿µ
2. ç†Ÿæ‚‰æ³¨å†Œç»„ä»¶çš„å‡ ç§æ–¹å¼å’Œç›¸å…³æ³¨è§£
3. ç†Ÿæ‚‰å–å‡ºç»„ä»¶çš„å‡ ç§æ–¹å¼å’Œç›¸å…³æ³¨è§£
4. ç†è§£Springç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„å«ä¹‰
5. ç†Ÿæ‚‰BeanPostProcessorçš„æ‰§è¡Œæ—¶æœº

## å‰ç½®çŸ¥è¯†å‡†å¤‡

- é¡¹ç›®ä¸€å¼€å‘çš„å¸¸ç”¨é£æ ¼
- æ³¨è§£çš„ç›¸å…³çŸ¥è¯†`@Target`ã€`@Retention`ã€å±æ€§
- ç†è§£å®¹å™¨çš„æ€æƒ³

> å®¹å™¨ï¼šç”¨æ¥ç®¡ç†å­˜å‚¨å¯¹è±¡çš„å¯¹è±¡
>
> å¼•å…¥å®¹å™¨çš„æ¦‚å¿µå°±ä¼šæœ‰â€œå­˜â€â€œå–â€ä¸¤ä¸ªå¤©ç”Ÿçš„æ“ä½œï¼Œè¿™é‡Œ`IOC`å°±æ˜¯â€œå­˜â€ï¼Œ`DI`å°±æ˜¯â€œå–â€ã€‚

Springçš„ä¸»è¦å­¦ä¹ å†…å®¹:

å¹²ä¸‰ä»¶äº‹ï¼Œâ€œå­˜ç»„ä»¶â€ ï¼Œâ€œç»´æŠ¤ç»„ä»¶å…³ç³»â€ï¼Œâ€œå–ç»„ä»¶â€

![Day13-Springé˜¶æ®µçš„ä¸‰å±‚æ¶æ„](.\assets\Day13-Springé˜¶æ®µçš„ä¸‰å±‚æ¶æ„.jpg)

# ä»‹ç»Spring

## SpringFrameworkçš„èµ·æº

Spring Frameworké€šå¸¸äººä»¬ç§°ä¹‹ä¸ºSpringã€‚

Springæ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼ŒSpringæ˜¯äº2003 å¹´å…´èµ·çš„ä¸€ä¸ªè½»é‡çº§çš„Java å¼€å‘æ¡†æ¶ï¼Œç”±**Rod Johnson** åœ¨å…¶è‘—ä½œã€ŠExpert One-On-One J2EE Development and Designã€‹ä¸­é˜è¿°çš„éƒ¨åˆ†ç†å¿µå’ŒåŸå‹è¡ç”Ÿè€Œæ¥ã€‚

å®ƒæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šåº”ç”¨å¼€å‘çš„å¤æ‚æ€§è€Œåˆ›å»ºçš„ã€‚æ¡†æ¶çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯å…¶**åˆ†å±‚æ¶æ„**ï¼Œåˆ†å±‚æ¶æ„å…è®¸ä½¿ç”¨è€…é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªç»„ä»¶ï¼ŒåŒæ—¶ä¸º J2EE åº”ç”¨ç¨‹åºå¼€å‘æä¾›é›†æˆçš„æ¡†æ¶ã€‚

Springæ˜¯ä¸€ä¸ªåˆ†å±‚çš„Java SE/EE full-stack(ä¸€ç«™å¼) è½»é‡çº§å¼€æºæ¡†æ¶ã€‚

Springçš„æ¶æ„å›¾ï¼š

![Spring5æ¡†æ¶](.\assets\Spring5æ¡†æ¶.png)

## <font color="red">â˜…IOCæ§åˆ¶åè½¬</font>

`Inverse of Control`

æ§åˆ¶åè½¬è¿™ä¸ªè¯è¦æ‹†å¼€æ¥çœ‹

**æ§åˆ¶ï¼š**å®ä¾‹çš„ç”Ÿæˆæƒ

**åè½¬ï¼š**ç”±åº”ç”¨ç¨‹åºåè½¬ç»™Springå®¹å™¨

**å®¹å™¨ï¼š**ç”Ÿæˆå¹¶ç®¡ç†å®ä¾‹çš„**æŠ½è±¡ç©ºé—´**

è·å–ä¾èµ–å¯¹è±¡è¢«åè½¬äº†ï¼Œå®ƒæ˜¯è¢«åŠ¨è·å–ï¼›æ­£è½¬å°±æ˜¯è‡ªå·±å»`new`ä¸€ä¸ªå¯¹è±¡ï¼Œè‡ªå·±è·å–å¯¹è±¡ã€‚

IOCæ˜¯ä¸€ç§æ€æƒ³ï¼Œè€ŒSpringå°†è¿™ç§æ€æƒ³å®ç°äº†ã€‚å…¶ä¸­Springæä¾›äº†IOCå®¹å™¨ã€‚

> 1. åº”ç”¨ç¨‹åºæ§åˆ¶ç”Ÿæˆä¹Ÿå°±æ˜¯ç›´æ¥`new`å¯¹è±¡
>
> ```java
> UserService userService = new UserServiceImpl();
> ```
>
> 2. `Springå®¹å™¨`å°±æ˜¯`IOCå®¹å™¨`
>
>    å…·ä½“æ¥è¯´è¿™ä¸ªå®¹å™¨å°±æ˜¯`applicationContext`
>
> 3. å®¹å™¨é‡Œçš„å¯¹è±¡å­˜å‚¨æ–¹å¼ï¼š`key-value`
>
> 4. å½“æˆ‘ä»¬ç»™å‡ºåŒä¸€ä¸ª`key`æ—¶ï¼Œå¸Œæœ›æ‹¿åˆ°åŒä¸€ä¸ªå®ä¾‹

## <font color="red">â˜…DIä¾èµ–æ³¨å…¥</font>

`Dependency Injection`

 Q1è°ä¾èµ–è°ï¼ŸQ2ä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–ï¼ŸQ3è°æ³¨å…¥è°ï¼ŸQ4æ³¨å…¥äº†ä»€ä¹ˆï¼Ÿ

> <font color=red>æ€è€ƒä¸Šé¢çš„é—®é¢˜ï¼Œä¸€å®šè¦åœ¨æ§åˆ¶åè½¬çš„åŸºç¡€ä¸Šå»æ€è€ƒã€‚</font>
>
> åº”ç”¨ç¨‹åº  VS `IOC`å®¹å™¨

<font color=red>æ€è€ƒçš„æ˜¯åº”ç”¨ç¨‹åºå’ŒSpringå®¹å™¨ä¹‹é—´çš„å…³ç³» ğŸ‘‰ ç»è¿‡äº†æ§åˆ¶åè½¬ï¼ŒSpringå®¹å™¨ï¼ˆIoCå®¹å™¨ï¼‰æŒæ¡äº†æ›´å¤šçš„å®ä¾‹ï¼Œå˜å¾—æ›´åŠ **å¯Œæœ‰**ï¼Œè€Œåº”ç”¨ç¨‹åºå˜å¾—**â€œè´«ç©·â€**</font>

Answer1  åº”ç”¨ç¨‹åºä¾èµ–äº`IoC`å®¹å™¨ï¼› 

Answer2  åº”ç”¨ç¨‹åºéœ€è¦`IoC`å®¹å™¨æ¥æä¾›å¯¹è±¡éœ€è¦çš„**å¤–éƒ¨èµ„æº**ï¼› 

Answer3  `IoC`å®¹å™¨æ³¨å…¥åº”ç”¨ç¨‹åºæŸä¸ªå¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºä¾èµ–çš„å¯¹è±¡ï¼› 

Answer4  æ³¨å…¥æŸä¸ªå¯¹è±¡æ‰€éœ€è¦çš„**å¤–éƒ¨èµ„æº**ï¼ˆ**åŒ…æ‹¬å¯¹è±¡ã€èµ„æºã€å¸¸é‡æ•°æ®**ï¼‰ï¼›

## Springçš„ä¼˜ç‚¹

- **æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘ï¼ˆé«˜å†…èšä½è€¦åˆï¼‰**
- **AOPç¼–ç¨‹çš„æ”¯æŒ**
- **å£°æ˜å¼ äº‹åŠ¡çš„æ”¯æŒ**
- æ–¹ä¾¿ç¨‹åºçš„æµ‹è¯•
- æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶

  - > Springå¾ˆåƒä¸€ä¸ªå¹³å°

- é™ä½JavaEE APIçš„ä½¿ç”¨éš¾åº¦

  - ä¸»è¦æ˜¯é™ä½äº†`Servlet`


## æ ¸å¿ƒæŠ€æœ¯

ä¾èµ–æ³¨å…¥ã€äº‹ä»¶ã€èµ„æº(resourcesåŠ è½½é…ç½®æ–‡ä»¶)ã€i18n(internationalisation)å›½é™…åŒ–ã€æ ¡éªŒã€æ•°æ®ç»‘å®šã€ç±»å‹è½¬æ¢ã€Spring Expression Languageã€AOP

## æ€è€ƒ

Springå’Œæˆ‘ä»¬ä¹‹å‰å¼€å‘çš„é¡¹ç›®çš„å…³è”

> åº”ç”¨ç¨‹åºä¸­ç»´æŠ¤`ApplicationContext`å¯¹è±¡
>
> åº”ç”¨ç¨‹åº**å¯åŠ¨**çš„æ—¶å€™å°±ç®¡ç†èµ·æ¥ï¼Œå°±åˆ›å»º`ApplicationContext` å¯¹è±¡
>
> 1. `ServletContextListener` â†’ `contextInitialized(ServletContextEvent sce)`
>
> 2. `new ApplicationContext` æ”¾åˆ°`servletContext`é‡Œé¢
>
> 3. éœ€è¦è·å¾—å®¹å™¨ä¸­çš„ç»„ä»¶ å…ˆè·å¾—`ServletContext` â†’ å†è·å¾—`ApplicationContext` â†’ å†`getBean`

# å…¥é—¨æ¡ˆä¾‹

## å…¥é—¨æ¡ˆä¾‹ä¸€

ä½¿ç”¨æ­¥éª¤ï¼š

1. å¼•å…¥ä¾èµ–
2. è·å–ä¿¡æ¯ï¼šåˆ›å»º**Springçš„é…ç½®æ–‡ä»¶**ï¼ˆä¿¡æ¯çš„è½½ä½“ï¼‰ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æ¥æä¾›å®ä¾‹ç›¸å…³çš„ä¿¡æ¯
3. åˆ›å»ºSpringå®¹å™¨ï¼Œè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œå®ä¾‹ä¹Ÿåœ¨å®¹å™¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­äº¤ç»™å®¹å™¨æ¥è¿›è¡Œç®¡ç†
4. ä»å®¹å™¨ä¸­å–å‡ºå®ä¾‹
   1. é€šè¿‡idè·å–`getBean(String)`
   2. é€šè¿‡ç±»å‹è·å–`getBean(Class)`
      1. å¯ä»¥ä½¿ç”¨æ¥å£ä¹Ÿå¯ä»¥ä½¿ç”¨å®ç°ç±»æ¥æ”¶ï¼Œå»ºè®®ä½¿ç”¨æ¥å£
      2. ä½¿ç”¨æ¡ä»¶ï¼šè¿™ä¸ªç±»å‹çš„å®ä¾‹åœ¨å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ª
   3. é€šè¿‡idå’Œç±»å‹æ¥è·å–`getBean(String,Class)`

### å¼•å…¥ä¾èµ–

å¼•å…¥ä¾èµ–`spring-context`(`Maven`ä¼šè‡ªåŠ¨å¼•å…¥`beans`ã€`aop`ã€`expression`ã€`core`ã€`jcl`) 

```xml
<dependencies>
    <!--å¼•å…¥ä¾èµ– beansã€contextã€aopã€expressionã€coreã€jcl 5+1-->
    <!--spring-context-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.2.5.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.12</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

![image-20230907090517155](.\assets\image-20230907090517155.png)



### æä¾›æ¥å£å’Œå®ç°ç±»

```java
public class UserDaoImpl implements UserDao{
    @Override
    public void sayHello() {
        System.out.println("hello xiaowu");
    }
}
```

åŸå…ˆä½¿ç”¨å®ä¾‹çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡`new`å¯¹è±¡åˆ›å»ºçš„ï¼›åç»­è¦å˜æ›´ä¸ºæ¥æºSpringå®¹å™¨ã€‚

### Springé…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ï¼šä¿¡æ¯çš„è½½ä½“

> é…ç½®æ–‡ä»¶çš„å­¦ä¹ ä¸»è¦å…³æ³¨é…ç½®æ–‡ä»¶çš„æ ‡ç­¾ç»“æ„ã€‚
>
> é…ç½®æ–‡ä»¶ä¸­å†™çš„æ ‡ç­¾ï¼š
>
> 1. æ ‡ç­¾æœ‰å“ªäº›
> 2. ä¸€ä¸ªæ ‡ç­¾ä¸­æœ‰å“ªäº›å±æ€§
> 3. æœ‰å“ªäº›å­æ ‡ç­¾
>
> åœ¨Springä¸­ï¼Œè¦æ¸…æ¥š`<bean>`æ ‡ç­¾ä»¥åŠå­æ ‡ç­¾`<property>`

[Schemaçº¦æŸ]: https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#xsd-schemas-context

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">

    <!-- bean definitions here -->

</beans>
```

åœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œç»„ä»¶

> 1. Springé…ç½®æ–‡ä»¶çš„åç§°é€šå¸¸å«`application(-xxx).xml`
> 2. **idå±æ€§** â†’ ç»„ä»¶åœ¨å®¹å™¨ä¸­çš„å”¯ä¸€æ ‡è¯†
> 3. **nameå±æ€§ ** â†’ åç§° â†’ é€šå¸¸çœç•¥ä¸å†™
> 4. **class å…¨ç±»å **â†’ å®ç°ç±»çš„å…¨ç±»å
> 5. **ç»„ä»¶æ³¨å†Œ** â†’ å°†å®ä¾‹äº¤ç»™Springç®¡ç†çš„è¿‡ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸ºæ³¨å†Œ

```xml
<bean id="userDao" class="com.cskaoyan.dao.UserDaoImpl"/>
```

### ä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶ï¼Œæ‰§è¡Œæ–¹æ³•

**æ³¨æ„ï¼šå–å‡ºç»„ä»¶çš„3ç§æ–¹å¼ï¼**

1.  `applicationContext.getBean(String) `â†’ æŒ‰ç…§ç»„ä»¶çš„åç§°ï¼ˆidï¼‰
2. `applicationContext.getBean(Class)` â†’ æŒ‰ç…§ç»„ä»¶çš„ç±»å‹(class)
3. `applicationContext.getBean(String, Class)` â†’ æŒ‰ç…§ç»„ä»¶çš„åç§°å’Œç±»å‹å…±åŒä½œç”¨ï¼ˆid å’Œ classï¼‰

```java
@Test
public void mytest(){
    // å®¹å™¨å…·ä½“çš„å­˜åœ¨ï¼šApplicationContext
    // åŠ è½½çš„æ˜¯classpathä¸‹çš„springé…ç½®æ–‡ä»¶
    ApplicationContext applicationContext =
        new ClassPathXmlApplicationContext("application.xml");
   
    // applicationContext.getBean(String) â†’ æŒ‰ç…§ç»„ä»¶çš„åç§°ï¼ˆidï¼‰
    UserDao userDao1 = (UserDao) applicationContext.getBean("userDao");
    // applicationContext.getBean(Class) â†’ æŒ‰ç…§ç»„ä»¶çš„ç±»å‹(class)
    // å¯ä»¥å†™æ¥å£çš„ç±»å‹ï¼Œä¹Ÿå¯ä»¥å†™å®ç°ç±»çš„ç±»å‹ â†’ å®¹å™¨å½“ä¸­è¯¥ç»„ä»¶çš„ç±»å‹åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼
    UserDao userDao2 = applicationContext.getBean(UserDao.class);
    // applicationContext.getBean(String,Class) â†’ æŒ‰ç…§ç»„ä»¶çš„åç§°å’Œç±»å‹å…±åŒä½œç”¨ï¼ˆidå’Œclassï¼‰
    UserDao userDao3 = applicationContext.getBean("userDao", UserDao.class);
    userDao1.sayHello();
    userDao2.sayHello();
    userDao3.sayHello();
}
```

æ¡ˆä¾‹ä¸€æ€»ç»“ï¼š

å¦‚ä½•æ”¾å…¥ç»„ä»¶ï¼Ÿé€šè¿‡`bean`æ ‡ç­¾

å¦‚ä½•å–å‡ºç»„ä»¶ï¼Ÿ`getBean`

å¦‚ä½•ç»´æŠ¤å®¹å™¨ä¸­æ‰€ç®¡ç†çš„å¤šä¸ªç»„ä»¶é—´çš„å…³ç³»ï¼Ÿè¯·çœ‹æ¡ˆä¾‹äºŒã€‚

## å…¥é—¨æ¡ˆä¾‹äºŒï¼šç»´æŠ¤ç»„ä»¶é—´çš„ä¾èµ–å…³ç³»

ç»´æŠ¤ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œåœ¨å®¹å™¨ä¸­**æ³¨å†Œ**daoå±‚å’Œserviceå±‚ç»„ä»¶ï¼Œå¹¶ä¸”serviceå±‚çš„ç»„ä»¶ä¾èµ–äºdaoå±‚ç»„ä»¶ï¼ˆè°éœ€è¦è°ï¼Œå°±æ˜¯è°ä¾èµ–è°ï¼‰

> â€œæ³¨å†Œâ€ï¼šæäº¤ç»„ä»¶çš„ä¿¡æ¯

### serviceç±»å’Œdaoç±»

é€šè¿‡åœ¨serviceç±»ä¸­å¢åŠ daoç±»æˆå‘˜å˜é‡ç»´æŠ¤ä¾èµ–å…³ç³»

```java
public class UserServiceImpl implements UserService{
    //ä¸»åŠ¨ â†’ æ§åˆ¶
    //UserDao userDao = new UserDaoImpl();
    UserDao userDao;

    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    public void serviceSayHello() {
        System.out.println("serviceå±‚çš„sayHello");
        userDao.sayHello();
    }
}
```

```java
public class UserDaoImpl implements UserDao{
    @Override
    public void sayHello() {
        System.out.println("hello xiaowu");
    }
}
```

### ç»´æŠ¤ç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»

 ğŸ·ï¸é€šè¿‡`property`æ ‡ç­¾çš„`ref`å±æ€§ç»´æŠ¤ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»

1. `name`å±æ€§å¯¹åº”çš„æ˜¯setæ–¹æ³•
2. `ref`å±æ€§å¯¹åº”çš„æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶id

```xml
<!-- bean definitions here -->
<bean id="userDao" class="com.cskaoyan.dao.UserDaoImpl"/>
<bean id="userService" class="com.cskaoyan.service.UserServiceImpl">
      <property name="userDao" ref="userDao"/>
</bean>
```

### å•å…ƒæµ‹è¯•

ç›´æ¥ä»å®¹å™¨ä¸­å–å‡ºserviceç»„ä»¶ï¼Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•

```java
@Test
public void mytest1(){
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext("application.xml");
    UserService userService = applicationContext.getBean(UserService.class);
    userService.serviceSayHello();
    UserDao userDao = applicationContext.getBean(UserDao.class);
}
```

<font color=red> æ³¨æ„:Â  ä¸€å®šæ˜¯ä»å®¹å™¨ä¸­å–å‡ºå¯¹åº”çš„ç»„ä»¶</font>

æ€è€ƒï¼šå³ä¾§åº”ç”¨ç¨‹åºä¸­çš„userDaoImplçš„å®ä¾‹æ˜¯å¦æ˜¯åŒä¸€ä¸ª

![image-20230907090600967](.\assets\image-20230907090600967.png)

# <font color="red">ğŸŒŸ æ³¨è§£</font>

> æ³¨è§£çš„ä¸¤ä¸ªä½œç”¨ï¼š
>
> + æ ‡è®°
> + æä¾›é¢å¤–ä¿¡æ¯

> æ³¨è§£ VS é…ç½®æ–‡ä»¶
>
> é…ç½®æ–‡ä»¶
>
> ä¼˜ç‚¹ï¼šå¯é…ç½®ï¼Œä¸ç”¨æ”¹æºç ï¼Œå¯ç®¡ç†æ€§å¼ºã€‚
>
> ç¼ºç‚¹ï¼šä¸ç›´è§‚ï¼Œå¼€å‘æ•ˆç‡ä½
>
> æ³¨è§£
>
> ä¼˜ç‚¹ï¼šç›´è§‚ï¼Œå¼€å‘æ•ˆç‡é«˜
>
> ç¼ºç‚¹ï¼šç¡¬ç¼–ç ï¼Œä¿®æ”¹ä¹‹åéœ€è¦é‡æ–°ç¼–è¯‘è¿è¡Œï¼Œéš¾ä»¥å’Œä»£ç è¿›è¡Œåˆ†å¼€ç®¡ç†ã€‚

ä½¿ç”¨æ­¥éª¤ï¼š

1. å¼•å…¥ä¾èµ–
2. è·å–ä¿¡æ¯ï¼šä¿¡æ¯çš„è½½ä½“æ˜¯JAVAç±»ä»¥åŠå¯¹åº”çš„æ³¨è§£ï¼Œä¹Ÿå°±æ˜¯**é…ç½®ç±»**
   1. é…ç½®ç±»ä¸­æä¾›ä¿¡æ¯ `@Bean`ï¼ˆåœºæ™¯ï¼šç¬¬ä¸‰æ–¹ä¾èµ–æä¾›çš„ç±»æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶ï¼‰
   2. é€šè¿‡ç±»ç›´æ¥æä¾›ä¿¡æ¯ `@Component`
3. åˆ›å»ºSpringå®¹å™¨ï¼Œè¯»å–é…ç½®ç±»ä¸­çš„ä¿¡æ¯ï¼ˆéœ€è¦è¯»å–é…ç½®ç±»çš„`ApplicationContext`çš„å®ç°ç±»ï¼‰
4. ç»´æŠ¤å®¹å™¨ä¸­çš„ç»„ä»¶ä¹‹é—´çš„å…³ç³»
5. ä»å®¹å™¨ä¸­è·å–å®ä¾‹

## é…ç½®ç±»

é…ç½®ç±»ï¼Œæ‰¿æ‹…åš**é€šç”¨é…ç½®**çš„åŠŸèƒ½ï¼ŒåŒæ—¶åœ¨é…ç½®ç±»ä¸­å¯ä»¥**ç»„ä»¶æ³¨å†Œ**

- åœ¨ç±»å®šä¹‰ä¸Šå¢åŠ ä¸€äº›åŠŸèƒ½æ€§çš„æ³¨è§£ï¼Œå¢åŠ ä¸€äº›é€šç”¨æ€§çš„é…ç½®
- åœ¨ç±»ä¸­çš„æ–¹æ³•é‡Œæ³¨å†Œç»„ä»¶

æ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé…ç½®ç±»ï¼Œéœ€è¦åœ¨ç±»ä¸Šå¢åŠ ä¸€ä¸ª`@Configuration`æ³¨è§£

```java
// è¿™é‡Œå¢åŠ åŠŸèƒ½æ€§çš„æ³¨è§£
@Configuration
public class SpringConfiguration {
    // ç±»ä¸­çš„æ–¹æ³•åšç»„ä»¶çš„æ³¨å†Œ
}
```

## ç»„ä»¶æ³¨å†ŒåŠŸèƒ½ï¼ˆIOCï¼‰

### ç±»ç›´æ¥æ³¨å†Œ

>  `@Component`ä½¿ç”¨æ­¥éª¤
>
> (1)  é…ç½®ä¸Šå¢åŠ ä¸€ä¸ªæ³¨è§£`@ComponentScan`åœ¨é‡Œé¢å†™åŒ…ç›®å½• â†’ æŠŠè¿™ä¸ªåŒ…ä»¥åŠå®ƒçš„å­åŒ…ä¸‹çš„æ‰€æœ‰çš„ç±»æ”¾åˆ°ä¸€ä¸ªé›†åˆé‡Œ
> (2)  åœ¨ä¸Šé¢é…ç½®çš„åŒ…ç›®å½•ä¸‹çš„ç±»ä¸Šå¢åŠ æ ‡è®° `@Component`  â†’ ç»„ä»¶æ³¨å†ŒåŠŸèƒ½çš„æ³¨è§£

ç»„ä»¶æ³¨å†ŒåŠŸèƒ½é¦–å…ˆè¦**æ‰“å¼€æ‰«æå¼€å…³**`@ComponentScan(åŒ…å)`

æ‰«æè¯¥åŒ…å’Œå­åŒ…ä¸‹çš„æ‰€æœ‰ç±»æ˜¯å¦æœ‰`@Component`æ³¨è§£

```java
// è¿™é‡Œå¢åŠ åŠŸèƒ½æ€§çš„æ³¨è§£ 
@Configuration
@ComponentScan("com.cskaoyan.demo1")
public class SpringConfiguration {
    // ç±»ä¸­çš„æ–¹æ³•åšç»„ä»¶çš„æ³¨å†Œ
}
```

ç»„ä»¶æ³¨å†ŒåŠŸèƒ½çš„æ³¨è§£`@Component`

```java
@Target(ElementType.TYPE)// è¯¥æ³¨è§£å†™åœ¨ç±»ä¸Š
@Retention(RetentionPolicy.RUNTIME)
public @interface Component {

   /**
    * The value may indicate a suggestion for a logical component name,
    * to be turned into a Spring bean in case of an autodetected component.
    * @return the suggested component name, if any (or empty String otherwise)
    */
   String value() default "";

}
```

- é™¤äº†`@Component`æ³¨è§£ï¼Œè¿˜æœ‰ä»€ä¹ˆç±»ä¼¼çš„æ³¨è§£ï¼Ÿ
- `@Service` â†’ é€šå¸¸æ˜¯Serviceå±‚çš„ç»„ä»¶ä½¿ç”¨çš„æ³¨è§£ï¼ŒServiceå±‚ç»„ä»¶ä¹Ÿèƒ½ä½¿ç”¨`@Component`
- `@Repository` â†’ é€šå¸¸æ˜¯Daoå±‚çš„ç»„ä»¶ä½¿ç”¨`@Repository`æ³¨è§£ï¼Œdaoå±‚ç»„ä»¶ä¹Ÿèƒ½ä½¿ç”¨`@Component`
- `@Configuration` â†’ é…ç½®ç±»ç»„ä»¶
- `@Controller`ï¼ˆSpringMVCé˜¶æ®µï¼‰
- ç­‰

`@Service`ã€`@Repository`ã€`@Controller`ã€`@Configuration`ï¼Œè¿™äº›æ³¨è§£çš„`ElementType`éƒ½æ˜¯`TYPE`ï¼Œä¹Ÿå°±æ˜¯è¿™äº›æ³¨è§£éƒ½æ˜¯è¦å†™åœ¨ç±»å®šä¹‰ä¸Šã€‚

 ğŸ·ï¸**é»˜è®¤ç»„ä»¶**`id`ï¼šç»„ä»¶`id`é»˜è®¤ä¸ºç±»åçš„é¦–å­—æ¯å°å†™ï¼Œå¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨**æ³¨è§£çš„`value`å±æ€§**æ¥æŒ‡å®šç»„ä»¶`id`

```java
//@Component
//@Repository("userDao")  //ç»„ä»¶idä¸ºuserDao
@Repository               //ç»„ä»¶idä¸ºuserDaoImpl
public class UserDaoImpl implements UserDao{
}
//@Component
@Service
public class UserServiceImpl implements UserService{
}
```

### é…ç½®ç±»æ³¨å†Œï¼ˆ`JavaConfig`ï¼‰`@Bean`

åœ¨é…ç½®ç±»ä¸­å®Œæˆå¯¹åº”çš„**ç»„ä»¶æ³¨å†Œ**ä»¥åŠ**ç›¸å…³é…ç½®**ï¼Œé…ç½®ç±»çš„æ ¸å¿ƒå°±æ˜¯æä¾›å¯¹åº”çš„ä¿¡æ¯ã€‚

> `JavaConfig` çš„ç›®æ ‡æ˜¯å¹²æ‰é…ç½®æ–‡ä»¶ï¼Œ`JavaConfig`ä¹Ÿæ˜¯`SpringBoot`**æ¨è**ä½¿ç”¨çš„é…ç½®æ–¹å¼ï¼Œ`SpringBoot`ä¸­ä¸å†ä½¿ç”¨`Spring`çš„`xml`é…ç½®æ–‡ä»¶

åœ¨é…ç½®ç±»ä¸­ï¼Œä½¿ç”¨æ³¨å†ŒåŠŸèƒ½çš„æ³¨è§£<span style='color:yellow;background:red;font-size:æ–‡å­—å¤§å°;font-family:å­—ä½“;'>**@Bean**</span> ä»¥åŠ<span style='color:yellow;background:red;font-size:æ–‡å­—å¤§å°;font-family:å­—ä½“;'>**æ–¹æ³•**</span>æ¥å®Œæˆç»„ä»¶æ³¨å†Œ

> å…³äº`@Bean`çš„å®šä¹‰ï¼š
>
> ```java
> @Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})
> @Retention(RetentionPolicy.RUNTIME)
> @Documented
> public @interface Bean {}
> ```
>
> è¯¥æ³¨è§£å¢åŠ åœ¨æ–¹æ³•ä¸Šï¼Œå¹¶ä¸”å¯ä»¥å’Œå…¶ä»–æ³¨è§£å…±å­˜

**è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶**

```java
/**
 * è¦é€šè¿‡è¿™ä¸ªæ–¹æ³•æ³¨å†Œä¸€ä¸ªDruidDataSourceç»„ä»¶
 * @return åº”è¯¥è¿”å›çš„æ˜¯ä¸€ä¸ªDruidDataSourceçš„å®ä¾‹ï¼Œè¿™ä¸ªè¿”å›å€¼ä¼šæ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶
 * è¿”å›å€¼çš„å®šä¹‰ï¼šå¯ä»¥å†™å®ç°ç±»ï¼Œä¹Ÿå¯ä»¥å†™æ¥å£ï¼›æä¾›ç»„ä»¶çš„ç±»å‹ä¿¡æ¯ç»™åˆ°å®¹å™¨ä¸­ï¼›å»ºè®®å†™æ¥å£
 * SEçš„ä»£ç é£æ ¼æ¥æä¾›å±æ€§å€¼å°±å¯ä»¥
 * é€šè¿‡è¿™ç§æ–¹å¼æ³¨å†Œçš„ç»„ä»¶idï¼š1ã€é»˜è®¤å€¼æ˜¯æ–¹æ³•åï¼›2ã€@Beanæ³¨è§£çš„valueå±æ€§å¯ä»¥æŒ‡å®šç»„ä»¶id
 */
@Bean
public DataSource dataSource(){
    DruidDataSource dataSource = new DruidDataSource();
    dataSource.setDriverClassName("com.mysql.jdbc.Driver");
    dataSource.setUrl("jdbc:mysql://localhost:3306/cskaoyan_db?useUnicode=true&characterEncoding=utf-8");
    dataSource.setUsername("root");
    dataSource.setPassword("123456");
    return dataSource;
}
```

æƒ³è¦é€šè¿‡`@Bean`æ³¨å†ŒComponent1è¿™ä¸ªç»„ä»¶

```java
public class Component1 {
    
    DataSource dataSource;

    public DataSource getDataSource() {
        return dataSource;
    }

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}
```

```java
/**
 * Component1è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ å«dataSourceéœ€è¦çš„æ˜¯ä¸€ä¸ªDataSourceç±»å‹çš„ç»„ä»¶
 * è®¾ç½®çš„è¿™ä¸ªDataSourceæƒ³è¦ä»å®¹å™¨ä¸­æ¥è·å¾—
 * å½¢å‚ï¼šé»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹ä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶çš„  ac.getBean(Class)
 * @return
 */
@Bean
public Component1 component1(DataSource dataSource) {
    Component1 component1 = new Component1();
    component1.setDataSource(dataSource);
    return component1;
}
```

é¢å¤–å¢åŠ ä¸€ä¸ª`DataSource`ç»„ä»¶çš„è¯ï¼Œå®¹å™¨ä¸­`DataSource`ç±»å‹çš„ç»„ä»¶ä¸æ­¢ä¸€ä¸ªï¼Œé€šè¿‡å½¢å‚ä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶éœ€è¦æŒ‡å®šç»„ä»¶`id`ã€‚

```java
@Bean
public DataSource dataSource2(){
    DruidDataSource dataSource = new DruidDataSource();
    dataSource.setDriverClassName("com.mysql.jdbc.Driver");
    dataSource.setUrl("jdbc:mysql://localhost:3306/cskaoyan_db2?useUnicode=true&characterEncoding=utf-8");
    dataSource.setUsername("root");
    dataSource.setPassword("123456");
    return dataSource;
}
```

Component1è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡å«dataSourceéœ€è¦çš„æ˜¯ä¸€ä¸ªDataSourceç±»å‹çš„ç»„ä»¶ï¼Œè®¾ç½®çš„è¿™ä¸ªDataSourceæƒ³è¦ä»å®¹å™¨ä¸­æ¥è·å¾—

 * **å½¢å‚**âš¡ï¼šé»˜è®¤æ˜¯**æŒ‰ç…§ç±»å‹**ä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶çš„  `ac.getBean(Class)`

 * å¦‚æœå½¢å‚æ‰€éœ€çš„ç»„ä»¶åœ¨å®¹å™¨ä¸­ä¸æ­¢ä¸€ä¸ªï¼Œéœ€è¦é¢å¤–æŒ‡å®šç»„ä»¶`id`çš„ä¿¡æ¯ â†’ `@Qualifier` çš„`value`å±æ€§æŒ‡å®šç»„ä»¶`id`

 * å½¢å‚çš„åç§°ä¹Ÿå¯ä»¥ä½œä¸ºç»„ä»¶çš„idï¼Œä½†æ˜¯æˆ‘ä»¬æ›´å»ºè®®ä½¿ç”¨`@Qualifier` ï¼Œæ›´ç›´è§‚ä¸€äº›


```java
@Bean
public Component1 component1(@Qualifier("dataSource2") DataSource dataSource) {
    Component1 component1 = new Component1();
    component1.setDataSource(dataSource);
    return component1;
}
```

`@Bean`æ³¨è§£éœ€è¦æ³¨æ„**è¿”å›å€¼ç±»å‹ã€æ–¹æ³•åã€å½¢å‚ã€è¿”å›å€¼ã€`@Bean`æ³¨è§£çš„`value`å±æ€§** åˆ†åˆ«ä»£è¡¨çš„å«ä¹‰ã€‚

![Beanæ³¨è§£](.\assets\Beanæ³¨è§£.jpg)

> æ€è€ƒï¼š
>
> æ³¨å†Œç»„ä»¶æ—¶æœ‰ä¸¤ç§æ³¨è§£æ–¹å¼ï¼š
>
> 1. `@Bean`æ³¨å†Œç»„ä»¶ï¼›
> 2. `@Component`è¿™æ ·çš„æ ‡è®°çš„æ–¹å¼æ³¨å†Œç»„ä»¶ã€‚
>
> ä½¿ç”¨æ—¶åº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ
>
> `@Component`è¿™æ ·çš„æ³¨è§£å¢åŠ åœ¨ç±»ä¸Šï¼Œå…¶å®å¾ˆæ–¹ä¾¿ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ¨èä½¿ç”¨çš„æ–¹å¼ï¼›ä½†æ˜¯æœ‰äº›ç±»ä¸ŠåŠ ä¸äº†æ³¨è§£ï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹çš„ç±»ã€‚è¿™æ˜¯å› ä¸ºæ‹¿åˆ°ç¬¬ä¸‰æ–¹çš„ç±»å·²ç»æ˜¯ç»è¿‡ç¼–è¯‘çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨`@Bean`çš„æ–¹å¼æ¥æ³¨å†Œç»„ä»¶äº†ï¼Œåœ¨æ³¨è§£ä¿®é¥°çš„æ–¹æ³•é‡Œé€šè¿‡`new`å¯¹è±¡ç„¶åé€šè¿‡`set`æ–¹æ³•å®Œæˆä¸€äº›å‚æ•°è®¾ç½®ã€‚
>
> å¦‚æœç»„ä»¶æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥ä½¿ç”¨`@Bean`
>
> æ€»çš„æ¥è¯´ï¼Œæœ‰ä¸€ä¸‹ä¸¤ç§åœºæ™¯ï¼š
>
> å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼š`@Component`
>
> é…ç½®è¿‡ç¨‹ä¸­ï¼š`@Bean`

## ç»„ä»¶æ³¨å…¥åŠŸèƒ½ï¼ˆDIï¼‰

<font color="red">**æ³¨æ„ï¼šåªæœ‰æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å¤Ÿä½¿ç”¨æ³¨å…¥åŠŸèƒ½çš„æ³¨è§£**</font>

å–å‡ºç»„ä»¶çš„æ–¹æ³•

1. `ApplicationContext`çš„ `getBean`æ–¹æ³•
2. ä½¿ç”¨æ³¨è§£ï¼ˆåº•å±‚ä»ç„¶æ˜¯`getBean`æ–¹æ³•ï¼‰
   1. ç»´æŠ¤ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»
      1. `@Bean`çš„å½¢å‚
      2. æ„é€ å™¨æ³¨å…¥
      3. æ–¹æ³•æ³¨å…¥
      4. æˆå‘˜å˜é‡æ³¨å…¥

### JavaConfigçš„`@Bean`

æ–¹æ³•çš„å½¢å‚ï¼Œå°±æ˜¯ä»å®¹å™¨ä¸­å–å‡ºçš„ç»„ä»¶

### æ„é€ å™¨æ³¨å…¥

ç±»ä¸­æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªç±»ä¸Šç»„ä»¶æ³¨å†ŒåŠŸèƒ½çš„æ³¨è§£ï¼Œä¼šä½¿ç”¨æœ‰å‚æ„é€ æ–¹æ³•æ¥å®Œæˆå®ä¾‹åŒ–ã€‚

æœ‰å‚æ„é€ æ–¹æ³•çš„å½¢å‚ä¼šä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶

```java
@Component
public class Component2 {
    DataSource dataSource;

    public Component2(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}
```

Component2 ä¸­æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•ï¼Œå°±ä¼šä½¿ç”¨æœ‰å‚æ„é€ æ–¹æ³•æ¥å®Œæˆå®ä¾‹åŒ–

- é»˜è®¤æ˜¯**æŒ‰ç…§ç±»å‹**ä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶

- å¦‚æœ**è¿™ä¸ªç±»å‹çš„ç»„ä»¶åœ¨å®¹å™¨ä¸­ä¸æ­¢ä¸€ä¸ª**ï¼Œå¯ä»¥ä½¿ç”¨**`@Qualifier`æŒ‡å®šç»„ä»¶id**(<del>å½¢å‚åç§°ä¹Ÿå¯ä»¥ä½†ä¸å»ºè®®</del>)

  - å¦åˆ™ä¼šäº§ç”Ÿå¼‚å¸¸ï¼š`NoUniqueBeanDefinitionException:`
  - ä½¿ç”¨`@Qualifier`æŒ‡å®šç»„ä»¶id

  - ```java
    @Component
    public class Component2 {
      DataSource dataSource;
    
      public Component2(@Qualifier("dataSource1") DataSource dataSource) {
        this.dataSource = dataSource;
      }
    }
    ```

- å…¶ä¸­çš„å¸¸é‡å€¼å¯ä»¥é€šè¿‡`@Value`æ³¨è§£æ¥æä¾›

  - ```java
    public UserServiceImpl(UserDao userDao,@Value("zhangsan") String name) {
      this.userDao = userDao;
      this.name = name;
    }
    ```

- å¦‚æœæœ‰å¤šä¸ªæœ‰å‚æ„é€ æ–¹æ³•ï¼Œéœ€è¦æŒ‡å®šæ„é€ æ–¹æ³•

  - ```java
    @Service
    public class UserServiceImpl implements UserService{
      UserDao userDao;
      String name;
    
      public UserServiceImpl(UserDao userDao,@Value("zhangsan") String name) {
        this.userDao = userDao;
        this.name = name;
      }
      @Autowired
      public UserServiceImpl(UserDao userDao) {
        this.userDao = userDao;
      }
    }
    ```


### æ–¹æ³•æ³¨å…¥ `@Autowired`

å¯ä»¥æ˜¯ç»„ä»¶ä¸­çš„ä»»æ„æ–¹æ³•ï¼Œä½†æ˜¯**é€šå¸¸è¿™æ ·çš„æ–¹æ³•æˆ‘ä»¬ç”¨çš„æ˜¯`set`æ–¹æ³•**ï¼Œ**åœ¨æ–¹æ³•ä¸Šå¢åŠ `@Autowired`æ³¨è§£**

é»˜è®¤è¿™ä¸ªæ–¹æ³•å¹¶ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œ

å¦‚æœæˆ‘ä»¬åœ¨ä¸Šé¢å¢åŠ äº†`@Autowired `æ³¨è§£çš„è¯ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸ**è®¾ç½®å±æ€§å€¼**çš„è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨æ‰§è¡Œ

å½¢å‚é»˜è®¤æŒ‰ç…§ç±»å‹ä»å®¹å™¨ä¸­å–å‡ºï¼›å¦‚æœè¦æŒ‡å®šç»„ä»¶`id` ï¼Œè¿˜æ˜¯`@Qualifier`

```java
@Component
public class Component3 {
    DataSource dataSource;

    @Autowired
    public void setDataSource(@Qualifier("dataSource2") DataSource dataSource) {
        this.dataSource = dataSource;
    }
}
```

ï¼ˆsetï¼‰æ–¹æ³•è¿™ç§å½¢å¼æ˜¯Springæ¡†æ¶å»ºè®®ä½¿ç”¨çš„æ–¹å¼ï¼Œä½†å…¶å®ç»å¤§éƒ¨åˆ†ç¨‹åºå‘˜ç”¨çš„éƒ½ä¸æ˜¯è¿™ç§æ–¹å¼

### æˆå‘˜å˜é‡æ³¨å…¥

æ³¨å…¥åŠŸèƒ½çš„æ³¨è§£ä½¿ç”¨è¿™ä¸‰ç»„ï¼š

1. **`@Autowired`**
2. **`@Autowired` + `@Qualifier`**
3. **`@Resource`**

å®¹å™¨ä¸­æ³¨å†Œäº†è¿™äº›ç±»å‹çš„ç»„ä»¶ï¼ŒOrderDaoç±»å‹çš„ç»„ä»¶ï¼ˆorderDaoImplï¼‰ã€UserDaoç±»å‹çš„ç»„ä»¶userDaoImpl1å’ŒuserDaoImpl2

```java
@Repository
public class OrderDaoImpl implements OrderDao{
}

@Repository
public class UserDaoImpl1 implements UserDao{
}

@Repository
public class UserDaoImpl2 implements UserDao{
}
```

ä»å®¹å™¨ä¸­å–å‡ºçš„å¯¹åº”çš„ç»„ä»¶ï¼Œæ‰§è¡Œæ³¨å…¥ï¼Œè¦æ³¨æ„ï¼Œ**è¦æ±‚æ˜¯åœ¨å®¹å™¨ä¸­çš„ç»„ä»¶é‡Œæ³¨å…¥**

```java
/**
 * è¦ä½¿ç”¨æ³¨å…¥åŠŸèƒ½æ³¨è§£ï¼Œä¸€å®šè¦ä¿è¯å½“å‰ç±»æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶
 */
@Service
public class UserServiceImpl implements UserService{
  
  	// å®¹å™¨ä¸­è¯¥ç±»å‹çš„ç»„ä»¶åªæœ‰ä¸€ä¸ª  
  	@Autowired 
    OrderDao orderDao;
  
  	// ä½¿ç”¨@Qualifieræ³¨è§£æŒ‡å®šç»„ä»¶id
    @Autowired 
    @Qualifier("userDaoImpl1")
    UserDao userDao1;
  
  	// é»˜è®¤æ˜¯æŒ‰ç…§ç»„ä»¶çš„ç±»å‹å»æ³¨å…¥ï¼Œä½¿ç”¨nameå±æ€§æŒ‡å®šç»„ä»¶id
    @Resource(name = "userDaoImpl2") 
    UserDao userDao2;
}
```

### <span style='color:yellow;background:red;font-size:æ–‡å­—å¤§å°;font-family:å­—ä½“;'>**æ³¨æ„äº‹é¡¹**</span>

- å¼€å‘ä¸šåŠ¡ä»£ç è¿‡ç¨‹ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ–¹å¼åªä½¿ç”¨ä¸€ä¸ª`@Autowired `ï¼šç»å¤§éƒ¨åˆ†ç»„ä»¶åœ¨å®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ç»„ä»¶åªæœ‰ä¸€ä¸ª
- è¦åœ¨å®¹å™¨ä¸­çš„ç»„ä»¶ä¸­ä½¿ç”¨è¿™äº›æ³¨è§£ï¼Œä½¿ç”¨æ³¨è§£çš„è¯ï¼Œæ‰€å¤„çš„ç±»ä¸Šè¦æœ‰ç»„ä»¶æ³¨å†ŒåŠŸèƒ½çš„æ³¨è§£ï¼Œä¸”å¤„äºæ‰«æåŒ…ç›®å½•ä¸­
- ç»´æŠ¤çš„æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ä¹‹é—´çš„å…³ç³»

## Springçš„å•å…ƒæµ‹è¯•

ç›´æ¥ä½¿ç”¨æ³¨è§£ï¼Œä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶ï¼š

1. å¼•å…¥`spring-test`ä¾èµ–

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-test</artifactId>
    <version>5.2.5.RELEASE</version>
    <scope>test</scope>
</dependency>
```

2.  ğŸ·ï¸ ä½¿ç”¨`@Runwith(SpringJUnit4ClassRunner.class)`å’Œ`@ContextConfiguration("classpath:application.xml")`æ³¨è§£ï¼Œåœ¨å•å…ƒæµ‹è¯•ç±»ä¸­å¯ä»¥ä½¿ç”¨æ³¨å…¥åŠŸèƒ½çš„æ³¨è§£


```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("classpath:application.xml")
public class MyTest2 {

    @Autowired
    UserService userService;
    @Autowired
    OrderDao orderDao;
    @Autowired
    @Qualifier("userDaoImpl1")
    UserDao userDao1;
    /**
     * ä»å®¹å™¨ä¸­å–å‡ºUserServiceç»„ä»¶
     * æŸ¥çœ‹userServiceç»„ä»¶ä¸­çš„æˆå‘˜å˜é‡æ˜¯å¦å–å‡ºå®¹å™¨ä¸­çš„ç»„ä»¶
     */
    @Test
    public void mytest1(){

    }
}
```

> å¾é—®ï¼š
>
> åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œæˆ‘åœ¨æµ‹è¯•ç±»ä¸­ä½¿ç”¨ç»„ä»¶ï¼Œéœ€è¦åœ¨æµ‹è¯•ç±»ä¸ŠåŠ `@SpringBootTest`æ³¨è§£å’Œ`@RunWith`æ³¨è§£ï¼Œå¯æ˜¯æœ‰çš„æ—¶å€™`@RunWith`æ³¨è§£è°ƒä¸å‡ºæ¥ï¼Œè¯·å¸®æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸¤ä¸ªæ³¨è§£ï¼Œä»¥åŠä¸ºä»€ä¹ˆéœ€è¦åŠ ä¸Šä»–ä»¬ï¼Ÿ
>
> GPTç­”ï¼š
>
> åœ¨Spring Booté¡¹ç›®ä¸­ï¼Œ`@SpringBootTest` å’Œ `@RunWith` æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„æµ‹è¯•æ³¨è§£ï¼Œå®ƒä»¬ç”¨äºä¸åŒçš„ç›®çš„ã€‚è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šè¿™ä¸¤ä¸ªæ³¨è§£çš„ä½œç”¨ï¼š
>
> 1. **@SpringBootTest æ³¨è§£ï¼š**
>    - `@SpringBootTest` æ˜¯ Spring Boot æä¾›çš„æµ‹è¯•æ³¨è§£ä¹‹ä¸€ï¼Œå®ƒç”¨äºæ ‡è¯†ä¸€ä¸ªæµ‹è¯•ç±»æ˜¯ Spring Boot æµ‹è¯•ç±»ã€‚å½“ä½ åœ¨æµ‹è¯•ä¸­ä½¿ç”¨äº† `@SpringBootTest` æ³¨è§£æ—¶ï¼ŒSpring Boot ä¼šå°è¯•åŠ è½½æ•´ä¸ªåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„é…ç½®å’Œ Beanã€‚è¿™æ ·ä½ å°±å¯ä»¥åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ Spring çš„ä¾èµ–æ³¨å…¥å’Œå…¶ä»–åŠŸèƒ½ã€‚
>    - é€šè¿‡ `@SpringBootTest` æ³¨è§£ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ Spring Boot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶ï¼Œç¡®ä¿æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ä¸å®é™…åº”ç”¨ç›¸ä¼¼çš„ä¸Šä¸‹æ–‡ã€‚
>
> 2. **@RunWith æ³¨è§£ï¼š**
>    - `@RunWith` æ˜¯JUnitæä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œå®ƒç”¨äºæŒ‡å®šä½¿ç”¨å“ªä¸ªæµ‹è¯•è¿è¡Œå™¨æ¥æ‰§è¡Œæµ‹è¯•ç±»ã€‚æµ‹è¯•è¿è¡Œå™¨è´Ÿè´£æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼Œå¹¶æä¾›ä¸€äº›æµ‹è¯•ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ç‚¹ã€‚
>    - åœ¨ Spring Boot ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ `SpringRunner.class` ä½œä¸º `@RunWith` æ³¨è§£çš„å‚æ•°ã€‚`SpringRunner` æ˜¯ Spring æä¾›çš„ JUnit è¿è¡Œå™¨ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»º Spring çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨æµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œä¸€äº›å¿…è¦çš„æ“ä½œï¼Œä¾‹å¦‚æ¸…ç†æ•°æ®åº“ç­‰ã€‚
>
> ç»¼åˆä½¿ç”¨è¿™ä¸¤ä¸ªæ³¨è§£çš„ä¾‹å­ï¼š
>
> ```java
> import org.junit.runner.RunWith;
> import org.springframework.boot.test.context.SpringBootTest;
> import org.springframework.test.context.junit4.SpringRunner;
> 
> @RunWith(SpringRunner.class) // æŒ‡å®šä½¿ç”¨ SpringRunner è¿è¡Œå™¨
> @SpringBootTest
> public class YourSpringBootTest {
> 
>     // æµ‹è¯•æ–¹æ³•...
> 
> }
> ```
>
> è¿™é‡Œçš„ `@RunWith(SpringRunner.class)` æ˜¯å‘Šè¯‰ JUnit ä½¿ç”¨ SpringRunner è¿è¡Œå™¨ï¼Œè€Œ `@SpringBootTest` åˆ™è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª Spring Boot æµ‹è¯•ç±»ã€‚é€šè¿‡è¿™ä¸¤ä¸ªæ³¨è§£çš„ç»„åˆï¼Œä½ å¯ä»¥åœ¨æµ‹è¯•ä¸­è·å¾— Spring Boot æä¾›çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°è¿›è¡Œé›†æˆæµ‹è¯•ã€‚

# Beançš„å‡†å¤‡

## Beançš„å®ä¾‹åŒ–

### æ— å‚æ„é€ æ–¹æ³•<font color=red>ï¼ˆé»˜è®¤æ–¹å¼ï¼‰</font>

è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹å¼

```java
/**
 * æ— å‚æ„é€ æ–¹æ³•
 */
@Data //æä¾›äº†getterå’Œsetteræ–¹æ³•ï¼Œä»¥åŠé‡å†™äº†toStringæ–¹æ³•
@NoArgsConstructor //å¢åŠ æ— å‚æ„é€ æ–¹æ³•ï¼Œé»˜è®¤å­˜åœ¨æ— å‚æ„é€ ï¼Œè¯¥æ³¨è§£ä¹Ÿå¯ä»¥ä¸å†™
public class Bean1 {
    String parameter1;
    String parameter2;
}
```

å¯¹åº”çš„é…ç½®æ–‡ä»¶

```xml
<!--æ„é€ æ–¹æ³•å®Œæˆå®ä¾‹åŒ–-->
<!--æ— å‚æ„é€ æ–¹æ³• ğŸ‘‰ é»˜è®¤ä½¿ç”¨çš„æ— å‚æ„é€ æ–¹æ³•-->
<bean id="bean1" class="com.cskaoyan.bean.Bean1">
    <property name="parameter1" value="xiaowu"/>
    <property name="parameter2" value="male"/>
</bean>
```

å…¶ä¸­çš„å‚æ•°ï¼Œå¯ä»¥é€šè¿‡`<property>`æ ‡ç­¾ä½¿ç”¨åˆ°`set`æ–¹æ³•æ¥æä¾›

### æœ‰å‚æ„é€ æ–¹æ³•

```java
/**
 * æœ‰å‚æ„é€ æ–¹æ³•
 */
@Data
@AllArgsConstructor //å¢åŠ æœ‰å‚æ„é€ æ–¹æ³•
public class Bean2 {
    String parameter1;
    String parameter2;
}
```

å¯¹åº”çš„é…ç½®æ–‡ä»¶

```xml
<!--æœ‰å‚æ„é€ æ–¹æ³•-->
<bean id="bean2" class="com.cskaoyan.bean.Bean2">
    <!--nameå±æ€§å¯¹åº”çš„æ˜¯æœ‰å‚æ„é€ æ–¹æ³•çš„å‚æ•°å-->
    <constructor-arg name="parameter1" value="xiaofang"/>
    <constructor-arg name="parameter2" value="female"/>
</bean>
```

å…¶ä¸­çš„å‚æ•°ï¼Œé€šè¿‡`<constructor-arg>`æ ‡ç­¾ä½¿ç”¨`set`æ–¹æ³•æä¾›ã€‚

### å·¥å‚

å·¥å‚æä¾›å®ä¾‹ï¼Œè€Œå®ä¾‹äº¤ç»™Springå®¹å™¨æ¥è¿›è¡Œç®¡ç†

> å®¹å™¨ï¼š
>
> + `BeanFactory`æœ€ä¸Šå±‚çš„æ¥å£
>
> + `ApplicationContext`
>   + `FileSystemXmlApplicationContext` æ–‡ä»¶è·¯å¾„ä¸‹çš„xmlé…ç½®æ–‡ä»¶
>   + `ClassPathXmlApplicationContext` classpathè·¯å¾„ä¸‹çš„xmlé…ç½®æ–‡ä»¶
>   + `AnnotationConfigApplicationContext` é…ç½®ç±» (`@Configuration`)
>
> ç»„ä»¶ï¼š
>
> + æ³¨å†Œç»„ä»¶ï¼šæä¾›ç»„ä»¶ç›¸å…³çš„ä¿¡æ¯
>   + xml è§£æxmlæ–‡ä»¶
>   + é…ç½®ç±» ï¼šè§£æè¿™ä¸ªç±»ï¼ˆä½¿ç”¨åå°„ï¼Œç±»ã€æ–¹æ³•ã€æˆå‘˜å˜é‡éƒ½æœ‰ä¸€ä¸ªæ–¹æ³•åˆ¤æ–­æ˜¯å¦æœ‰æ³¨è§£(`isAnnotationPresent`)ï¼Œä¹Ÿæœ‰æ–¹æ³•å¾—åˆ°å…¶ä¸Šé¢çš„æ³¨è§£(`getAnnotation`)ï¼‰
> + ä¸ºä»€ä¹ˆè¦æ³¨å†Œç»„ä»¶ï¼šä¸ºäº†ä»¥å•ä¾‹çš„å½¢å¼ç®¡ç†å¯¹è±¡ï¼Œå› ä¸ºå¯¹è±¡é‡Œæœ‰ä¸€äº›æ–¹æ³•ï¼Œä¸ºäº†è°ƒç”¨è¿™äº›æ–¹æ³•éœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ªç±»æ˜¯å’Œæ•°æ®åº“ä¸€ä¸€å¯¹åº”çš„ï¼Œæ²¡æœ‰æ–¹æ³•å¯ä»¥ä¸æ³¨å†Œç»„ä»¶ã€‚

#### å·¥å‚

é€šè¿‡**é…ç½®ç±»**ä¸­çš„æ–¹æ³•ï¼Œæ–¹æ³•ä¸Šå¢åŠ `@Bean`æ³¨è§£ï¼Œè¯¥æ–¹æ³•çš„è¿”å›å€¼æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶

#### `FactoryBean`âš¡

> é‡‡ç”¨**å·¥å‚æ–¹æ³•**çš„è®¾è®¡æ¨¡å¼ã€‚
>
> æ˜¯Springç‰¹æ®Šå¤„ç†çš„ä¸€ç§æ¥å£ï¼Œä¸ºäº†é¼“åŠ±ç¬¬ä¸‰æ–¹æ³¨å†Œç»„ä»¶

+ `getObject()`
+ `getObjectTye()`

å®ç°`FactoryBean`æ¥å£ï¼Œç»„ä»¶ç±»å‹å’Œ`FactoryBean`æ¥å£ä¸­çš„`getObject`æ–¹æ³•çš„ç±»å‹ç›¸åŒ

```java
public interface FactoryBean<T> {
    String OBJECT_TYPE_ATTRIBUTE = "factoryBeanObjectType";

    @Nullable
    T getObject() throws Exception;

    @Nullable
    Class<?> getObjectType();

    default boolean isSingleton() {
        return true;
    }
}
```

æ¯”å¦‚è¦æ³¨å†Œä¸€ä¸ªUserç±»å‹çš„ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡Userå¯¹åº”çš„`FactoryBean`æ¥æ³¨å†Œç»„ä»¶ã€‚

```java
/**
 * ç›´æ¥æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶
 * FactoryBean ğŸ‘‰ XXXFactoryBean
 *             ğŸ‘‰ ç»„ä»¶ç±»å‹å’ŒFactoryBeanæ¥å£ä¸­çš„getObjectæ–¹æ³•ç›¸å…³
 * BeanFactoryå’ŒFactoryBeanï¼š
 *      BeanFactoryï¼šç”Ÿäº§çš„æ˜¯å®¹å™¨ä¸­çš„æ‰€æœ‰çš„ç»„ä»¶
 *      FactoryBeanï¼šç”Ÿäº§çš„æ˜¯ç‰¹å®šçš„ç»„ä»¶
 */
@Component
public class UserFactoryBean implements FactoryBean<User> {

    /**
     * å®Œæˆç»„ä»¶çš„å®ä¾‹åŒ–
     * @return ç»„ä»¶ç±»å‹å’Œè¿”å›å€¼ç›¸å…³
     * @throws Exception
     */
    @Override
    public User getObject() throws Exception {
        User user = new User();
        return user;
    }

    @Override
    public Class<?> getObjectType() {
        return User.class;
    }
}
```

<font color=red>æ³¨æ„ï¼šBeanFactoryå’ŒFactoryBeanä¹‹é—´çš„åŒºåˆ«</font>

#### æ€è€ƒ1

 ğŸ·ï¸**æˆ‘ä»¬åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨çš„å·¥å‚çš„æ–¹å¼ï¼Ÿ**

éš¾é“æˆ‘ä»¬ä¸æ˜¯ç›´æ¥ç”¨æ„é€ æ–¹æ³•æ›´æ–¹ä¾¿ä¹ˆï¼Œä¸ºå•¥è¿˜è¦ä½¿ç”¨å·¥å‚ï¼Ÿ

ç¡®å®ï¼Œä½¿ç”¨æ„é€ æ–¹æ³•æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æœ‰äº›æƒ…å†µç”¨ä¸äº†æ„é€ æ–¹æ³•ã€‚æ¯”å¦‚åŠ¨æ€ä»£ç†  `ProxyFactoryBean`

**ä½¿ç”¨æ„é€ å™¨è¦æä¾›å¤§é‡çš„å‚æ•°ï¼Œè€Œæä¾›å¤§é‡çš„å‚æ•°è¿‡ç¨‹åˆæ¯”è¾ƒç¹ç**ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸åœ¨ä½¿ç”¨ä¸€äº›æ¡†æ¶çš„æ—¶å€™ï¼Œä¼šç»™ä½ æä¾›ä¸€äº›å¯¹åº”çš„å·¥å‚ã€‚

ä¸€äº›æ¡†æ¶å·²ç»å†™å¥½äº†ä¸€äº›ä»£ç ï¼Œè¦åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ å¯¹Springæ¡†æ¶çš„æ”¯æŒï¼Œè¦å°†æ¡†æ¶ä¸­çš„ä¸€äº›æ ¸å¿ƒçš„å¯¹è±¡äº¤ç»™Springå®¹å™¨æ¥ç®¡ç†ï¼Œé€šå¸¸å°±ä¼šæä¾›ä¸€ä¸ª**æ¡†æ¶çš„æ‹“å±•åŒ…**ï¼Œæ‹“å±•åŒ…ä¸­æä¾›å¯¹åº”çš„å·¥å‚ï¼Œä½¿ç”¨å·¥å‚å¯ä»¥ç›´æ¥å°†è¿™ä¸ªæ¡†æ¶éœ€è¦çš„æ ¸å¿ƒå¯¹è±¡æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶ ã€‚æ¯”å¦‚`SqlSessionFactoryBean`ã€‚

> å·¥å‚ï¼šä¸»è¦å°±æ˜¯å¯¹å·²æœ‰çš„ä»£ç åšäº›æ‹“å±•

#### æ€è€ƒ2(å¸¸è§é¢è¯•âš¡ )

`BeanFactory`æ˜¯`ApplicationContext`çš„çˆ¶æ¥å£ï¼Œä¹Ÿå°±æ˜¯**å®¹å™¨æ¥å£** â†’ æ‰€æœ‰çš„ç»„ä»¶çš„ç”Ÿæˆå’Œç®¡ç†éƒ½é€šè¿‡å®ƒã€‚

`BeanFactory`å’Œ`FactoryBean`ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«

> è”ç³»ï¼šé€šè¿‡ä»–ä¸¤éƒ½å¯ä»¥å‘å®¹å™¨ä¸­æ³¨å†Œç»„ä»¶
>
> åŒºåˆ«ï¼š`BeanFactory`æ˜¯å®¹å™¨ï¼Œæ‰€æœ‰çš„ç»„ä»¶æ³¨å†Œéƒ½æ˜¯é€šè¿‡`BeanFactory`ï¼›è€Œ`FactoryBean`æ³¨å†Œçš„æ˜¯ç‰¹å®šçš„å•ä¸ªç»„ä»¶

## ä½œç”¨åŸŸ Scope

`Singleton`ï¼šå•ä¾‹ï¼Œæ¯ä¸€æ¬¡å–å‡ºç»„ä»¶éƒ½æ˜¯<font color=red>åŒä¸€ä¸ªç»„ä»¶</font>

`Prototype`ï¼šåŸå‹ï¼Œæ¯ä¸€æ¬¡å–å‡ºç»„ä»¶éƒ½æ˜¯<font color=red>å…¨æ–°çš„ç»„ä»¶</font>

é»˜è®¤å€¼æ˜¯<font color=red>singleton</font>ï¼Œæˆ‘ä»¬é€šå¸¸çœç•¥ä¸å†™ã€‚

`@Scope `ä½¿ç”¨`value`å±æ€§æŒ‡å®šä½œç”¨åŸŸã€‚

```java
@Component
@Scope("singleton")
public class SingletonBean {
}
@Component
@Scope("prototype")
public class PrototypeBean {
}
@Component
public class DefaultBean {
}
```

æ³¨å†Œ3ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«ç»™åˆ°ä¸åŒçš„scopeï¼Œç„¶åä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶å¤šæ¬¡ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¯åŒä¸€ä¸ªç»„ä»¶ï¼ˆæŸ¥çœ‹å†…å­˜åœ°å€ï¼‰

```java
@Test
public void mytest1(){
    ApplicationContext applicationContext = new AnnotationConfigApplicationContext(SpringConfiguration.class);
    SingletonBean bean1 = applicationContext.getBean(SingletonBean.class);
    SingletonBean bean2 = applicationContext.getBean(SingletonBean.class);
    SingletonBean bean3 = applicationContext.getBean(SingletonBean.class);
}

@Test
public void mytest2(){
    ApplicationContext applicationContext = new AnnotationConfigApplicationContext(SpringConfiguration.class);
    PrototypeBean bean1 = applicationContext.getBean(PrototypeBean.class);
    PrototypeBean bean2 = applicationContext.getBean(PrototypeBean.class);
    PrototypeBean bean3 = applicationContext.getBean(PrototypeBean.class);
}

@Test
public void mytest3(){
    ApplicationContext applicationContext = new AnnotationConfigApplicationContext(SpringConfiguration.class);
    DefaultBean bean1 = applicationContext.getBean(DefaultBean.class);
    DefaultBean bean2 = applicationContext.getBean(DefaultBean.class);
    DefaultBean bean3 = applicationContext.getBean(DefaultBean.class);
}
```

![Day14-Springæ¢³ç†](.\assets\Day14-Springæ¢³ç†.jpg)

## ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

### å‚è€ƒæ–‡æ¡£

+ [å¦‚ä½•è®°å¿† Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844904065457979405)

> é¡¹ç›®ä¸‰ä¸­åº”ç”¨åœ¨é…ç½®æ¶ˆæ¯ä¸­é—´ä»¶çš„`DefaultMQProducer`

### æ¦‚å¿µ

ç”Ÿå‘½å‘¨æœŸæŒ‡ç»„ä»¶åœ¨å®¹å™¨ä¸­è¦å®Œæˆå®ä¾‹åŒ–ï¼Œç»„ä»¶ä»å®ä¾‹åŒ–å¼€å§‹ç›´è‡³å¯ç”¨çŠ¶æ€ä¼šæ‰§è¡Œåˆ°å“ªäº›è¿‡ç¨‹ã€‚

å­¦Servletçš„æ—¶å€™å­¦è¿‡ç”Ÿå‘½å‘¨æœŸï¼ŒServletçš„ç”Ÿå‘½å‘¨æœŸï¼š`init`ã€`service`ã€`destroy`

- å‡†å¤‡é˜¶æ®µ
- æœåŠ¡é˜¶æ®µ
- é”€æ¯é˜¶æ®µ

å¯¹äºBeanï¼ˆå®¹å™¨ä¸­çš„ç»„ä»¶ï¼‰ï¼Œåœ¨å®¹å™¨ä¸­ä¹Ÿä¼šç»å†è¿™æ ·çš„ä¸€äº›é˜¶æ®µ

- å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç»„ä»¶åšå‡†å¤‡æ€§å·¥ä½œ
- ç»„ä»¶å¯ä»¥ä»å®¹å™¨ä¸­å–å‡ºï¼Œ**æä¾›æœåŠ¡**ï¼Œæ¯”å¦‚ä»å®¹å™¨ä¸­å–å‡ºuserServiceå®ä¾‹ï¼Œè°ƒç”¨å…¶sayHelloæ–¹æ³•
- å®¹å™¨å…³é—­ï¼Œç»„ä»¶åšé”€æ¯å·¥ä½œ

åœ¨ç‰¹å®šçš„æ—¶é—´æ‰§è¡Œä¸€ç³»åˆ—çš„æ–¹æ³•

### åˆå§‹åŒ–é˜¶æ®µçš„æ–¹æ³•

å•ä¾‹ç»„ä»¶åˆå§‹åŒ–ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Ÿå•ä¾‹å®¹å™¨åˆ›å»ºçš„æ—¶å€™å¼€å§‹åˆå§‹åŒ–

> 1. å®ä¾‹åŒ– 
>
> 2. è®¾ç½®å±æ€§å€¼
>    1. æ„é€ æ–¹æ³•æ³¨å…¥
>    2. æ–¹æ³•æ³¨å…¥
>    3. æˆå‘˜å˜é‡æ³¨å…¥
>    4. å¸¸é‡ä¹Ÿå¯ä»¥è®¾ç½®å±æ€§å€¼:`@Value`â†’åé¢SpringBootä½¿ç”¨
> 3. å®ç°3ä¸ª`xxxAware`æ¥å£ï¼Œä¸ºäº†è®©å½“å‰å¯¹è±¡è·å¾—ä¸€äº›å€¼ï¼Œå®ç°æ¥å£æ–¹ä¾¿ä¼ å…¥å€¼

1. Beançš„å®ä¾‹åŒ–

2. è®¾ç½®å‚æ•°æ–¹æ³•

3. `BeanNameAware`ã€`BeanFactoryAware`ã€`ApplicationContextAware`

   >  `setBeanName(String)`
   >
   >  `setBeanFactory(BeanFactory)`ï¼šæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥è·å¾—å…¶ä»–ç»„ä»¶
   >
   >  `setApplicationContext(ApplicationContext)`ï¼šæ˜¯`BeanFactory`çš„å­ç±»ï¼Œæ–¹æ³•æ›´ä¸°å¯Œ

4. `BeanPostProcessor`â­ çš„`postProcessBeforeInitialization`

   > 1. è¿™é‡Œçš„`post`æ˜¯æŒ‡å®ä¾‹åŒ–å®Œæˆä¹‹åçš„å¤„ç†å™¨
   > 2. åˆå§‹åŒ–ä¹‹å‰çš„è‡ªå®šä¹‰æ–¹æ³•
   > 3. ç¬¬ä¸‰æ–¹çš„ä¾èµ–ï¼Œä½¿ç”¨`@Bean`æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œé‡Œé¢çš„å€¼éœ€è¦æ›´æ”¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ç°æ¥å£`BeanPostProcessor`ç”¨æ–¹æ³•`postProcessBeforeInitialization`ä¿®æ”¹

5. `InitializingBean`çš„`afterPropertiesSet`æ–¹æ³•

6. è‡ªå®šä¹‰çš„initæ–¹æ³•

   > 5ã€6 ä¸ºåˆå§‹åŒ–
   >
   > è‡ªå®šä¹‰çš„`init`æ–¹æ³•æ³¨è§£ï¼š`@PostConstruct`
   >
   > `InitializingBean`çš„`afterPropertiesSet`æ–¹æ³•ï¼šé€šå¸¸æ˜¯ç¬¬ä¸‰æ–¹ä¾èµ–é‡‡ç”¨çš„åˆå§‹åŒ–æ–¹å¼

7. `BeanPostProcessor`çš„`postProcessAfterInitialization`

   >  åˆå§‹åŒ–ä¹‹åçš„è‡ªå®šä¹‰æ–¹æ³•


![image-20230907090711618](.\assets\image-20230907090711618.png)

### å®¹å™¨å…³é—­é˜¶æ®µçš„æ–¹æ³•

å•ä¾‹çš„ç»„ä»¶æ‰ä¼šæ‰§è¡Œåˆ°å¯¹åº”çš„æ–¹æ³•

1. å®ç°æ¥å£ï¼š`DisposableBean`çš„`destroy()`æ–¹æ³•

2. è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•ï¼šä½¿ç”¨çš„æ³¨è§£æ˜¯`PreDestory`

### ä½œç”¨åŸŸå¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“

`scope = singleton`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šåœ¨å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™å°±å¼€å§‹ç»„ä»¶çš„åˆå§‹åŒ–ã€‚å®é™…æ˜¯ä¸€ç§ç«‹å³åŠ è½½ï¼Œå¹¶ä¸”ä¼šæ‰§è¡Œé”€æ¯é˜¶æ®µã€‚

`scope = prototype`ï¼šåœ¨è·å–ç»„ä»¶çš„æ—¶å€™æ‰æ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼ˆæ‡’åŠ è½½ï¼‰ï¼Œæ¯è·å–ä¸€æ¬¡æ‰§è¡Œä¸€æ¬¡ç”Ÿå‘½å‘¨æœŸçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¸ä¼šé”€æ¯ã€‚

## ä»£ç 

ç¤ºä¾‹ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶

```java
/**
 *  ç»„ä»¶å¯ä»¥ä½¿ç”¨ä¹‹å‰è¦ç»è¿‡è¿™æ ·çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸ
 *  ç»„ä»¶å¯ä»¥ä½¿ç”¨ä¹‹å‰ï¼š
 *      singletonï¼šå®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™
 *      prototypeï¼šä»å®¹å™¨ä¸­å–å‡ºç»„ä»¶çš„æ—¶å€™ï¼ŒgetBean
 */
@Component
public class LifeCycleBean implements BeanNameAware, BeanFactoryAware, ApplicationContextAware,InitializingBean, DisposableBean {
  // å®ä¾‹åŒ–
  public LifeCycleBean(){
    System.out.println("1ã€beançš„å®ä¾‹åŒ–");
  }
  // å‚æ•°è®¾ç½®
  String parameter;
  
	@Autowired
  public void setParameter(String parameter) {
    System.out.println("2ã€è®¾ç½®å‚æ•°");
    this.parameter = parameter;
  }
  
  // Awareï¼šä¸ºç»„ä»¶ä¸­çš„æˆå‘˜å˜é‡æä¾›å‚æ•° â†’ BeanNameã€BeanFactoryã€ApplicationContext
  String beanName;
  BeanFactory beanFactory;
  ApplicationContext applicationContext;
  
  @Override
  public void setBeanName(String beanName) {
    System.out.println("3ã€BeanNameAware");
    this.beanName = beanName;
  }
  
  @Override
  public void setBeanFactory(BeanFactory beanFactory) throws BeansException {
    System.out.println("3ã€BeanFactoryAware");
    this.beanFactory = beanFactory;
  }
  
  @Override
  public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
    System.out.println("3ã€ApplicationContextAware");
    this.applicationContext = applicationContext;
  }

  @Override
  public void afterPropertiesSet() throws Exception {
    System.out.println("5ã€InitializingBeançš„afterPropertiesSetæ–¹æ³•");
  }
  
  @PostConstruct
  public void init(){
    System.out.println("6ã€è‡ªå®šä¹‰çš„initæ–¹æ³•");
  }

  @Override
  public void destroy() throws Exception {
    System.out.println("8ã€DisposableBeançš„destroy");
  }
  
  @PreDestroy
  public void customDestroy(){
    System.out.println("9ã€è‡ªå®šä¹‰çš„destroy");
  }

}
```

`BeanPostProcessor`ï¼š

1. å®ç°é€šç”¨æ€§çš„å¤„ç†
2. å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨åŠ¨æ€ä»£ç†
3. ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­æ‰ä¼šæœ‰æ•ˆâ­ ä¹Ÿå°±æ˜¯åŠ ä¸Š`@Component`æ³¨è§£
4. é‡Œé¢æœ‰ä¸¤ä¸ªæ–¹æ³•`postProcessorBeforeInitialization`å’Œ`postProcessorAfterInitialization`
5. æ–¹æ³•çš„å½¢å‚æœ‰ä¸¤ä¸ª`Object bean` `String beanName`
6. æ–¹æ³•çš„è¿”å›å€¼æ˜¯å½¢å‚ä¸­çš„beanï¼Œå¦‚æœæ˜¯å®ä¾‹è¡¨ç¤ºæ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œå¦‚æœæ˜¯nullè¡¨ç¤ºæ²¡æœ‰å¤„ç†

```java
// è¯¥ç»„ä»¶çš„beforeå’Œafteræ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼šé™¤äº†è¯¥ç»„ä»¶æœ¬èº«ä¹‹å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰ç»„ä»¶
// @return è¿”å›å®ä¾‹ï¼Œç»§ç»­ç”Ÿå‘½å‘¨æœŸï¼Œæ³¨å†Œåˆ°å®¹å™¨ä¸­çš„å®ä¾‹ï¼›å¦‚æœè¿”å›nullï¼Œè¿”å›ä¼ å…¥çš„å€¼ï¼Œç›¸å½“äºæ²¡æœ‰å¤„ç†
@Component
public class CustomBeanPostProcessor implements BeanPostProcessor {
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("4ã€BeanPostProcessorçš„beforeæ–¹æ³•");
        return bean;
    }

    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("7ã€BeanPostProcessorçš„afteræ–¹æ³•");
        return bean;
    }
}
```

## æ³¨æ„

<font color="red">æ³¨æ„ï¼šç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œä¸æ˜¯éƒ½ä¼šæ‰§è¡Œåˆ°çš„ï¼Œæœ‰äº›æ‰§è¡Œæ˜¯éœ€è¦æ¡ä»¶çš„ã€‚å¦å¤–è¦æ³¨æ„`BeanPostProcessor`çš„ä½œç”¨èŒƒå›´</font>

![Day15-ç”Ÿå‘½å‘¨æœŸ_AOP](.\assets\Day15-ç”Ÿå‘½å‘¨æœŸ_AOP.jpg)
