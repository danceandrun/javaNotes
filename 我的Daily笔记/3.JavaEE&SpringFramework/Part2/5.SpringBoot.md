[TOC]

# å‰è¨€

## å­¦ä¹ ç›®æ ‡

1. æŒæ¡IDEAä¸­åˆ›å»ºSpringBootåº”ç”¨ç¨‹åº
2. ç†è§£SpringBootä¸­`key=value`å½¢å¼é…ç½®æ–‡ä»¶
3. ç†è§£SpringBootåº”ç”¨ä¸­çš„`starter`ä¾èµ–åŠŸèƒ½
4. ç†è§£SpringBoot**çº¦å®šå¤§äºé…ç½®**åŸç†ï¼ˆé¢è¯•æ‹”é«˜ï¼‰
   1. æ€æ ·çœ‹æºç ï¼Ÿ
   2. æ‰“æ–­ç‚¹ï¼Œçœ‹æ‰§è¡Œæ ˆ

5. ç†Ÿæ‚‰æ­å»ºSpringBootåº”ç”¨åSpringMVCå’ŒMyBatisçš„ä½¿ç”¨

## å‰ç½®çŸ¥è¯†å‡†å¤‡

- Springé…ç½®ç±»æ³¨å†Œç»„ä»¶
- SpringMVCé…ç½®ç±»å’Œ`WebMvcConfigurer`æ¥å£
- Maven çˆ¶å·¥ç¨‹ä¸­çš„ `dependencyManagement`æ ‡ç­¾
  - ç‰ˆæœ¬çš„ç®¡ç†

- SpringMVCé™æ€èµ„æºæ˜ å°„é…ç½®

# SpringBootä»‹ç»

Springé˜¶æ®µæœ€å›°æ‰°å¤§å®¶çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ é…ç½® â†’ é…ç½®é­”é¬¼

- å¿«é€Ÿæ­å»ºä¸€ä¸ªç‹¬ç«‹çš„ç”Ÿäº§çº§åˆ«çš„Springåº”ç”¨
- å¿«é€Ÿå¼•å…¥é¡¹ç›®ç›¸å…³ä¾èµ–
- å¼€ç®±å³ç”¨ï¼Œçº¦å®šå¤§äºé…ç½®ï¼Œå¤§å¤šæ•°åº”ç”¨åªéœ€è¦æå°‘çš„Springé…ç½®
- å†…ç½®JavaEEå®¹å™¨ï¼Œå¯ä»¥ä»¥JaråŒ…çš„æ–¹å¼å¯åŠ¨
  - è¿è¡ŒjaråŒ…é‡Œçš„mainæ–¹æ³•


 ğŸ·ï¸<font color="red">**æ ¸å¿ƒç‚¹ï¼šçº¦å®šå¤§äºé…ç½®**</font>

æä¾›ä¸€äº›**çº¦å®šé¡¹**ï¼ˆå…¶å®å°±æ˜¯**é»˜è®¤å€¼**ï¼‰ï¼Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå‘å®¹å™¨ä¸­æ³¨å†Œé»˜è®¤ç»„ä»¶ã€‚â€œå¤§äºâ€æŒ‡çš„æ˜¯ç»å¤§æ•°æƒ…å†µä¸‹ä½¿ç”¨â€œçº¦å®šå€¼â€ã€‚

# åˆ›å»ºä¸€ä¸ªSpringBootåº”ç”¨

## [å®˜ç½‘](start.spring.io)

`start.spring.io`

é€‰æ‹©groupIdã€ArtifactIdã€ç‰ˆæœ¬å·ã€æ‰«æåŒ…ã€JDKç‰ˆæœ¬ã€é¡¹ç›®æ„å»ºæ–¹å¼ã€å¼€å‘è¯­è¨€ã€å¼•å…¥çš„å…¶ä»–ä¾èµ–æ¥åˆ›å»ºSpringBootåº”ç”¨ï¼Œç‚¹å‡»Generateä¼šä¸‹è½½ä¸€ä¸ªzipå‹ç¼©åŒ…ï¼Œè§£å‹å¼€å°±æ˜¯ä¸€ä¸ªSpringBootåº”ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªMavenå·¥ç¨‹ã€‚

![image-20230912091203327](.\assets\image-20230912091203327.png)

snapshotç‰ˆæœ¬ï¼šå¿«ç…§ç‰ˆï¼Œè¡¨ç¤ºå¼€å‘ç‰ˆæœ¬ï¼Œéšæ—¶å¯èƒ½ä¿®æ”¹ï¼Œä¸é€‰æ‹©ã€‚

ç‰ˆæœ¬é€‰æ‹©ç›®å‰å…ˆä½¿ç”¨2.x ç‰ˆæœ¬ï¼Œä¸é€‰é¢„è§ˆç‰ˆã€‚

 ğŸ·ï¸Package nameï¼šmainæ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œå«åš**å¯åŠ¨ç±»**ã€‚è¿™ä¸ªå°±æ˜¯é…ç½®å¯åŠ¨ç±»çš„åŒ…ç›®å½•ï¼Œä¹Ÿæ˜¯é»˜è®¤çš„**æ‰«æåŒ…ç›®å½•**ã€‚`@ComponentScan`å†™ä»€ä¹ˆè¿™é‡Œå¡«ä»€ä¹ˆã€‚

è§£å‹åä¼šåŒ…å«è¿™æ ·çš„æ–‡ä»¶ï¼ŒåŒ…å«<font color="red">**srcç›®å½•ã€pom.xmlæ–‡ä»¶**</font>ã€å¸®åŠ©æ–‡æ¡£ã€Gitå¿½ç•¥ç®¡ç†é…ç½®æ–‡ä»¶ã€Mavenç›¸å…³æ–‡ä»¶

Gitå¿½ç•¥ç®¡ç†é…ç½®æ–‡ä»¶åªæœ‰æ”¾åœ¨.gitæ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹æ‰ä¼šç”Ÿæ•ˆã€‚

![image-20230912091217826](.\assets\image-20230912091217826.png)

## IDEA

IDEAè„šæ‰‹æ¶å·¥å…·ã€‚

å…¶å®éœ€è¦çš„é…ç½®é¡¹å’Œåœ¨å®˜ç½‘ä¸Šåˆ›å»ºæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œåªä¸è¿‡é€‰æ‹©æ˜¯åœ¨IDEAä¸­é€‰æ‹©ï¼Œå¦å¤–å¯ä»¥é€‰æ‹©Projectå’ŒModuleçš„è·¯å¾„ã€‚

æ–°å»ºä¸€ä¸ªæ–°çš„Projectï¼Œé€‰æ‹©Spring Initializerã€‚é…ç½®é‡Œï¼Œå…¶ä¸­starter service URLå°±æ˜¯Springå®˜ç½‘åˆ›å»ºSpringBootåº”ç”¨çš„é“¾æ¥

![image-20230912091228987](.\assets\image-20230912091228987.png)

é€‰æ‹©åŸºæœ¬çš„é…ç½®é¡¹

![image-20230916095939648](.\assets\image-20230916095939648.png)

é€‰æ‹©èµ·æ­¥ä¾èµ–å’ŒSpringBootåº”ç”¨çš„ç‰ˆæœ¬

é€‰æ‹©Spring Web

![image-20230912091255339](.\assets\image-20230912091255339.png)

é…ç½®Projectå’ŒModuleè·¯å¾„

![image-20230912091324040](.\assets\image-20230912091324040.png)

é€‰æ‹©Finishçš„è¯ï¼Œå°±ä¼šåœ¨å¯¹åº”çš„ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å°†ä¸‹è½½ä¸‹æ¥çš„zipå‹ç¼©åŒ…è§£å‹åˆ°æŒ‡å®šç›®å½•ä¸‹ï¼Œé€šè¿‡åœ¨IDEAä¸­æ‰“å¼€å¯¹åº”çš„åº”ç”¨ã€‚

## SpringBootå·¥ç¨‹ç»“æ„

### `pom.xml`æ–‡ä»¶

#### `parent`æ ‡ç­¾

SpringBooté¡¹ç›®å¿…é¡»ç»§æ‰¿`spring-boot-starter-parent`ï¼Œå³æ‰€æœ‰çš„SpringBooté¡¹ç›®éƒ½æ˜¯`spring-boot-starter-parent`çš„å­é¡¹ç›®ã€‚`spring-boot-starter-parent`ä¸­å®šä¹‰äº†å¸¸ç”¨é…ç½®ã€ä¾èµ–ã€æ’ä»¶ç­‰ä¿¡æ¯ï¼Œä¾›SprongBooté¡¹ç›®ç»§æ‰¿ä½¿ç”¨ã€‚

![`parent`æ ‡ç­¾](.\assets\image-20230928201945995.png)

```xml
<parent> 
  <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.7.7</version>
    <relativePath/> <!-- lookup parent from repository -->
</parent>
```

æ‰€æœ‰çš„SpringBootåº”ç”¨éƒ½æœ‰è¿™æ ·çš„ä¸€ä¸ªçˆ¶å·¥ç¨‹ï¼Œ`parent`æ ‡ç­¾é‡Œæœ‰ä¸€ä¸ª`version`æ ‡ç­¾ï¼ŒSpringBootåº”ç”¨çš„ç‰ˆæœ¬å·ï¼Œä¿®æ”¹`version`æ ‡ç­¾é‡Œçš„å€¼å°±æ˜¯ä¿®æ”¹ä½¿ç”¨çš„ä½¿ç”¨SpringBootç‰ˆæœ¬ã€‚

> ä½¿ç”¨çˆ¶å·¥ç¨‹çš„è¯ï¼Œå¯ä»¥å…±äº«çˆ¶å·¥ç¨‹é‡Œçš„é…ç½® è¿™æ ·å°±å®ç°äº†**ç›¸åŒé…ç½®çš„è§£è€¦**ã€‚
>
> çˆ¶å·¥ç¨‹æ‰“åŒ…æ–¹å¼æ˜¯`pom`ï¼Œå¯ä»¥åœ¨æœ¬åœ°ä»“åº“é‡Œæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶
>
> çˆ¶å·¥ç¨‹ä¸­çš„æ ‡ç­¾
>
> - `dependencies` â†’ å­å·¥ç¨‹é‡Œä¼šå¼•ç”¨çˆ¶å·¥ç¨‹é‡Œçš„ä¾èµ–ï¼ŒSpringBootåº”ç”¨ä¸­å…¶å®æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªæ ‡ç­¾
> - `dependencyManagement` â†’ å†™çš„dependencyæ ‡ç­¾çš„å†™æ³•å’Œæˆ‘ä»¬å‰é¢çš„å†™æ³•æ˜¯ä¸€è‡´çš„ â†’ æä¾›çš„æ˜¯ä¾èµ–çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦‚æœçˆ¶å·¥ç¨‹ä¸­å†™äº†ä¸€ä¸ªä¾èµ–ï¼Œè€Œå­å·¥ç¨‹ä¸­ä¹Ÿå†™äº†ç›¸åŒçš„ä¾èµ–ï¼ˆ`groupid`å’Œ`artifactId`ä¸€è‡´ï¼‰
>   - å¦‚æœå­å·¥ç¨‹ä¸­çš„ä¾èµ–æ²¡æœ‰å†™ç‰ˆæœ¬å·ï¼Œå¤ç”¨çˆ¶å·¥ç¨‹ä¸­çš„ç‰ˆæœ¬å·
>   - å¦‚æœå­å·¥ç¨‹ä¸­çš„ä¾èµ–å†™äº†ç‰ˆæœ¬å·ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„è¿™ä¸ªç‰ˆæœ¬å·

#### `<dependency>`æ ‡ç­¾

![`<dependency>`æ ‡ç­¾](.\assets\image-20230928202813190.png)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

å’Œæˆ‘ä»¬ä¹‹å‰å†™çš„`dependency`æ ‡ç­¾æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œæ²¡æœ‰`<version>`æ ‡ç­¾ã€‚

ä½†å®é™…ä¸Šæœ‰ç‰ˆæœ¬ä¿¡æ¯çš„ï¼Œ ç‰ˆæœ¬å·æ˜¯ä»çˆ¶å·¥ç¨‹ï¼ˆçš„çˆ¶å·¥ç¨‹ï¼‰ä¸­çš„`<dependencyManagement>`ä¸­æ¥çš„ã€‚

```xml
<parent>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-dependencies</artifactId>
  <version>2.7.7</version>
</parent>
```

å¯ä»¥çœ‹åˆ°SpringBootçš„`pom.xml`é…ç½®æ–‡ä»¶æœ‰ä¸€ä¸ªçˆ¶æ ‡ç­¾æ˜¯`spring-boot-starter-parent`ï¼Œè€Œè¯¥æ ‡ç­¾å¯¹åº”çš„æ–‡ä»¶é‡Œåˆæœ‰ä¸€ä¸ªçˆ¶æ ‡ç­¾æ˜¯`spring-boot-dependencies`ã€‚è¿™æ ·å°±èµ·åˆ°ä¸€ä¸ªä¾èµ–ä¼ é€’çš„ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰SpringBootæœ‰ä¸€ä¸ªçˆ·çˆ·å·¥ç¨‹ï¼Œè¿™ä¸ªçˆ·çˆ·å·¥ç¨‹å°±æ˜¯ä¸“é—¨ç®¡ç†ä¾èµ–çš„ç‰ˆæœ¬ä¿¡æ¯çš„ã€‚

```xml
<dependencyManagement>
  <dependencies>
      <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
        <version>2.7.7</version>
      </dependency>
  </dependencies>
</dependencyManagement>
```

è¿™æ˜¯ä¸æ˜¯çº¦å®šå¤§äºé…ç½®ï¼Ÿæ˜¯ã€‚

å¼•å…¥ä¸€ä¸ªä¾èµ– `mysql-connector-java`

- ä¸å†™ç‰ˆæœ¬å·çš„æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ

  - ```xml
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
    ```

  - ![image-20230912091353873](.\assets\image-20230912091353873.png)

  - ```xml
    <properties>
        <mysql.version>8.0.31</mysql.version>
    </properties>
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>mysql</groupId>
                <artifactId>mysql-connector-java</artifactId>
                <version>${mysql.version}</version>
                <exclusions>
                    <exclusion>
                        <groupId>com.google.protobuf</groupId>
                        <artifactId>protobuf-java</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
        </dependencies>
    </dependencyManagement>
    ```

- å†™äº†ç‰ˆæœ¬å·çš„æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ

  - ```xml
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>5.1.47</version>
    </dependency>
    ```

æä¾›é»˜è®¤çš„ç‰ˆæœ¬å·ä¿¡æ¯ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ

å¼€å‘æ–¹ä¾¿ä¸€äº›ï¼Œä¿è¯äº†ä¸åŒä¸‰æ–¹ä¾èµ–ä¹‹é—´çš„å…¼å®¹æ€§(å› ä¸ºé»˜è®¤æä¾›çš„éƒ½æ˜¯ä¸ä¼šå¼•èµ·å†²çªçš„ï¼Œè‡ªå·±å†™ç‰ˆæœ¬å·æœ‰ç‰ˆæœ¬ä¸å…¼å®¹çš„é£é™©)ã€‚

### `starter`ä¾èµ–ä»‹ç»

èµ·æ­¥ä¾èµ–çš„ä½œç”¨å°±æ˜¯ä¾èµ–ä¼ é€’ã€‚

> å¼•å…¥çš„ä¾èµ–ä¸­ï¼Œ`artifactid`ä¸­æœ‰ä¸€ä¸ª`starter`è¿™æ ·çš„ä¸€ä¸ªè¯ï¼Œè¿™æ ·çš„ä¾èµ–å°±å«å…¶`starter`ä¾èµ–
>
> - `spring-boot-starter`  SpringBootæœ¬èº«çš„ä¾èµ–ï¼Œæ‰€æœ‰çš„SpringBootåº”ç”¨éƒ½æœ‰è¿™ä¸ªä¾èµ–
> - `spring-boot-starter-xxx` SpringBootå®˜æ–¹æä¾›çš„ä¾èµ–ï¼ˆ`<groupid> `æ ‡ç­¾å†…å®¹ä¸º `org.springframework.boot`ï¼‰ï¼Œæä¾›çš„æ˜¯SpringBootå¯¹`xxx`æŠ€æœ¯çš„æ”¯æŒ
>   - æ¯”å¦‚`spring-boot-starter-web `å°±æ˜¯SpringBootå¯¹`web`æŠ€æœ¯çš„æ”¯æŒ
>   - æ¯”å¦‚`spring-boot-starter-tomcat`å°±æ˜¯SpringBootå¯¹`Tomcat`çš„æ”¯æŒ
>   - æ¯”å¦‚`spring-boot-starter-json` å°±æ˜¯SpringBootå¯¹`Json` çš„æ”¯æŒ
> - `xxx-spring-boot-starter` ç¬¬ä¸‰æ–¹æ¡†æ¶æä¾›çš„ä¾èµ–ï¼Œæä¾›çš„æ˜¯SpringBootå¯¹`xxx`æŠ€æœ¯çš„æ”¯æŒ
>   - æ¯”å¦‚`mybatis-spring-boot-starter`ï¼ŒSpringBootå¯¹MyBatisæŠ€æœ¯çš„æ”¯æŒ
>   - æ¯”å¦‚`pagehelper-spring-boot-starter`

<span style='color:yellow;background:red;font-size:æ–‡å­—å¤§å°;font-family:å­—ä½“;'>**é€šå¸¸åœ¨SpringBootä¸­è¦ä½¿ç”¨æŸä¸€é¡¹æŠ€æœ¯ï¼Œåªéœ€è¦å¼•å…¥å…¶starterä¾èµ–å°±å¯ä»¥äº†**</span>

 â­ä¸ºä»€ä¹ˆå¼•å…¥å…¶`starter`ä¾èµ–å°±å¯ä»¥äº†ï¼Ÿå› ä¸º`starter`ä¾èµ–åšäº†ä¸¤ä»¶äº‹ï¼š

1. `starter`ä¾èµ–ä¸­**å…³è”äº†**å…¶ä»–ä¾èµ–ï¼Œå½“æˆ‘ä»¬å¼•å…¥`starter`ä¾èµ–çš„æ—¶å€™ï¼Œä¼šå°†è¯¥æŠ€æœ¯æ‰€éœ€è¦çš„å…¶ä»–çš„ä¾èµ–ä¸€åŒå¼•å…¥è¿›æ¥
   
   - â€‹	ä¸¾ä¸ªä¾‹å­ï¼šä½¿ç”¨mybatisçš„è¯ï¼Œå¼•å…¥`mybatis-spring-boot-starter`ï¼Œmybatisã€mybatis-springã€spring-jdbcéƒ½ä¼šè¢«å¼•å…¥è¿›æ¥
   
2. starterä¾èµ–ä¸­é€šå¸¸ä¼šåŒ…å«å¦å¤–ä¸€ä¸ªä¾èµ–`autoconfigure`ä¾èµ–

   - `autoconfigure`ä¾èµ–èƒ½å¤Ÿå¸®æˆ‘ä»¬åšè‡ªåŠ¨é…ç½®ï¼Œè‡ªåŠ¨é…ç½®é‡Œæœ€ä¸»è¦çš„æ˜¯è‡ªåŠ¨æ³¨å†Œé»˜è®¤çš„ç»„ä»¶


SpringBootåº”ç”¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ä¼šåŠ è½½ä¸€äº›è‡ªåŠ¨é…ç½®ç±»`XxxAutoConfiguration`

1. å¦‚ä½•åŠ è½½çš„ï¼Ÿä¸‹é¢æºç ã€‚
2. è‡ªåŠ¨é…ç½®ç±»é‡Œåšäº†ä»€ä¹ˆï¼Ÿ

>  ğŸ·ï¸ä¸¤ä¸ªé‡è¦çš„æ–‡ä»¶ï¼š
>
> 1. SpringBootçš„é…ç½®ç±»ä¿¡æ¯ä¿å­˜åœ¨ä»€ä¹ˆæ–‡ä»¶ä¸‹ï¼Ÿ`spring.factories`
> 2. SpringBootçš„é»˜è®¤é…ç½®ä¿¡æ¯ä¿å­˜åœ¨ä»€ä¹ˆæ–‡ä»¶ä¸‹ï¼Ÿ`spring-configuration-metadata.json`

### è‡ªåŠ¨é…ç½®ç±»é‡Œåšäº†ä»€ä¹ˆï¼Ÿ

> ä»¥`MybatisAutoConfiguration`ä¸ºä¾‹

`ConditionalOnXxx`ï¼šå½“æ»¡è¶³æ¡ä»¶çš„æ—¶å€™æ³¨è§£æ‰ä¼šç”Ÿæ•ˆ

`ConditionalOnMissingXxx`

 ğŸŒ°`@ConditionalOnClass({})`åº”ç”¨ç¨‹åºåŠ è½½åˆ°è¿™é‡Œçš„ç±»æ‰ä¼šç”Ÿæ•ˆ

 ğŸŒ°`@ConditionalOnSingleCandidate()`ï¼šå®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ç»„ä»¶åªæœ‰ä¸€ä¸ª

ğŸŒ° `ConditionalOnMissingBean`ï¼šå®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªç±»å‹çš„ç»„ä»¶çš„æ—¶å€™ï¼Œå…¶ä»–çš„æ³¨è§£ç”Ÿæ•ˆã€‚é€šå¸¸å’Œ`@Bean`ä¸€èµ·å‡ºç°ï¼Œè¡¨ç¤ºå¦‚æœå®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªç»„ä»¶æ³¨å†Œè¯¥ç»„ä»¶ï¼Œæ˜¯â€œçº¦å®šå¤§äºé…ç½®â€çš„ä¸€ç§è¡¨ç°ã€‚

`AutoConfigureAfter()`ï¼šåœ¨å…¶ä»–çš„é…ç½®ç±»å®Œæˆé…ç½®ä¹‹åï¼Œå†æ‰§è¡Œå½“å‰çš„é…ç½®ç±»ï¼Œæœ‰ä¸€ä¸ªå¼•ç”³æ³¨è§£ï¼š`AutoConfiguration` = `Configuration` + `AutoConfigureAfter` 

### å¯åŠ¨ç±»

![image-20230928204845344](.\assets\image-20230928204845344.png)

 ğŸ·ï¸å¯åŠ¨ç±»æœ‰ä¸€ä¸ªæ³¨è§£ï¼š`@SpringBootApplication`ã€‚

> è¿™ä¸ªæ³¨è§£ç­‰åŒäºä¸‰ä¸ªæ³¨è§£ï¼š
>
> `@SpringBootApplication` = `@SpringBootConfiguration` + `@EnableAutoConfiguration` + `@ComponentScan`
>
> + ğŸƒ`@SpringBootConfiguration`æ˜¯`@Configuration`çš„æ´¾ç”Ÿæ³¨è§£ï¼Œè·Ÿ`@Configuration`åŠŸèƒ½ä¸€è‡´ï¼Œæ ‡å¿—è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚åªä¸è¿‡`@SpringBootConfiguration`æ˜¯SpringBootçš„æ³¨è§£ï¼Œè€Œ`@Configuration`æ˜¯Springçš„æ³¨è§£ã€‚
>
> + ğŸƒ `@EnableAutoConfiguration`æ˜¯SpringBootè‡ªåŠ¨é…ç½®æ³¨è§£ï¼Œç­‰åŒäº`@AutoConfigurationPackage` + `@Import({AutoConfigurationImportSelector.class})`
>
>   +  ğŸƒ`AutoConfigurationPackage` æ˜¯**è‡ªåŠ¨æ‰«æåŒ…**çš„æ³¨è§£ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰«æä¸»ç±»æ‰€åœ¨åŒ…ä¸‹æ‰€æœ‰åŠ äº†æ³¨è§£çš„ç±»(`@Service`,`@Controller`)ï¼Œä»¥åŠé…ç½®ç±»(`@Configuration`)
>
>   +  ğŸƒ`@Import({AutoConfigurationImportSelector.class})`è¯¥æ³¨è§£ä¼šå¯¼å…¥`AutoConfigurationImportSelector`ç±»å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šä»`META-INF/spring.factories`æ–‡ä»¶ä¸­è¯»å–é…ç½®ç±»çš„åç§°åˆ—è¡¨
>
> + ğŸƒ `@ComponentScan` è¯¥æ³¨è§£ä¼šæ‰«æé¡¹ç›®ï¼Œè‡ªåŠ¨è£…é…ä¸€äº›é¡¹ç›®å¯åŠ¨éœ€è¦çš„Beanã€‚

 ğŸ·ï¸å¯åŠ¨ç±»çš„ä½œç”¨æ˜¯å¯åŠ¨æ•´ä¸ªé¡¹ç›®ã€‚

æ¯”å¦‚æ•´åˆSpringMVCä¹‹åå°±æ˜¯ä¸€ä¸ªwebé¡¹ç›®äº†ï¼Œè¿™ä¸ªwebé¡¹ç›®ä¸ä¾èµ–äºå¤–éƒ¨çš„Tomcatï¼Œå› ä¸ºè¿™ä¸ªSpringBootå†…éƒ¨è‡ªå¸¦ä¸€ä¸ªTomcatã€‚æ—¢ç„¶ä¸ä¾èµ–å¤–éƒ¨çš„Tomcatï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è°ƒç”¨è‡ªèº«çš„Tomcatè¿è¡Œé¡¹ç›®å‘¢ï¼Ÿå…¶å®å°±æ˜¯é€šè¿‡è¿è¡Œå¯åŠ¨ç±»ï¼Œè¿è¡Œå¯åŠ¨ç±»ä¹‹åå¯ä»¥è¿è¡Œå†…ç½®çš„Tomcatå®¹å™¨ï¼Œå¯åŠ¨webé¡¹ç›®ã€‚

 ğŸ·ï¸å¯åŠ¨ç±»å¯åŠ¨æ—¶ä¼šåšæ³¨è§£æ‰«æ(`@Controller`,`@Service`,`@Repository`)ï¼Œæ‰«æçš„ä½ç½®æ˜¯ï¼š**å¯åŠ¨ç±»æ‰€åœ¨åŒ…ä¸‹çš„æ‰€æœ‰æ³¨è§£**ã€‚æ‰€ä»¥è¦åœ¨å¯åŠ¨ç±»åŒçº§æˆ–åŒçº§åŒ…ä¸‹ç¼–å†™ä»£ç ã€‚

### é…ç½®æ–‡ä»¶

![image-20230928204614175](.\assets\image-20230928204614175.png)

resourcesæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„`application.properties`é…ç½®æ–‡ä»¶ã€‚

ç”±äºSpringBootæå¤§ç®€åŒ–äº†Springé…ç½®ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªapplication.propertiesé…ç½®æ–‡ä»¶ï¼Œä¸”Springçš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ä½¿å¾—å¤§éƒ¨åˆ†çš„é…ç½®éƒ½æœ‰ä¸€ä¸ªé»˜è®¤é…ç½®ï¼Œè¯¥æ–‡ä»¶çš„åŠŸèƒ½æ˜¯**è¦†ç›–é»˜è®¤é…ç½®ä¿¡æ¯**ï¼Œè¯¥æ–‡ä»¶ä¸å†™ä»»ä½•ä¿¡æ¯éƒ½å¯ä»¥å¯åŠ¨é¡¹ç›®ã€‚

>  ğŸƒæŸ¥çœ‹é…ç½®æ–‡ä»¶å¦‚ä½•è¦†ç›–SpringBooté¡¹ç›®çš„é»˜è®¤é…ç½®ï¼š
>
> [SpringBoot2.xåŸºç¡€ç¯‡ï¼šé…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºä»¥åŠä¼˜å…ˆçº§è¦†ç›– - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844904110928592909?from=search-suggest)

è€ŒSpringBooté¡¹ç›®é…ç½®æ–‡ä»¶æ”¯æŒä¸¤ç§æ ¼å¼ï¼š`application.properties`å’Œ`application.yml`

# `yaml`é…ç½®æ–‡ä»¶çš„ä½¿ç”¨

## è‡ªå®šä¹‰é…ç½®ç®€å•æ•°æ®

YAMLæ–‡ä»¶çš„æ‰©å±•åä¸º`.yml`æˆ–`.yaml`ï¼Œå®ƒçš„åŸºæœ¬è¦æ±‚æ˜¯ï¼š

1. å¤§å°å†™æ•æ„Ÿ
2. ä½¿ç”¨ç¼©è¿›ä»£è¡¨å±‚çº§å…³ç³»
3. ç›¸åŒçš„éƒ¨åˆ†åªä¼šå‡ºç°ä¸€æ¬¡

åŠŸèƒ½å’Œ`properties`ä¸€æ ·ï¼Œç”¨æ¥æä¾›é”®å€¼å¯¹ä¿¡æ¯ã€‚ç”±`properties`åˆ°`yml`æ–‡ä»¶çš„è½¬æ¢ï¼š

1. `properties`ä¸­çš„ç‚¹`.`å†™æˆå†’å·`:`+ æ¢è¡Œ+ ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼ç¼©è¿›
2. `properties`ä¸­çš„`=`ï¼Œå†™æˆå†’å·`:` + ç©ºæ ¼ç¼©è¿›
3. åŒä¸€çº§å†…å®¹è¦å¯¹é½ï¼Œç›¸åŒçš„å‰ç¼€è¦çœç•¥ã€‚ä¹Ÿå°±æ˜¯ç›¸åŒçš„å‰ç¼€è¦å†™åœ¨ä¸€èµ·ã€‚

æ¯”å¦‚ä½¿ç”¨`properties`æ–‡ä»¶é…ç½®tomcatç«¯å£ï¼š

```properties
server.port=8888
```

è€Œä½¿ç”¨`YAML`æ–‡ä»¶é…ç½®tomcatç«¯å£ï¼š

```YAML
server:
  port: 8888
```

`application.yml(properties)`ä¸»é…ç½®æ–‡ä»¶ï¼ŒSpringBootåº”ç”¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šè‡ªåŠ¨åœ¨`classpath`è·¯å¾„ä¸‹åŠ è½½è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸»é…ç½®æ–‡ä»¶æ¿€æ´»å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä»–çš„é…ç½®æ–‡ä»¶ `application-xxx.yml(properties)`ï¼Œæ¯”å¦‚`application-zhangsan.yml `è¿™ä¸ªé…ç½®æ–‡ä»¶çš„åç§°å°±å«zhangsanï¼Œå¦‚æœè¦æ¿€æ´»çš„è¯ï¼Œé€‰æ‹©zhangsan

è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š

![image-20230928220957978](.\assets\image-20230928220957978.png)

å¥½å¤„ï¼šç›¸åŒåŠŸèƒ½çš„é…ç½®é›†ä¸­

å¼Šç«¯ï¼šä¸å¤Ÿç›´è§‚

## è‡ªå®šä¹‰é…ç½®å¯¹è±¡

è¯­æ³•ï¼š

```yaml
å¯¹è±¡:
		å±æ€§å1: å±æ€§å€¼
		å±æ€§å2: å±æ€§å€¼
	
# æˆ–è€…
å¯¹è±¡ï¼š {å±æ€§å1: å±æ€§å€¼,å±æ€§å2: å±æ€§å€¼}
```

ç¤ºä¾‹ä»£ç ï¼š

```yaml
student:
  gender: female
  age: 10
  address: beijing
  
# æˆ–è€…
student: {gender: female,age:10,address:beijing}
```

> ç¬¬ä¸€ä¸ªå†™æ³•ä¸­ï¼Œå±æ€§åå‰é¢çš„ç©ºæ ¼ä¸ªæ•°ä¸é™ã€‚åœ¨yamlè¯­æ³•ä¸­ï¼Œç›¸åŒç¼©è¿›ä»£è¡¨åŒä¸€ä¸ªçº§åˆ«ï¼Œåªè¦æ¯ä¸ªå±æ€§å‰çš„ç©ºæ ¼æ•°ä¸€æ ·å³å¯ã€‚ç›¸åŒç¼©è¿›ä»£è¡¨åŒä¸€ä¸ªçº§åˆ«ã€‚

## è‡ªå®šä¹‰é…ç½®é›†åˆæ•°æ®

è¯­æ³•ï¼š

```YAML
é›†åˆ:
		- å€¼1
		- å€¼2
		
# æˆ–è€…
é›†åˆ: [å€¼1,å€¼2]
```

ç¤ºä¾‹ä»£ç ï¼š

```YAML
# åŸå¸‚
city:
	- beijing
	- tianjin
	- shanghai
	- chongqing
	
city: [beijing,tianjin,shanghai,chongqing]

# é›†åˆä¸­çš„å…ƒç´ æ˜¯å¯¹è±¡
students:
	- name: fengshang
		age: 18
		score: 100
	- name: qiaoqiao
		age: 19
		score: 88
		
```

> å€¼ä¸å‰é¢çš„`-`ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼

## `@Value`è¯»å–é…ç½®æ–‡ä»¶ç®€å•æ•°æ®

å¯ä»¥é€šè¿‡`@Value`æ³¨è§£å°†é…ç½®æ–‡ä»¶ä¸­çš„å€¼æ˜ å°„åˆ°ä¸€ä¸ªSpringç®¡ç†çš„Beançš„å­—æ®µä¸Šã€‚

### ä»é…ç½®æ–‡ä»¶å–å€¼

#### `@Value("${}")`

`@Value("${}")`ä»é…ç½®æ–‡ä»¶ä¸­å–å€¼ï¼Œç»™å½“å‰çš„æˆå‘˜å˜é‡èµ‹å€¼ï¼Œè¦å†™å…¨keyçš„åå­—ã€‚

æ¯”å¦‚åœ¨Controllerç»„ä»¶ä¸­æœ‰å¦‚ä¸‹ä»£ç ;

```java
@Controller
public class YmlController{
  @Value("${student.name}")
  private String name;
  
  @Value("${student.age}")
  private Integer age;
  
  @Value("${students[0].score}")
  privat double score;
}
```

ğŸ·ï¸ **æ‰“é€šäº†å®¹å™¨å½“ä¸­çš„ç»„ä»¶å’Œé…ç½®æ–‡ä»¶ä¹‹é—´çš„è”ç³»ã€‚**

> ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œ`@Value`åªèƒ½æ‹¿åˆ°ç®€å•æ•°æ®ï¼Œä¸èƒ½å–å¾—é›†åˆå’Œå¯¹è±¡ã€‚

è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šä½¿ç”¨`@ConfigurationProperties`æ³¨è§£

## `@ConfigurationProperties`è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å¯¹è±¡

é€šè¿‡`@ConfigurationProperties`å¯ä»¥å°†é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®è‡ªåŠ¨ä¸å®ä½“è¿›è¡Œæ˜ å°„ï¼Œè¿™æ ·å¯ä»¥å°†ymlæ–‡ä»¶ä¸­é…ç½®çš„å¯¹è±¡å±æ€§ç›´æ¥æ˜ å°„åˆ°Beanå½“ä¸­ã€‚

é…ç½®æ–‡ä»¶ï¼š

```yaml
user:
	id: 1001
	username: fengshang
	address:
		- beijing
		- tianjin
		- shanghai
		- chongqing
	grades:
		- subject: math
			score: 100
		- subject: english
			score: 90
```

å®ä½“ç±»

```java
@Data
public class Grade{
  private String subject;
  private Double score;
}
```

```java
@Data
@Controller
@ConfigurationProperties(prefix = "user")
public class YmlController{
  private Integer id;
  private String username;
  private List<String> address;
  private List<Grade> grades;
}
```

è¯´æ˜ï¼š

1. å¿…é¡»è¦åŠ åœ¨å®¹å™¨ä¸­çš„ç»„ä»¶ä¸Šï¼Œç»™è¿™ä¸ªç»„ä»¶çš„æˆå‘˜å˜é‡èµ‹å€¼ã€‚ï¼ˆæ³¨æ„è¦æœ‰setæ–¹æ³•ï¼‰
2. valueå±æ€§å’Œprefixå±æ€§ç­‰ä»·ï¼Œä½œä¸ºé…ç½®æ–‡ä»¶ä¸­çš„keyçš„å‰ç¼€
3. ç›¸å½“äºä½¿ç”¨å‰ç¼€ + æˆå‘˜å˜é‡åä½œä¸ºkeyä»é…ç½®æ–‡ä»¶ä¸­å–å€¼
4. æˆå‘˜å˜é‡åé‡‡ç”¨é©¼å³°å‘½åï¼Œé…ç½®æ–‡ä»¶æ˜¯ä¸‹åˆ’çº¿å°å†™å‘½åã€‚è½¬æ¢è§„åˆ™æ˜¯é©¼å³°å‘½åä¸­çš„å¤§å†™å˜ä¸ºçŸ­æ¨ªçº¿åŠ å°å†™ã€‚

è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šå°†æˆå‘˜å˜é‡é›†ä¸­çš„ç®¡ç†èµ·æ¥

#### å‚æ•°ç»„ä»¶é›†ä¸­ç®¡ç†å€¼

`XxxProperties`ç±»å°†å€¼é›†ä¸­ç®¡ç†èµ·æ¥æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶ã€‚åœ¨åˆ«çš„ç»„ä»¶ä¸­æœ‰è®¸å¤šä½¿ç”¨æ–¹å¼ï¼š

1. æ–¹æ³•å½¢å‚
2. æ„é€ å™¨
3. `@Autowired`æ³¨è§£

è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šæ³¨å†Œå‚æ•°ç»„ä»¶æ–¹å¼ä¸ä½¿ç”¨`@Component`ï¼Œè€Œæ˜¯åœ¨é…ç½®ç±»ä¸ŠåŠ `@EnableConfigurationProperties(XxxProperties.class)`

#### é…ç½®ç±»åŠ æ³¨è§£

`@EnableConfigurationProperties(XxxProperties.class)`åŠ åœ¨é…ç½®ç±»ä¸Šï¼Œå–ä»£åœ¨å‚æ•°ç±»ä¸ŠåŠ `@Component`æ³¨è§£ï¼Œä»è€Œæ³¨å†Œå‚æ•°ç±»ç»„ä»¶ï¼Œæ˜¯æºç ä¸­ä½¿ç”¨è¾ƒå¤šçš„æ–¹å¼ã€‚

## `yaml`æ–‡ä»¶ä¸­å ä½ç¬¦çš„ä½¿ç”¨

### ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å€¼

####  ğŸ·ï¸ç¼–å†™é…ç½®æ–‡ä»¶

```yaml
server:
	port: 8888
	
mnycongfig:
	myport: ${server.port}
```

####  ğŸ·ï¸è¯»å–é…ç½®æ–‡ä»¶

```java
@Controller
public class YmlController{
  @Value("${myconfig.myport}")
  private Integer port;
}
```

### ä½¿ç”¨æ¡†æ¶æä¾›çš„æ–¹æ³•

SpringBootæ¡†æ¶æä¾›äº†ä¸€äº›ç”Ÿæˆéšæœºæ•°çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ymlæ–‡ä»¶ä¸­ä½¿ç”¨ï¼š

| å‘½ä»¤                      | å«ä¹‰                              |
| ------------------------- | --------------------------------- |
| `${random.value}`         | ç”Ÿæˆç±»ä¼¼uuidçš„éšæœºæ•°ï¼Œæ²¡æœ‰"-"è¿æ¥ |
| `${random.uuid}`          | ç”Ÿæˆä¸€ä¸ªuuidï¼Œæœ‰çŸ­æ è¿æ¥          |
| `${random.int}`           | éšæœºå–æ•´å‹èŒƒå›´å†…çš„ä¸€ä¸ªå€¼          |
| `${random.int(10)}`       | éšæœºç”Ÿæˆä¸€ä¸ª10ä»¥å†…çš„æ•°            |
| `${random.int(100,200)}`  | éšæœºç”Ÿæˆä¸€ä¸ª100-200èŒƒå›´å†…çš„æ•°     |
| `${random.long}`          | éšæœºå–é•¿æ•´å‹èŒƒå›´å†…çš„ä¸€ä¸ªå€¼        |
| `${random.long(100,200)}` | éšæœºç”Ÿæˆé•¿æ•´å‹100-200èŒƒå›´å†…çš„å€¼   |

ç”¨æ³•å¦‚ä¸‹ï¼š

```yml
server:
	port: ${random.int(1024,9999)}
```

> ç³»ç»Ÿä¼šå ç”¨1024ä»¥å†…çš„ç«¯å£å·ï¼Œè€Œç«¯å£å·ä¸€èˆ¬æ˜¯4ä½æ•´æ•°ã€‚

## é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§

æ–‡ä»¶çš„ä½ç½®ï¼šä¼˜å…ˆçº§ç”±é«˜åˆ°ä½æ’åº

+ é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„`/config`å­ç›®å½•ä¸­

![image-20231004161825230](.\assets\image-20231004161825230.png)

+ é¡¹ç›®æ ¹ç›®å½•ä¸‹
+ é¡¹ç›®çš„resourcesä¸‹çš„`/config`å­ç›®å½•ä¸­
+ é¡¹ç›®resourcesç›®å½•ä¸­

å…¶ä¸­æ¯ä¸ªä½ç½®çš„`.properties`æ ¼å¼ä¼˜å…ˆçº§éƒ½æ¯”`.yaml`æ ¼å¼ä¼˜å…ˆçº§é«˜ã€‚

## bootstrapé…ç½®æ–‡ä»¶

`bootstrap.yml`é…ç½®æ–‡ä»¶ç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚

SpingBootç§æœ‰ä¸¤ç§å®¹å™¨å¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯`bootstrap`å’Œ`application`ï¼Œ`bootstrap`æ˜¯åº”ç”¨ç¨‹åºçš„çˆ¶å®¹å™¨ï¼Œ`bootstrap`åŠ è½½ä¼˜å…ˆäº`application`ã€‚`bootstrap`é…ç½®æ–‡ä»¶ä¸»è¦å¯¹`bootstrap`å®¹å™¨è¿›è¡Œé…ç½®ï¼Œ`application`é…ç½®æ–‡ä»¶æ˜¯å¯¹`application`å®¹å™¨è¿›è¡Œé…ç½®ã€‚

`bootstrap`é…ç½®æ–‡ä»¶ä¹ŸåŒæ ·æ”¯æŒ`.properties`å’Œ`.yaml`ä¸¤ç§æ ¼å¼ï¼Œä¸»è¦ç”¨äºä»å¤–éƒ¨å¼•å…¥Springåº”ç”¨ç¨‹åºçš„é…ç½®ã€‚æ¯”å¦‚SpringCloudä¸­ï¼Œä»é…ç½®ä¸­å¿ƒå¼•å…¥é…ç½®ã€‚

`bootstrap`é…ç½®æ–‡ä»¶ç‰¹å¾

>+ bootstrapç”±çˆ¶ApplicationContextåŠ è½½ï¼Œæ¯”applicationä¼˜å…ˆåŠ è½½ã€‚
>+ bootstrapé‡Œé¢çš„å±æ€§ä¸èƒ½è¢«è¦†ç›–ã€‚

`bootstrap`ä¸`application`çš„åº”ç”¨åœºæ™¯

> + applicationé…ç½®æ–‡ä»¶ä¸»è¦ç”¨äºSpringBooté¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚
> + bootstrapé…ç½®æ–‡ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªåº”ç”¨åœºæ™¯ã€‚
>   + ä½¿ç”¨Spring Cloud Configé…ç½®ä¸­å¿ƒæ—¶ï¼Œéœ€è¦åœ¨bootstrapé…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¿æ¥åˆ°é…ç½®ä¸­å¿ƒçš„é…ç½®å±æ€§æ¥åŠ è½½å¤–éƒ¨é…ç½®ä¸­å¿ƒçš„é…ç½®ä¿¡æ¯ã€‚
>   + ä¸€äº›å›ºå®šçš„ä¸èƒ½è¢«è¦†ç›–çš„å±æ€§
>   + ä¸€äº›åŠ å¯†/è§£å¯†çš„åœºæ™¯

# æ•´åˆSpringMVC

`spring-boot-starter-web`

æ•´åˆSpringMvcä¹‹åå°±æ˜¯ä¸€ä¸ªwebé¡¹ç›®äº†ï¼Œè¿™ä¸ªwebé¡¹ç›®ä¸ä¾èµ–äºå¤–éƒ¨çš„Tomcatï¼Œå› ä¸ºè¿™ä¸ªSpringBootå†…éƒ¨è‡ªå¸¦ä¸€ä¸ªTomcatã€‚

æ—¢ç„¶ä¸ä¾èµ–å¤–éƒ¨çš„Tomcatï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è°ƒç”¨è‡ªèº«çš„Tomcatè¿è¡Œé¡¹ç›®å‘¢ï¼Ÿ**å…¶å®å°±æ˜¯é€šè¿‡è¿è¡Œå¯åŠ¨ç±»ï¼Œè¿è¡Œå¯åŠ¨ç±»ä¹‹åå¯ä»¥è¿è¡Œå†…ç½®çš„Tomcatå®¹å™¨ï¼Œå¯åŠ¨webé¡¹ç›®ã€‚**

## æ•´åˆé…ç½®ç±»

SpringMVCé˜¶æ®µæˆ‘ä»¬å†™çš„é…ç½®ç±»æ ¼å¼å¦‚ä¸‹ï¼š

```java
@ComponentScan("com.cskaoyan.controller")
@EnableWebMvc
public class MvcConfiguration implements WebMvcConfigurer{
    
}
```

é…ç½®ç±»åœ¨SpringBooté˜¶æ®µæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œä½†æ˜¯æœ‰äº›å†…å®¹äº§ç”Ÿäº†å˜åŒ–

- ä¸éœ€è¦å†™æ‰«æåŒ…ç›®å½•äº† â†’ springbootæä¾›çš„é»˜è®¤çš„æ‰«æåŒ…ç›®å½•ï¼š**å¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ç›®å½•**
- åœ¨é…ç½®ç±»ä¸Šå¢åŠ `@EnableWebMvc`æˆ–`@Configuration`
  - ğŸ·ï¸å¦‚æœä½¿ç”¨`@EnableWebMvc`æ„å‘³ç€**å…¨é¢æ¥ç®¡**SpringMVCçš„ç›¸å…³é…ç½®ï¼Œé»˜è®¤é…ç½®å¤±æ•ˆ
  -  ğŸ·ï¸å¦‚æœä½¿ç”¨<span style='color:yellow;background:red;font-size:æ–‡å­—å¤§å°;font-family:å­—ä½“;'>**@Configuration**</span>æ„å‘³ç€åšçš„æ˜¯**é…ç½®é¡¹çš„è¡¥å……** â†’ å»ºè®®ä½¿ç”¨

## é™æ€èµ„æºå¤„ç†

 ğŸ·ï¸`WebMvcConfigurer`æ¥å£ä¸­çš„`addResourceHandlers(registry)`

```JAVA
registry.addResourceHandler("æ˜ å°„èŒƒå›´").addResourceLocations("é™æ€èµ„æºæ‰€å¤„çš„ä½ç½®")
```

ä¸Šé¢è¿™ç§æ–¹å¼å¯ä»¥åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨

SpringBootä¹Ÿç»™æˆ‘ä»¬åšäº†é»˜è®¤çš„é…ç½®

- `mapping` æ˜ å°„èŒƒå›´ï¼š`/**`
- `location` èµ„æºæ‰€å¤„çš„ä½ç½®ï¼š`classpath:/public/`ã€`classpath:/static/`ã€`classpath:/META-INF/`ç­‰

SpringBootç»™æˆ‘ä»¬æä¾›äº†é»˜è®¤é…ç½®ä½¿ç”¨çš„æ˜¯é»˜è®¤å€¼ï¼›æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨å…¶é»˜è®¤çš„é…ç½®ï¼Œè¿˜å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰çš„å€¼

åœ¨SpringBootçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥æä¾›æŒ‡å®šçš„å€¼

é…ç½®æ–‡ä»¶æ˜¯`properties` â†’ `key=value`

æˆ‘ä»¬é€šè¿‡æŒ‡å®šçš„`key`æä¾›`value`ï¼ŒSpringBootå¯ä»¥è‡ªåŠ¨è¯»å–è¿™äº›`key`å¯¹åº”çš„å€¼

```properties
spring.web.resources.static-locations=file:d:/tmp/
spring.mvc.static-path-pattern=/pic/**
```

é™æ€èµ„æºå¤„ç†

- å•¥éƒ½ä¸åšé‡‡ç”¨é»˜è®¤å€¼
- é…ç½®æ–‡ä»¶ä¸­æŒ‰ç…§æŒ‡å®šçš„`key`æ¥æä¾›å¯¹åº”çš„å€¼
- ä¹Ÿå¯ä»¥å†™é…ç½®ç±»

## Filter  

å‰é¢åšJavaconfigçš„æ—¶å€™æ˜¯åœ¨`AACDSI`ï¼Œåœ¨SpringBootåº”ç”¨ä¸­åªéœ€è¦æ³¨å†Œåˆ°å®¹å™¨ä¸­å°±ç”Ÿæ•ˆ

åšçš„äº‹æƒ…ï¼š

1. ç»§æ‰¿`OncePreRequestFilter`ï¼Œå®ç°`doFilterInternal`æ–¹æ³•
2. æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶
   

> æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶æœ‰ä»€ä¹ˆå¥½å¤„?
>
> 1. é…ç½®èµ·æ¥æ–¹ä¾¿
> 2. ä¹Ÿå¯ä»¥ä½¿ç”¨å®¹å™¨ä¸­çš„å…¶ä»–ç»„ä»¶

`Filter`è¿™ä¹ˆæ–¹ä¾¿`HandlerInterceptor`åº”è¯¥ä¹ŸæŒºæ–¹ä¾¿çš„å§ï¼Ÿ

è¿˜æ˜¯é…ç½®ç±»çš„é…ç½®æ–¹å¼ â†’ `addInterceptors`æ–¹æ³•

## Tomcaté…ç½®

ç«¯å£å·ï¼š`server.port`

ä¸Šä¸‹æ–‡è·¯å¾„ï¼š`server.servlet.context-path`

![image-20230912091422895](.\assets\image-20230912091422895.png)

```properties
#Tomcaté…ç½®
server.servlet.context-path=/demo2
server.port=8090
```

## å…¶ä»–é…ç½®

- é…ç½®ç±»
- é…ç½®æ–‡ä»¶
  - prefixä¸ºï¼š`spring.web`
  - prefixä¸ºï¼š`spring.mvc`
  - æ—©æœŸçš„ä¸€äº›SpringBootç‰ˆæœ¬ï¼š`spring.resources` â†’ å®ƒç°åœ¨å˜äº† `spring.web.resources`

## å°ç»“

`spring-boot-starter-web`

é™æ€èµ„æºå¤„ç†é…ç½® â†’ å°¤å…¶å…³æ³¨`location`è¦å†™`file`è·¯å¾„

ç«¯å£å·é…ç½®

# æ•´åˆMyBatis

`mybatis-spring-boot-starter`

```xml
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.2.2</version>
</dependency>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>5.1.47</version>
</dependency>
```

åº”ç”¨ç¨‹åºä¸­å¼•å…¥`mybatis-spring-boot-starter`è¿™ä¸ªä¾èµ–ï¼Œå¯åŠ¨ç¨‹åºçš„æ—¶å€™æŠ¥é”™äº†

> â­ å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š`starter`ä¾èµ–çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ
>
> - å¼•å…¥mybatisè¿™é¡¹æŠ€æœ¯æ‰€éœ€è¦çš„ä¾èµ–
> - `spring-boot-autoconfigure`ä¾èµ– â†’ è‡ªåŠ¨é…ç½®

åˆšåˆšæŠ¥é”™çš„åŸå› å°±æ˜¯å› ä¸ºè‡ªåŠ¨é…ç½®ï¼›è‡ªåŠ¨é…ç½®MyBatisè¿‡ç¨‹ä¸­éœ€è¦æ³¨å†Œä¸€äº›ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¼šè¢«è‡ªåŠ¨æ³¨å†Œï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç»„ä»¶DataSource â†’ `datasource.set`å€¼çš„æ—¶å€™ï¼Œå‘ç°ä½ æ²¡æœ‰ç»™ä»–æä¾›å€¼ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<span style='color:yellow;background:red;font-size:æ–‡å­—å¤§å°;font-family:å­—ä½“;'>**æä¾›æ•°æ®æºçš„å€¼**</span>å°±è¡Œã€‚

```properties
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/cskaoyan_db?useUnicode=true&characterEncoding=utf-8
spring.datasource.username=root
spring.datasource.password=123456
```

SpringBootä¼šæ ¹æ®è¿™äº›é»˜è®¤å‘å®¹å™¨ä¸­æ³¨å†ŒDataSourceç»„ä»¶ï¼š`Hikari`ã€‚

å¦‚æœè¦ä¿®æ”¹æ•°æ®æºçš„ç±»å‹ï¼š`spring.datasource.type`

```properties
# å°†æ•°æ®æºä¿®æ”¹ä¸ºäº†Druid
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
```

<span style='color:yellow;background:red;font-size:æ–‡å­—å¤§å°;font-family:å­—ä½“;'>**è¿˜éœ€è¦æä¾›ï¼šMapperæ¥å£çš„åŒ…ç›®å½•**</span>

`@MapperScan` â†’ å†™åœ¨å¯åŠ¨ç±»ä¸Šå°±è¡Œ

```java
@SpringBootApplication
@MapperScan("com.cskaoyan.mapper")
public class Demo3MybatisApplication {}
```

æ³¨æ„ä¸€ä¸ªç‚¹ï¼šå†™MapperåŒ…ç›®å½•çš„æ—¶å€™ï¼Œå°±å†™Mapperæ¥å£çš„åŒ…ç›®å½•ï¼›å†™æ•´ä¸ªå·¥ç¨‹æ‰€åœ¨åŒ…ç›®å½•æ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºæ‰«æåˆ°serviceåŒ…ä¸‹çš„æ¥å£ç­‰éæ˜ å°„å±‚çš„æ¥å£æ—¶ä¼šæŠ¥é”™ã€‚

å¦‚æœè¦åšé¢å¤–çš„é…ç½®ï¼šé…ç½®å‰ç¼€ä¸ºmybatis

```yaml
mybatis:
  type-handlers-package: com.cskaoyan.typehandler
  configuration:
    cache-enabled: true
    lazy-loading-enabled: true
```

# çº¦å®šå¤§äºé…ç½®åŸç†

> favors convention over configuration

SpringBootå®ç°çº¦å®šå¤§äºé…ç½®ä¸»è¦åšçš„äº‹æƒ…æ˜¯å¸®æˆ‘ä»¬æ³¨å†Œä¸€äº›é»˜è®¤çš„ç»„ä»¶ï¼Œè€Œé»˜è®¤çš„ç»„ä»¶æ˜¯**è‡ªåŠ¨é…ç½®ç±»**æ¥è¿›è¡Œé…ç½®çš„ã€‚

 ğŸ·ï¸é‚£ä¹ˆSpringBootåº”ç”¨åŠ è½½å“ªä¸€äº›è‡ªåŠ¨é…ç½®ç±»å‘¢ï¼Ÿ

ä¸»è¦åŠ è½½çš„ä½¿ç”¨`autoconfigure`ä¾èµ–ä¸­çš„`/META-INF/spring.factories`æ–‡ä»¶é‡Œæä¾›äº†è‡ªåŠ¨é…ç½®ç±»çš„åˆ—è¡¨ï¼Œé€šè¿‡`org.springframework.boot.autoconfigure.EnableAutoConfiguration`è¿™ä¸ª`key`æ‰¾åˆ°å¯¹åº”çš„`value`å°±æ˜¯è‡ªåŠ¨é…ç½®ç±»çš„åˆ—è¡¨

```properties
# /META-INF/spring.factoriesä¸­çš„æ–‡ä»¶
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration
# æˆªå–äº†å…¶ä¸­ä¸€éƒ¨åˆ†
```

## æ³¨è§£

`@ConditionalOnXXX ` â†’ æ»¡è¶³`XXX`æ¡ä»¶å…¶ä»–çš„æ³¨è§£ç”Ÿæ•ˆ

`@ConditionalOnMissing` â†’ æ»¡è¶³ç¼ºå°‘`XXX`æ¡ä»¶ï¼Œå…¶ä»–çš„æ³¨è§£ç”Ÿæ•ˆ

## è‡ªåŠ¨é…ç½®ç±»

### æ–‡ä»¶

é…ç½®ç±»ä¿¡æ¯ï¼š

`autoconfigure`ä¾èµ–`/META-INF`æ–‡ä»¶å¤¹

- **`spring.factories`** â†’ `key` `â€œxxxAutoConfigurationâ€` å¯¹åº”çš„å€¼æ˜¯å­—ç¬¦ä¸²çš„åˆ—è¡¨ï¼Œè¿™äº›å­—ç¬¦ä¸²æ˜¯ è‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šç±»å
- **springæ–‡ä»¶å¤¹/æ–‡ä»¶ï¼ˆæ–‡ä»¶åå¾ˆé•¿ï¼‰** â†’ è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å€¼ å­—ç¬¦ä¸²çš„åˆ—è¡¨ï¼Œè¿™äº›å­—ç¬¦ä¸²æ˜¯ è‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šç±»å

![Day21-è‡ªåŠ¨é…ç½®ç±»ä»å“ªé‡ŒåŠ è½½çš„](.\assets\Day21-è‡ªåŠ¨é…ç½®ç±»ä»å“ªé‡ŒåŠ è½½çš„.png)

```properties
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration,\
org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration
```

### åŠ è½½è¿‡ç¨‹

é¦–å…ˆæ¥çœ‹å¯åŠ¨ç±»ï¼Œå¯åŠ¨ç±»ä¸ŠåŒ…å«äº†`@SpringBootApplication`æ³¨è§£

```java
@SpringBootApplication
@MapperScan("com.cskaoyan.mapper")
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

åœ¨`@SpringBootApplication` æ³¨è§£ä¸­åŒ…å«äº† `@EnableAutoConfiguration`æ³¨è§£

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(
    excludeFilters = {@Filter(
    type = FilterType.CUSTOM,
    classes = {TypeExcludeFilter.class}
), @Filter(
    type = FilterType.CUSTOM,
    classes = {AutoConfigurationExcludeFilter.class}
)}
)
public @interface SpringBootApplication {
```

åœ¨`@EnableAutoConfiguration` ä¸­åŒ…å«äº† `@Import({AutoConfigurationImportSelector.class})` ï¼Œé€šè¿‡`Selector`é€‰æ‹©å™¨æ‰¾åˆ°å¯¹åº”çš„è‡ªåŠ¨é…ç½®ç±»

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage
@Import({AutoConfigurationImportSelector.class})
public @interface EnableAutoConfiguration {
```

åœ¨`AutoConfigurationImportSelector` ä¸­åŒ…å«äº† `selectImports` æ–¹æ³•

```java
public String[] selectImports(AnnotationMetadata annotationMetadata) {
  if (!this.isEnabled(annotationMetadata)) {
    return NO_IMPORTS;
  } else {
    AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = this.getAutoConfigurationEntry(annotationMetadata);
    return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());
  }
}
```

ç„¶åå†çœ‹`selectImports` æ–¹æ³•é‡Œçš„`this.getAutoConfigurationEntry(annotationMetadata)` ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­åŒ…å«è¿™æ ·çš„ä¸€è¡Œä»£ç ï¼Œè·å¾—é…ç½®ç±»çš„å­—ç¬¦ä¸²çš„`List`

```java
protected AutoConfigurationImportSelector.AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
  if (!this.isEnabled(annotationMetadata)) {
    return EMPTY_ENTRY;
  } else {
    AnnotationAttributes attributes = this.getAttributes(annotationMetadata);
    //è¿™ä¸€è¡Œå°±æ˜¯è·å¾—é…ç½®ç±»(å…¨é™å®šç±»å)çš„Listä¿¡æ¯
    List<String> configurations = this.getCandidateConfigurations(annotationMetadata, attributes);
    configurations = this.removeDuplicates(configurations);
    Set<String> exclusions = this.getExclusions(annotationMetadata, attributes);
    this.checkExcludedClasses(configurations, exclusions);
    configurations.removeAll(exclusions);
    configurations = this.getConfigurationClassFilter().filter(configurations);
    this.fireAutoConfigurationImportEvents(configurations, exclusions);
    return new AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);
  }
}
```

è¿›å…¥åˆ°`getCandidateConfigurations` æ–¹æ³•ä¸­

```java
protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
  // åŠ è½½/META-INF/spring.factoriesæ–‡ä»¶ä¸­çš„è‡ªåŠ¨é…ç½®ç±»
  List<String> configurations = new ArrayList(SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader()));
  // åŠ è½½/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.importsæ–‡ä»¶ä¸­çš„è‡ªåŠ¨é…ç½®ç±»
  ImportCandidates.load(AutoConfiguration.class, this.getBeanClassLoader()).forEach(configurations::add);
  Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories nor in META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports. If you are using a custom packaging, make sure that file is correct.");
  return configurations;
}
```

è¦çœ‹`/META-INF/spring.factories`æ¥ä¸‹æ¥è¿›å…¥åˆ°`loadFactoryNames` è¿™ä¸ªæ–¹æ³•ä¸­

```java
public static List<String> loadFactoryNames(Class<?> factoryType, @Nullable ClassLoader classLoader) {
    ClassLoader classLoaderToUse = classLoader;
    if (classLoader == null) {
        classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();
    }

    String factoryTypeName = factoryType.getName();
    return (List)loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());
}
```

æœ€åæ¥çœ‹`loadSpringFactories` è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¸º`Map` ï¼Œè¿™ä¸ª`Map` çš„ `key` ä¸ºå­—ç¬¦ä¸²ï¼Œ`value` ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨`List<String>`ï¼Œè¿™ä¸ª`key`å…¶å®å°±æ˜¯éœ€è¦`EnableAutoConfiguration`ï¼Œ`value`å°±æ˜¯è‡ªåŠ¨é…ç½®ç±»çš„å­—ç¬¦ä¸²`List`ä¿¡æ¯

```java
private static Map<String, List<String>> loadSpringFactories(ClassLoader classLoader) {
  Map<String, List<String>> result = (Map)cache.get(classLoader);
  if (result != null) {
    return result;
  } else {
    HashMap result = new HashMap();

    try {
      ///META-INF/spring.factories
      Enumeration urls = classLoader.getResources("META-INF/spring.factories");
      //ç•¥æ‰å¾ˆå¤šä»£ç 
    }
  }
}
```

åˆ°è¿™é‡Œå¤§å®¶å…¶å®å¯ä»¥çœ‹åˆ°æœ€ç»ˆåŠ è½½çš„å°±æ˜¯`/META-INF/spring.factories`æ–‡ä»¶

è¦çœ‹`/META-INF/spring/xxx.imports`

```java
public static ImportCandidates load(Class<?> annotation, ClassLoader classLoader) {
  Assert.notNull(annotation, "'annotation' must not be null");
  ClassLoader classLoaderToUse = decideClassloader(classLoader);
  ///META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports
  String location = String.format("META-INF/spring/%s.imports", annotation.getName());
  Enumeration<URL> urls = findUrlsInClasspath(classLoaderToUse, location);
  ArrayList importCandidates = new ArrayList();

  while(urls.hasMoreElements()) {
    URL url = (URL)urls.nextElement();
    importCandidates.addAll(readCandidateConfigurations(url));
  }

  return new ImportCandidates(importCandidates);
}
```

### è‡ªåŠ¨é…ç½®ç±»

åŠ è½½è‡ªåŠ¨é…ç½®ç±»ï¼Œå¹¶ä¸”é…ç½®çš„ç”Ÿæ•ˆæ˜¯æœ‰æ¡ä»¶çš„ï¼ŒåŒ…å«`@ConditionalOnXXX`å’Œ `@ConditionalOnMissingXXX` è¿™æ ·çš„æ³¨è§£ï¼Œæ»¡è¶³ä¸€å®šçš„æ¡ä»¶æ—¶ç”Ÿæ•ˆå’Œä¸æ»¡è¶³ä¸€å®šçš„æ¡ä»¶çš„æ—¶å€™ç”Ÿæ•ˆ

æ¯”å¦‚ 

1. `@ConditionalOnClass` ä¹Ÿå°±æ˜¯åŒ…å«å¯¹åº”çš„ç±»çš„æ—¶å€™ç”Ÿæ•ˆï¼ˆä¹Ÿå°±æ˜¯å¯¼åŒ…ä»¥åç”Ÿæ•ˆï¼‰
2. `@ConditionalOnMissingBean` å½“æ²¡æœ‰æŸä¸ªç»„ä»¶çš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”Ÿæ•ˆå°±ä¼šå¯¼è‡´æ³¨å†Œä¸€ä¸ªé»˜è®¤ç»„ä»¶ï¼›å¦‚æœè‡ªè¡Œæ³¨å†Œç»„ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªé»˜è®¤ç»„ä»¶å¤±æ•ˆï¼›å…¶å®è¿™ä¸ªå°±æ˜¯çº¦å®šå¤§äºé…ç½®

```java
@Configuration(
  proxyBeanMethods = false
)
@ConditionalOnClass({JdbcTemplate.class, TransactionManager.class})
@AutoConfigureOrder(2147483647)
@EnableConfigurationProperties({DataSourceProperties.class})
public class DataSourceTransactionManagerAutoConfiguration {
  public DataSourceTransactionManagerAutoConfiguration() {
  }

  @Configuration(
    proxyBeanMethods = false
  )
  @ConditionalOnSingleCandidate(DataSource.class)
  static class JdbcTransactionManagerConfiguration {
    JdbcTransactionManagerConfiguration() {
    }

    @Bean
    @ConditionalOnMissingBean({TransactionManager.class})
    DataSourceTransactionManager transactionManager(Environment environment, DataSource dataSource, ObjectProvider<TransactionManagerCustomizers> transactionManagerCustomizers) {
      DataSourceTransactionManager transactionManager = this.createTransactionManager(environment, dataSource);
      transactionManagerCustomizers.ifAvailable((customizers) -> {
        customizers.customize(transactionManager);
      });
      return transactionManager;
    }

    private DataSourceTransactionManager createTransactionManager(Environment environment, DataSource dataSource) {
      return (DataSourceTransactionManager)((Boolean)environment.getProperty("spring.dao.exceptiontranslation.enabled", Boolean.class, Boolean.TRUE) ? new JdbcTransactionManager(dataSource) : new DataSourceTransactionManager(dataSource));
    }
  }
}
```

## é…ç½®æ–‡ä»¶é…ç½®é¡¹

è‡ªåŠ¨é…ç½®ç±»éƒ½åœ¨`autoconfigure`ä¾èµ–ä¸­

> å¼•å…¥`starter`ä¾èµ–ä¹‹åï¼Œ`starter`åšäº†ä¸¤ä»¶äº‹æƒ…
>
> 1. å¼•å…¥æŸé¡¹æŠ€æœ¯éœ€è¦çš„ä¾èµ–
> 2. å¼•å…¥`autoconfigurer`ä¾èµ–

éƒ½åœ¨`autoconfigure`ä¾èµ–ä¸­çš„`/META-INF`è·¯å¾„ä¸‹ï¼ŒåŒ…å«äº†`ï¼ˆadditional-ï¼‰spring-configuration-metadata.json`æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†ä½ å¯ä»¥åšçš„é…ç½®é¡¹æœ‰å“ªäº›ï¼Œå¹¶ä¸”è¿™äº›é…ç½®çš„æè¿°ã€é»˜è®¤å€¼ã€å€¼çš„æ ¼å¼ç­‰

![image-20230912091531177](.\assets\image-20230912091531177.png)

å€¼çš„æ ¼å¼

```json
{
    "name": "spring.web.resources.static-locations",
    "type": "java.lang.String[]",
    "description": "Locations of static resources. Defaults to classpath:[\/META-INF\/resources\/, \/resources\/, \/static\/, \/public\/].",
    "sourceType": "org.springframework.boot.autoconfigure.web.WebProperties$Resources",
    "defaultValue": [
        "classpath:\/META-INF\/resources\/",
        "classpath:\/resources\/",
        "classpath:\/static\/",
        "classpath:\/public\/"
    ]
}
```

ä½†æ˜¯å‘¢ï¼Œè®©ä½ å†™jsonæ–‡ä»¶ï¼Œæ˜¯ä¸ºéš¾ä½ ï¼Œå¼•å…¥ä¸€ä¸ªä¾èµ–ï¼Œè¿™ä¸ªä¾èµ–ä¼šå¸®æˆ‘ä»¬æ–°å¢å¯¹åº”çš„json

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```

rerunä½ çš„åº”ç”¨ç¨‹åºï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸‹ã€‚å¦‚æœæ²¡æœ‰ç”Ÿæˆï¼šåœ¨resourcesç›®å½•ä¸‹æ–°å¢ä¸€ä¸ªæ–‡ä»¶å¤¹ `META-INF`

ğŸ·ï¸ `@Import({})`æ³¨è§£ä½œç”¨ï¼š

`value`å±æ€§æ˜¯`Xx.class`

1. é…ç½®ç±»ï¼šå°†é…ç½®ç±»æ³¨å†Œä¸ºå®¹å™¨ä¸­çš„ç»„ä»¶
2. é€‰æ‹©å™¨ï¼šå®ç°äº†`ImportSelector`æ¥å£ï¼Œæ¥å£ä¸­åŒ…å«`String[] selectImports`ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›äº†ä»€ä¹ˆå€¼å°±å°†ä»€ä¹ˆç±»æ³¨å†Œä¸ºç»„ä»¶
3. `selectImports`æ–¹æ³•åŠ è½½çš„å°±æ˜¯`autoconfigure`ä¾èµ–`/META-INF/spring/xxx.imports`æˆ–`/META-INF/spring.factories`

## æ‰“åŒ…

é»˜è®¤å°±æ˜¯jaråŒ…ï¼Œpackageæ‰“åŒ…ä¹‹åå‘½åä¹ æƒ¯åŠ ä¸Šæ—¥æœŸæ—¶é—´`demo-09181512`

## é…ç½®æ–‡ä»¶åŠ è½½è¿‡ç¨‹  

é…ç½®æ–‡ä»¶æ˜¯æœ‰åŠ è½½è¿‡ç¨‹çš„ï¼Œåˆ©ç”¨è¯¥è¿‡ç¨‹å¯ä»¥è§£å†³ä¸€äº›å¼€å‘äººå‘˜å¯†ç å†²çªç­‰é—®é¢˜

ä¸»é…ç½®æ–‡ä»¶ï¼š`application.yml`åœ¨SpringBootåº”ç”¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šè‡ªåŠ¨åœ¨classpathè·¯å¾„ä¸‹åŠ è½½è¿™ä¸ªæ–‡ä»¶

ä¹Ÿå¯ä»¥é€šè¿‡ä¸»é…ç½®æ–‡ä»¶æ¿€æ´»å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œ`application-xxx.yml`

å¦‚ä½•æ¿€æ´»

åœ¨ä¸jaråŒ…åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œæœ‰é…ç½®æ–‡ä»¶ï¼Œè¯¥é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚

## å¦‚ä½•å¼•å…¥æ–°æŠ€æœ¯

ä½¿ç”¨SpringBootå¼•å…¥ä¸€é¡¹æ–°çš„æŠ€æœ¯ï¼Œå…¥å£å°±æ˜¯`starter`ä¾èµ–ã€‚

`@SpringBootApplication`æä¾›é»˜è®¤çš„æ‰«æåŒ…é…ç½®ï¼Œå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ç›®å½•ã€‚

é…ç½®é¡¹çš„æç¤ºï¼š

åœ¨å†™SpringBootçš„é…ç½®æ–‡ä»¶è¿‡ç¨‹ä¸­ä¼šæœ‰æç¤ºï¼ŒåŸå› æ˜¯å…¶æœ‰å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œè€Œé…ç½®æ–‡ä»¶é‡Œæä¾›äº†å¯¹åº”çš„æç¤ºã€‚

é…ç½®æ–‡ä»¶åœ¨jsoné‡Œï¼š

/MATA-INF/spring-configuration-metadata.json

ï¼ˆ/META-INFå…¶å®æ˜¯classpathï¼‰

å¦‚ä½•è®©è‡ªå®šä¹‰çš„é…ç½®ä¹Ÿæœ‰æç¤ºé¡¹ï¼Ÿ

1. è‡ªå·±å†™jsonï¼šåœ¨resourcesæ–‡ä»¶å¤¹ä¸‹å»ºä¸€ä¸ªæ–‡ä»¶å¤¹`META-INF`
2. å¼•å…¥ä¾èµ–ï¼Œè®©å®ƒå¸®æˆ‘ä»¬ç”Ÿæˆï¼šspring-configuration-processor